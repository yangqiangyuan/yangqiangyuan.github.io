<!DOCTYPE html>
<html lang="en">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="John Doe" />



<meta name="description" content="title :部署jenkinsjenkins代码上线发展史代码发布上线是每一个 IT 企业必须要面临的，而且不管是对开发或者是运维来说，代 码上线本身就是一个件非常痛苦的事情，很多时候每一次发布都是一次考验。为了提高上线 的效率，代码上线的方式，方法，工具也不断的发展，基本上可以分为以下几个阶段。 没有构建服务器软件在开发者的机器上通过脚本或者手动构建，源代码保存在代码服务器中，但是开发者经常">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2022/08/14/jenkins/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="title :部署jenkinsjenkins代码上线发展史代码发布上线是每一个 IT 企业必须要面临的，而且不管是对开发或者是运维来说，代 码上线本身就是一个件非常痛苦的事情，很多时候每一次发布都是一次考验。为了提高上线 的效率，代码上线的方式，方法，工具也不断的发展，基本上可以分为以下几个阶段。 没有构建服务器软件在开发者的机器上通过脚本或者手动构建，源代码保存在代码服务器中，但是开发者经常">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326114330567.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326111717087.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326111739187.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326121053474.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326121129653.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326171455788.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326171513829.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326172057229.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326172813498.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326172847784.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326173740074.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327165046301.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709173420208.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709173734617.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709174146102.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709175921012.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326215214570.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709180211044.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709180349918.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326223329631.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326223420825.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326223420825-163653701349622.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326223606562.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326224547980.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713101418634.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713101447827.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713110201084.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713110238290.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713110619886.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713111021726.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713111340479.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713112353725.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713112434353.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713112640931.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713112846851.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713113715916.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713113802579.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713114023778.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706111309218.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706111723922.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706113538981.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706133434092.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706134430359.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706140045980.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706140059421.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706141239759.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142149787.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142200211.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142213781.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142259460.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142336822.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142430538.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142441716.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706142457030.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706152248954.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706162526177.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706162827184.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706174126694.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706174453642.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200706174930054.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210126140640216.png">
<meta property="og:image" content="http://book.luffycity.com/linux-book/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/pic/image-20210126140718543.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200707104340624.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200707155533602.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200707160203811.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200707160844018.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200707163049139.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200707163644903.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708091136140.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708091154862.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708091226949.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708091356915.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708113651522.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708114126644.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708135625100.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708120027011.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708133644978.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708161738625.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708162002494.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708162239124.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708181845539.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708181930838.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708182134042.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708182238410.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708182821452.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708182913239.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708183433377.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200708183514770.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709135211798.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709142244529.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200709143003169.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327151337010.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327151424531.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327151757966.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327152240118.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327152754628.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327155023773.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327153353487.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327153812915.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327154239865.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327154328221.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327155304387.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327160232307.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327162226259.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327162258267.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327162431704.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327162541623.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327165149754.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327165218802.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327165300057.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327234142476.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327234509953.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327234541641.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200327233802639.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330222258599.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330222035365.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330222119025.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330222527814.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330222425761.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330224508121.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330224823493.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330230826625.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330231333059.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330231359729.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330231456032.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330231517159.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330231743780.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330233258208.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330233324672.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330233337857.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200330233419753.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713131416418.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713131917123.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713133345574.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713133531091.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713133842268.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210223175157914.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713135417302.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713141342272.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713142021713.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200713170128757.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225100028272.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225101225848.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225104821365.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225105020205.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225105546628.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225105917932.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225110141072.png">
<meta property="og:image" content="http://example.com/2022/08/14/jenkins/pic/image-20210225110314469.png">
<meta property="article:published_time" content="2022-08-13T16:40:44.851Z">
<meta property="article:modified_time" content="2022-08-13T16:40:44.852Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/08/14/jenkins/pic/image-20200326114330567.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">




<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Hexo</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: 
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>Menu</li>
                        <li>Tags</li>
                        
                        <li>Friends</li>
                        
                        
                        <li>About Me</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me"/>
</nav>
      <div class="body-wrap"><article id="post-jenkins" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/14/jenkins/" class="article-date">
      <time datetime="2022-08-13T16:40:44.851Z" itemprop="datePublished">2022-08-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <hr>
<h2 id="title-部署jenkins"><a href="#title-部署jenkins" class="headerlink" title="title :部署jenkins"></a>title :部署jenkins</h2><h1 id="jenkins"><a href="#jenkins" class="headerlink" title="jenkins"></a>jenkins</h1><h2 id="代码上线发展史"><a href="#代码上线发展史" class="headerlink" title="代码上线发展史"></a>代码上线发展史</h2><p>代码发布上线是每一个 IT 企业必须要面临的，而且不管是对开发或者是运维来说，代 码上线本身就是一个件非常痛苦的事情，很多时候每一次发布都是一次考验。为了提高上线 的效率，代码上线的方式，方法，工具也不断的发展，基本上可以分为以下几个阶段。</p>
<h3 id="没有构建服务器"><a href="#没有构建服务器" class="headerlink" title="没有构建服务器"></a>没有构建服务器</h3><p>软件在开发者的机器上通过脚本或者手动构建，源代码保存在代码服务器中，但是开发者经常要修改本地代码，因此每次发布，都需要手动合并代码，再进行手动构建，这个过程费时费力。</p>
<h3 id="晚上进行构建"><a href="#晚上进行构建" class="headerlink" title="晚上进行构建"></a>晚上进行构建</h3><p>在这个阶段，团队有构建服务器，自动化的构建在晚上进行。构建过程只是简单的编译代码，没有可靠的和可重复的单元测试。然而，开发人员每天提交代码。如果某个开发人员 提的代码和其他人的代码冲突的话，构建服务器会在第二天通过邮件通知团队。所以又一段 时间构建是处于失败状态的。</p>
<h3 id="晚上进行构建并进行自动化测试"><a href="#晚上进行构建并进行自动化测试" class="headerlink" title="晚上进行构建并进行自动化测试"></a>晚上进行构建并进行自动化测试</h3><p>团队对 CI 和自动化测试越来越重视。无论什么时候版本管理系统中的代码改变了都会 触发编译构建过程，团队成员可以看到是代码中的什么改变触发了这个构建。并且，构建脚本会编译应用并且会执行一系列的单元测试或集成测试。除了邮件，构建服务器还可以通过 其他方式通知团队成员，如微信，钉钉通知。</p>
<h3 id="代码质量度量"><a href="#代码质量度量" class="headerlink" title="代码质量度量"></a>代码质量度量</h3><p>自动化的代码质量和测试覆盖率的度量手段有助于评价代码质量和测试的有效性。</p>
<h3 id="更加认真的对待测试"><a href="#更加认真的对待测试" class="headerlink" title="更加认真的对待测试"></a>更加认真的对待测试</h3><p>CI和测试紧密相关，如今测试驱动开发被广泛的使用，是的对自动化的构建更加有信心。应用不仅仅是简单的编译和测试，而是如果测试成功会被自动的部署到一个应用服务器，以此进行更多的测试工作与性能测试。</p>
<h3 id="验收测试与自动化部署"><a href="#验收测试与自动化部署" class="headerlink" title="验收测试与自动化部署"></a>验收测试与自动化部署</h3><p>验收测试驱动的开发被使用，使得我们能够了解项目的状态。这些自动化的测试使用行 为驱动的开发和测试驱动的开发工具来作为交流和文档工具，发布非开发人员也能读懂的测 试结果报告。由于测试在开发的早起就已经被自动化的执行了，所以我们能更加清楚地了解 到什么已经做了，什么还没有做。每当代码改变或晚上，应用被自动化地部署到测试环境中， 以供 QA 团队测试。当测试通过之后，软件的一个版本将被手工部署到生产环境中，团队也可以在出现问题的时候回滚之前的发布记录。</p>
<h2 id="centos7安装jenkins"><a href="#centos7安装jenkins" class="headerlink" title="centos7安装jenkins"></a>centos7安装jenkins</h2><p>最小硬件需求:256M 内存、1G 磁盘空间，通常根据需要 Jenkins 服务器至少 1G 内存， 50G+磁盘空间。</p>
<p>软件需求：由于jenkins是使用java语言开发，因此运行需要安装java运行时环境（jdk）。</p>
<p>所有软件包可以找超哥索取，qq：877348180</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ci_cd_rpm]# pwd</span><br><span class="line">/opt/ci_cd_rpm</span><br><span class="line">[root@m01 ci_cd_rpm]# ls</span><br><span class="line">git-2.9.5.tar.gz                      hello-world.tar.gz  jdk-8u121-linux-x64.rpm      nexus-3.13.0-01-unix.tar.gz</span><br><span class="line">gitlab-ce-10.2.2-ce.0.el7.x86_64.rpm  java-demo.tar.gz    jenkins-2.99-1.1.noarch.rpm  plugins.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="配置jdk环境"><a href="#配置jdk环境" class="headerlink" title="配置jdk环境"></a>配置jdk环境</h2><p>可以通过清华镜像站下载jenkins安装包，以及jdk环境可以通过yum直接安装，也可以下载好rpm包安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ci_cd_rpm]# rpm -ivh jdk-8u121-linux-x64.rpm</span><br><span class="line">准备中...                          ################################# [100%]</span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:jdk1.8.0_121-2000:1.8.0_121-fcs  ################################# [100%]</span><br><span class="line">Unpacking JAR files...</span><br><span class="line">    tools.jar...</span><br><span class="line">    plugin.jar...</span><br><span class="line">    javaws.jar...</span><br><span class="line">    deploy.jar...</span><br><span class="line">    rt.jar...</span><br><span class="line">    jsse.jar...</span><br><span class="line">    charsets.jar...</span><br><span class="line">    localedata.jar...</span><br><span class="line">[root@m01 ci_cd_rpm]#</span><br><span class="line">[root@m01 ci_cd_rpm]#</span><br><span class="line">[root@m01 ci_cd_rpm]# java -version</span><br><span class="line">java version &quot;1.8.0_121&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_121-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)</span><br></pre></td></tr></table></figure>

<h2 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h2><p>安装方式有很多，这里超哥用rpm安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ci_cd_rpm]# rpm -ivh jenkins-2.99-1.1.noarch.rpm</span><br><span class="line">警告：jenkins-2.99-1.1.noarch.rpm: 头V4 DSA/SHA1 Signature, 密钥 ID d50582e6: NOKEY</span><br><span class="line">准备中...                          ################################# [100%]</span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:jenkins-2.99-1.1                 ################################# [100%]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 检查jenkins版本</span><br><span class="line">[root@m01 ci_cd_rpm]# java -jar /usr/lib/jenkins/jenkins.war --version</span><br><span class="line">2.99</span><br></pre></td></tr></table></figure>

<h2 id="启动jenkins"><a href="#启动jenkins" class="headerlink" title="启动jenkins"></a>启动jenkins</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ci_cd_rpm]# systemctl start jenkins</span><br><span class="line">[root@m01 ci_cd_rpm]# systemctl status jenkins</span><br><span class="line"></span><br><span class="line">[root@m01 ci_cd_rpm]# netstat -tunlp |grep 8080</span><br><span class="line">tcp6       0      0 :::8080                 :::*                    LISTEN      10819/java</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 注意关闭防火墙</span><br><span class="line">iptables -F</span><br></pre></td></tr></table></figure>

<h2 id="jenkins配置文件"><a href="#jenkins配置文件" class="headerlink" title="jenkins配置文件"></a>jenkins配置文件</h2><p>学习jenkins首先要明白一点，那就是jenkins一切皆文件，jenkins没有数据库，所有的数据都是以文件的形式存在，所以我们要了解jenkins的主要目录和文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ci_cd_rpm]# rpm -ql jenkins</span><br><span class="line">/etc/init.d/jenkins</span><br><span class="line">/etc/logrotate.d/jenkins</span><br><span class="line">/etc/sysconfig/jenkins</span><br><span class="line">/usr/lib/jenkins</span><br><span class="line">/usr/lib/jenkins/jenkins.war</span><br><span class="line">/usr/sbin/rcjenkins</span><br><span class="line">/var/cache/jenkins</span><br><span class="line">/var/lib/jenkins</span><br><span class="line">/var/log/jenkins</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jenkins加载插件很多，非常吃内存，且所有操作都是io操作，需要系统IO速度较快，需要机器配置较高</span><br><span class="line">jenkins配置文件：/etc/sysconfig/jenkins</span><br><span class="line">jenkins核心目录：/var/lib/jenkins</span><br><span class="line">/usr/lib/jenkins/jenkins.war WAR包</span><br><span class="line">/etc/sysconfig/jenkins 配置文件</span><br><span class="line">/var/lib/jenkins/ 默认的JENKINS_HOME目录</span><br><span class="line">/var/log/jenkins/jenkins.log Jenkins日志文件</span><br><span class="line">/var/lib/jenkins/secrets/initialAdminPassword 存放初始密码</span><br><span class="line">/var/lib/jenkins/plugins    插件目录</span><br></pre></td></tr></table></figure>

<h2 id="jenkins初始化"><a href="#jenkins初始化" class="headerlink" title="jenkins初始化"></a>jenkins初始化</h2><p>jenkins首次启动可能会出现页面访问一直提示：</p>
<p><img src="pic/image-20200326114330567.png" alt="image-20200326114330567"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">访问  192.168.178.120:8080  jenkins站点</span><br><span class="line"></span><br><span class="line">一直显示&quot;Please wait while Jenkins is getting ready to work ...&quot; 无法进入</span><br></pre></td></tr></table></figure>

<p>进行如下修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 jenkins]# cp hudson.model.UpdateCenter.xml hudson.model.UpdateCenter.xml.bak</span><br><span class="line"></span><br><span class="line"># 修改如下配置</span><br><span class="line">[root@m01 jenkins]# cat hudson.model.UpdateCenter.xml</span><br><span class="line">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span><br><span class="line">&lt;sites&gt;</span><br><span class="line">  &lt;site&gt;</span><br><span class="line">    &lt;id&gt;default&lt;/id&gt;</span><br><span class="line">    &lt;url&gt;http://mirror.xmission.com/jenkins/updates/update-center.json&lt;/url&gt;</span><br><span class="line">  &lt;/site&gt;</span><br><span class="line">&lt;/sites&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@m01 jenkins]# systemctl reload jenkins</span><br><span class="line">[root@m01 jenkins]# systemctl restart jenkins</span><br></pre></td></tr></table></figure>

<p>这个过程会比较缓慢</p>
<h3 id="解锁jenkins"><a href="#解锁jenkins" class="headerlink" title="解锁jenkins"></a>解锁jenkins</h3><p><img src="pic/image-20200326111717087.png" alt="image-20200326111717087"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 默认账号admin，密码如下</span><br><span class="line">[root@m01 jenkins]# cat /var/lib/jenkins/secrets/initialAdminPassword</span><br><span class="line">98da9a6fe9814531b790fbe125799bf0</span><br></pre></td></tr></table></figure>

<h3 id="自定义jenkins插件"><a href="#自定义jenkins插件" class="headerlink" title="自定义jenkins插件"></a>自定义jenkins插件</h3><p>这里安装插件由于会非常缓慢，我们可以后期手动安装，直接点击右上角的❎</p>
<p><img src="pic/image-20200326111739187.png" alt="image-20200326111739187"></p>
<p>此时进入jenkins首页</p>
<p><img src="pic/image-20200326121053474.png" alt="image-20200326121053474"></p>
<p><img src="pic/image-20200326121129653.png" alt="image-20200326121129653"></p>
<p>默认没安装插件，所以页面功能很少</p>
<h3 id="修改jenkins用户密码"><a href="#修改jenkins用户密码" class="headerlink" title="修改jenkins用户密码"></a>修改jenkins用户密码</h3><p><img src="pic/image-20200326171455788.png" alt="image-20200326171455788"></p>
<p><img src="pic/image-20200326171513829.png" alt="image-20200326171513829"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">默认admin密码太长，可以修改自己记住的</span><br><span class="line">chaoge666</span><br></pre></td></tr></table></figure>

<h2 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h2><p>国外jenkins插件安装太难了，请用如下方式</p>
<p><img src="pic/image-20200326172057229.png" alt="image-20200326172057229"><img src="pic/image-20200326172813498.png" alt="image-20200326172813498"></p>
<h3 id="指定jenkins代理下载插件"><a href="#指定jenkins代理下载插件" class="headerlink" title="指定jenkins代理下载插件"></a>指定jenkins代理下载插件</h3><p>可以配置下载插件代理地址</p>
<p>也可以去官网、清华源等地址手动下载jenkins插件，再上传</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jenkins镜像文件后缀`.hpi`文件</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200326172847784.png" alt="image-20200326172847784"></p>
<h3 id="使用清华镜像站下载插件"><a href="#使用清华镜像站下载插件" class="headerlink" title="使用清华镜像站下载插件"></a>使用清华镜像站下载插件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/</span><br><span class="line"></span><br><span class="line">下载.hpi文件，然后在jenkins里面导入上传即可，自动安装，重启生效</span><br></pre></td></tr></table></figure>

<h3 id="修改jenkins默认升级插件源"><a href="#修改jenkins默认升级插件源" class="headerlink" title="修改jenkins默认升级插件源"></a>修改jenkins默认升级插件源</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如图，换为</span><br><span class="line">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span><br><span class="line"></span><br><span class="line">点击提交，也就是修改了linux的文件hudson.model.UpdateCenter.xml</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200326173740074.png" alt="image-20200326173740074"></p>
<h3 id="jenkins插件迁移"><a href="#jenkins插件迁移" class="headerlink" title="jenkins插件迁移"></a>jenkins插件迁移</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">可以把插件备份的机器，所有的插件目录/var/lib/jenkins/plugins 资料直接打包</span><br><span class="line">解压缩到新插件目录即可，jenkins一切皆文件，可以直接迁移</span><br><span class="line"></span><br><span class="line">jenkins没有数据库，一切皆文件，都是写在xml文件里</span><br><span class="line"></span><br><span class="line">超哥已经提供了插件压缩包</span><br><span class="line">/opt/ci_cd_rpm/plugins.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压缩</span><br><span class="line">[root@m01 ci_cd_rpm]# tar -zxvf plugins.tar.gz</span><br><span class="line"># 复制，移动所有插件到当前jenkins的插件目录</span><br><span class="line"></span><br><span class="line">[root@m01 plugins]# pwd</span><br><span class="line">/opt/ci_cd_rpm/plugins</span><br><span class="line">[root@m01 plugins]#</span><br><span class="line">[root@m01 plugins]# mv * /var/lib/jenkins/plugins/</span><br><span class="line"></span><br><span class="line"># 重启jenkins，查看插件列表</span><br><span class="line">systemctl restart jenkins</span><br><span class="line"></span><br><span class="line"># 重启之后，jenkins自动应用所有新插件，且正确应用了</span><br></pre></td></tr></table></figure>

<h2 id="查看插件列表"><a href="#查看插件列表" class="headerlink" title="查看插件列表"></a>查看插件列表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">系统管理 &gt; 系统信息 &gt;  插件</span><br><span class="line"></span><br><span class="line">系统管理 &gt; 插件管理 &gt; 已安装</span><br></pre></td></tr></table></figure>

<h3 id="新功能预览"><a href="#新功能预览" class="headerlink" title="新功能预览"></a>新功能预览</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jenkins首页 &gt; 新建Item &gt; 多了很多新功能</span><br></pre></td></tr></table></figure>

<h2 id="Jenkins主目录学习"><a href="#Jenkins主目录学习" class="headerlink" title="Jenkins主目录学习"></a>Jenkins主目录学习</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 plugins]# rpm -ql jenkins</span><br><span class="line">/etc/init.d/jenkins                    # 启动目录</span><br><span class="line">/etc/logrotate.d/jenkins        # 日志切割</span><br><span class="line">/etc/sysconfig/jenkins          # jenkins主配置文件</span><br><span class="line">/usr/lib/jenkins                        #jenkins程序文件 jenkins.war，如 直接替换新版jenkins.war包，重启即升级</span><br><span class="line">/usr/lib/jenkins/jenkins.war</span><br><span class="line">/usr/sbin/rcjenkins</span><br><span class="line">/var/cache/jenkins</span><br><span class="line">/var/lib/jenkins                      # jenkins主目录，如果要备份jenkins所有数据，直接拷贝这个目录即可</span><br><span class="line">/var/log/jenkins</span><br></pre></td></tr></table></figure>

<h3 id="一切皆文件之用户目录"><a href="#一切皆文件之用户目录" class="headerlink" title="一切皆文件之用户目录"></a>一切皆文件之用户目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/jenkins/users  # 该目录下存放用户信息</span><br><span class="line">如 admin的信息/var/lib/jenkins/users/admin/config.xml ，改密码等等</span><br></pre></td></tr></table></figure>

<h3 id="主配置文件解读"><a href="#主配置文件解读" class="headerlink" title="主配置文件解读"></a>主配置文件解读</h3><p>jenkins默认的用户为jenkins，生产环境建议使用jenkins用户，然后使用sudo进行授权，在学习过程中若是想要避免权限问题，可以直接改为root用户。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">默认配置参数</span><br><span class="line">[root@m01 plugins]# grep -Ev &quot;^$|^#&quot; /etc/sysconfig/jenkins</span><br><span class="line">JENKINS_HOME=&quot;/var/lib/jenkins&quot;                #jenkins主数据目录，数据备份，也只需要打包该文件夹即可</span><br><span class="line">JENKINS_JAVA_CMD=&quot;&quot;</span><br><span class="line">JENKINS_USER=&quot;jenkins&quot;                                # 启动用户</span><br><span class="line">JENKINS_JAVA_OPTIONS=&quot;-Djava.awt.headless=true&quot;</span><br><span class="line">JENKINS_PORT=&quot;8080&quot;                                         # 启动端口，可以改</span><br><span class="line">JENKINS_LISTEN_ADDRESS=&quot;&quot;                          # 监听地址</span><br><span class="line">JENKINS_HTTPS_PORT=&quot;&quot;</span><br><span class="line">JENKINS_HTTPS_KEYSTORE=&quot;&quot;</span><br><span class="line">JENKINS_HTTPS_KEYSTORE_PASSWORD=&quot;&quot;</span><br><span class="line">JENKINS_HTTPS_LISTEN_ADDRESS=&quot;&quot;</span><br><span class="line">JENKINS_DEBUG_LEVEL=&quot;5&quot;</span><br><span class="line">JENKINS_ENABLE_ACCESS_LOG=&quot;no&quot;</span><br><span class="line">JENKINS_HANDLER_MAX=&quot;100&quot;</span><br><span class="line">JENKINS_HANDLER_IDLE=&quot;20&quot;</span><br><span class="line">JENKINS_ARGS=&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="修改jenkins时区"><a href="#修改jenkins时区" class="headerlink" title="修改jenkins时区"></a>修改jenkins时区</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">打开jenkins的【系统管理】---&gt; 【脚本命令行】</span><br><span class="line">在命令框中输入一下命令【时间时区设为 亚洲上海】</span><br><span class="line"></span><br><span class="line">System.setProperty(&#x27;org.apache.commons.jelly.tags.fmt.timeZone&#x27;, &#x27;Asia/Shanghai&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327165046301.png" alt="image-20200327165046301"></p>
<h2 id="Jenkins创建job"><a href="#Jenkins创建job" class="headerlink" title="Jenkins创建job"></a>Jenkins创建job</h2><p>构建作业是一个持续集成服务器的基本职能，构建的形式多种多样，可以是编译和单元测试，也可能是打包及部署，或者是其他类似的作业。在 Jenkins 中，构建作业很容 易建立，而且根据你的需要你可以安装各种插件，来创建多种形式的构建作业，下面我们先来学习创建自由式构建作业。</p>
<p>自由式的构建作业是最灵活和可配置的选项，并且可以用于任何类型的项目，它的配置 相对简单，其中很多配置在的选项也会用在其他构建作业中。</p>
<p>在 Jenkins 主页面，点击左侧菜单栏的“新建”或者“New job”</p>
<h3 id="freestyle-job介绍"><a href="#freestyle-job介绍" class="headerlink" title="freestyle-job介绍"></a>freestyle-job介绍</h3><ul>
<li>自由风格项目，比较灵活，可以构建任何形式的项目</li>
<li>在页面添加模块配置与参数</li>
<li>每个job仅能实现一个开发功能</li>
<li>无法将配置代码化，不利于Job配置迁移和版本控制</li>
<li>学习相对简单</li>
</ul>
<h3 id="Jenkins创建freestyle项目"><a href="#Jenkins创建freestyle项目" class="headerlink" title="Jenkins创建freestyle项目"></a>Jenkins创建freestyle项目</h3><p><img src="pic/image-20200709173420208.png" alt="image-20200709173420208"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.输入任务名字，job名字，定义一个有意义的名字，根据业务命名</span><br><span class="line">注意，一旦确定job名字，就不要轻易修改了，jenkins一切皆文件</span><br><span class="line">job名字已经被写入各种配置了，生成一系列的文件，文件夹</span><br><span class="line"></span><br><span class="line">[root@m01 jobs]# pwd</span><br><span class="line">/var/lib/jenkins/jobs</span><br><span class="line">[root@m01 jobs]# ls</span><br><span class="line">My-freestyle-job</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果你修改了文件夹，这里会生成一个新的job文件夹配置，数据目录就会紊乱出错</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200709173734617.png" alt="image-20200709173734617"></p>
<p>勾选“丢弃旧的构建”，这是我们必须提前考虑的重要方面，就是我们如何处理构建历史，构建作业会消耗大理的磁盘空间，尤其是你存储的构建产物(比如执行 java 构建时会 生成的 JAR、WAR 等)。</p>
<p><img src="pic/image-20200709174146102.png" alt="image-20200709174146102"></p>
<p>选项允许你限制在构建历史记录的作业数。你可以告诉 Jenkins 只保留最近的几次构 建，或者只保留指定数量的构建，此外，Jenkins 永远不会删除最后一个稳定和成功的构建。 具体数据的指定要根据你项目的实际情况而定，我一般设置为 5、5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">丢弃旧的构建</span><br><span class="line">如果项目特别多，文件大，会造成jenkins数据目录过大，特别是编译类型的项目</span><br><span class="line">    保持构建5天</span><br><span class="line">    保留构建最大个数5个 </span><br><span class="line"></span><br><span class="line">构建触发器</span><br><span class="line">    手动构建</span><br><span class="line">    定义触发器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">构建环境</span><br><span class="line"></span><br><span class="line">构建</span><br><span class="line">    执行一系列的操作</span><br><span class="line">    Execute shell</span><br><span class="line">        执行linux命令</span><br></pre></td></tr></table></figure>

<h3 id="Execute-shell执行命令、脚本"><a href="#Execute-shell执行命令、脚本" class="headerlink" title="Execute shell执行命令、脚本"></a>Execute shell执行命令、脚本</h3><p>我们通过几个示例来学习具体的配置。</p>
<p><img src="pic/image-20200709175921012.png" alt="image-20200709175921012"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看jenkins执行命令，是在哪个目录操作的</span><br></pre></td></tr></table></figure>

<p>保存设置后，回退到job主页面，可以进行job运行。</p>
<h4 id="执行job立即构建"><a href="#执行job立即构建" class="headerlink" title="执行job立即构建"></a>执行job立即构建</h4><p>点击立即构建，即可执行job的任务，我们定义的构建动作是，执行shell命令</p>
<p><img src="pic/image-20200326215214570.png" alt="image-20200326215214570"></p>
<p>jenkins-job主页面</p>
<p><img src="pic/image-20200709180211044.png" alt="image-20200709180211044"></p>
<h4 id="构建结果日志"><a href="#构建结果日志" class="headerlink" title="构建结果日志"></a>构建结果日志</h4><p><img src="pic/image-20200709180349918.png" alt="image-20200709180349918"></p>
<p>在上面的控制台输出内容中，我们可以看job执行时的当前工作目录是<code>jenkins主目录+workspaces+job名称</code>定义的目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># jenkins执行job的工作目录</span><br><span class="line">/var/lib/jenkins/workspace/My-freestyle-job</span><br><span class="line"></span><br><span class="line"># 由于仅仅是执行pwd，没有任何文件生成，若是对代码构建，源代码就是下载到了这里</span><br><span class="line">[root@m01 workspace]# pwd</span><br><span class="line">/var/lib/jenkins/workspace</span><br><span class="line">[root@m01 workspace]# ls</span><br><span class="line">My-freestyle-job</span><br><span class="line"></span><br><span class="line"># job目录</span><br><span class="line">[root@m01 My-freestyle-job]# pwd</span><br><span class="line">/var/lib/jenkins/jobs/My-freestyle-job</span><br><span class="line"># job的构建记录 都在这里了，所有构建记录都以文件形式记录下了</span><br><span class="line">[root@m01 My-freestyle-job]# ls</span><br><span class="line">builds  config.xml  lastStable  lastSuccessful  nextBuildNumber</span><br></pre></td></tr></table></figure>

<h4 id="增加一个构建动作"><a href="#增加一个构建动作" class="headerlink" title="增加一个构建动作"></a>增加一个构建动作</h4><p><img src="pic/image-20200326223329631.png" alt="image-20200326223329631"><img src="pic/image-20200326223420825.png" alt="image-20200326223420825"></p>
<p><img src="pic/image-20200326223420825-163653701349622.png" alt="image-20200326223420825"></p>
<p><img src="pic/image-20200326223606562.png" alt="image-20200326223606562"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">job的执行结果，创建了一个文件，在当前job的workspace里</span><br><span class="line">[root@m01 My-freestyle-job]# pwd</span><br><span class="line">/var/lib/jenkins/workspace/My-freestyle-job</span><br><span class="line">[root@m01 My-freestyle-job]# ls</span><br><span class="line">readme.chaoge</span><br></pre></td></tr></table></figure>

<p>在jenkisn站点检查工作空间</p>
<p><img src="pic/image-20200326224547980.png" alt="image-20200326224547980"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如运维可以使用jenkins的job功能，给其他不懂linux命令的同事，通过一键点击，就能够执行linux命令</span><br><span class="line">例如服务重启等</span><br><span class="line">可以有效的防止不懂linux的技术人员，在服务器上做奇怪的操作</span><br></pre></td></tr></table></figure>

<h1 id="Jenkins连接gitlab获取代码"><a href="#Jenkins连接gitlab获取代码" class="headerlink" title="Jenkins连接gitlab获取代码"></a>Jenkins连接gitlab获取代码</h1><p>既然是持续集成，对代码进行构建，我们得获取代码仓库的内容，这里选择我们搭建的gitlab服务器</p>
<h2 id="友情提醒"><a href="#友情提醒" class="headerlink" title="友情提醒"></a><strong>友情提醒</strong></h2><p><strong>1.在自己虚拟机做实验，若是gitlab，jenkins运行在一台服务器，内存需要给大一点，该两个服务非常吃内存</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3725        2229         221          61        1274        1149</span><br><span class="line">Swap:          2047           0        2047</span><br></pre></td></tr></table></figure>

<p><strong>2.jenkins会和gitlab冲突端口，8080，修改jenkins端口来的方便</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 ~]# grep 9080 /etc/sysconfig/jenkins</span><br><span class="line">JENKINS_PORT=&quot;9080&quot;</span><br><span class="line"></span><br><span class="line">重启jenkins</span><br><span class="line">[root@lb02 ~]# systemctl restart jenkins</span><br></pre></td></tr></table></figure>

<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>1.服务配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.启动gitlab，且检查</span><br><span class="line">[root@lb02 ~]# gitlab-ctl restart/status </span><br><span class="line"></span><br><span class="line">2.启动jenkins，且检查</span><br><span class="line">[root@lb02 ~]# systemctl start/status jenkins</span><br></pre></td></tr></table></figure>

<p>2.访问服务</p>
<p>Jenkins</p>
<p><img src="pic/image-20200713101418634.png" alt="image-20200713101418634"></p>
<p>Gitlab</p>
<p><img src="pic/image-20200713101447827.png" alt="image-20200713101447827"></p>
<h2 id="配置jenkins结合gitlab"><a href="#配置jenkins结合gitlab" class="headerlink" title="配置jenkins结合gitlab"></a>配置jenkins结合gitlab</h2><p>在gitlab上复制仓库地址</p>
<p><img src="pic/image-20200713110201084.png" alt="image-20200713110201084"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git@172.20.0.51:chaochao/learn_gitlab.git</span><br></pre></td></tr></table></figure>

<p>在jenkins上找到job配置页面，下拉倒<code>源码管理</code>，勾选git管理</p>
<p><img src="pic/image-20200713110238290.png" alt="image-20200713110238290"></p>
<p>这里提示是该jenkins服务器，<code>git</code>安装有问题，可以做如下操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install git -y</span><br></pre></td></tr></table></figure>

<p>安装完毕git后，刷新jenkins页面，看到如下结果</p>
<p><img src="pic/image-20200713110619886.png" alt="image-20200713110619886"></p>
<p>这里新的报错是因为key认证失败，是因为我们选择的协议是ssh方式，还得配置ssh认证，我们在学习gitlab的时候，配置过客户端机器的ssh-key，为什么这里还需要认证，我们看下jenkins启动的用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 ~]# ps -ef|grep jenkins</span><br><span class="line">jenkins    7206      1 10 10:59 ?        00:00:52 /etc/alternatives/java -Dcom.sun.akuma.Daemon=daemonized -Djava.awt.headless=true -DJENKINS_HOME=/var/lib/jenkins -jar /usr/lib/jenkins/jenkins.war --logfile=/var/log/jenkins/jenkins.log --webroot=/var/cache/jenkins/war --daemon --httpPort=9080 --debug=5 --handlerCountMax=100 --handlerCountMaxIdle=20</span><br></pre></td></tr></table></figure>

<p>该jenkins进程是jenkins用户启动的，而我们gitlab配置的ssh-key是root用户连接，还得重新再添加ssh-key</p>
<h2 id="jenkins添加gitlab认证"><a href="#jenkins添加gitlab认证" class="headerlink" title="jenkins添加gitlab认证"></a>jenkins添加gitlab认证</h2><p><img src="pic/image-20200713111021726.png" alt="image-20200713111021726"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1.先在jenkins服务器上生成ssh-key密钥对</span><br><span class="line">[root@lb02 ~]# ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:RSQnEbaLTtE8IO/tZGraDx1yMu7s98HvupV3tIQK2fg root@lb02</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|    . . *++      |</span><br><span class="line">|     o = *       |</span><br><span class="line">|      o = .      |</span><br><span class="line">|     . + ++   .  |</span><br><span class="line">|      B S+ . . ..|</span><br><span class="line">|     + @ oo .....|</span><br><span class="line">|      * o oEo ...|</span><br><span class="line">|     * ..  + . . |</span><br><span class="line">|    ..=o..++o    |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">[root@lb02 ~]# cat ~/.ssh/id_rsa.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDK7oK32itYWvGv0UuQZ4nj+eHI++scL4qlzlKlH0A52Fr24vYO5RMTlcINHcMBUAgF8j4KIvB7jngCvfToypM9YSajKwTtCmmFHR7gXg3NbszWJn0jm0y32gIiTX0UQXxaPFohz+rMKB3ts+bl4ryyHarSUrnJ5dVJBpE5RD/mLiqLCyUJlJ+lZjNjNEok4tqZrn+Gi21fZFidwFiOr74RCZVgT4LarYkOaYpeX/v3HYQIzA4E4Y7khFIW525wuA7r/weus+2lfmtCMVUoq81C9pFyEDSrOA9P/Ejsv2AhDHU8eCnfpF/mnZ1KZIYgou9TfS0c3KIFq4mrZCkS+bGB root@lb02</span><br></pre></td></tr></table></figure>

<p>2.复制粘贴该密钥，到gitlab</p>
<p><img src="pic/image-20200713111340479.png" alt="image-20200713111340479"></p>
<p>由于jenkins服务还是普通用户在运行，我们给改为root用户，提升权限，编辑配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 ~]# grep -i &quot;_USER&quot; /etc/sysconfig/jenkins</span><br><span class="line">JENKINS_USER=&quot;root&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 重启服务，且查看</span><br><span class="line">[root@lb02 ~]# systemctl restart jenkins</span><br><span class="line">[root@lb02 ~]# ps -ef|grep jenkins</span><br><span class="line">root      10772      1 99 11:19 ?        00:00:08 /etc/alternatives/java -Dcom.sun.akuma.Daemon=daemonized -Djava.awt.headless=true -DJENKINS_HOME=/var/lib/jenkins -jar /usr/lib/jenkins/jenkins.war --logfile=/var/log/jenkins/jenkins.log --webroot=/var/cache/jenkins/war --daemon --httpPort=9080 --debug=5 --handlerCountMax=100 --handlerCountMaxIdle=20</span><br></pre></td></tr></table></figure>

<p>3.还得配置gitlab服务器的ssh-key认证</p>
<p><img src="pic/image-20200713112353725.png" alt="image-20200713112353725"></p>
<p>4.此时看不到任何报错了</p>
<p><img src="pic/image-20200713112434353.png" alt="image-20200713112434353"></p>
<h2 id="启动该job，立即构建"><a href="#启动该job，立即构建" class="headerlink" title="启动该job，立即构建"></a>启动该job，立即构建</h2><p><img src="pic/image-20200713112640931.png" alt="image-20200713112640931"></p>
<h2 id="控制台查看详细日志"><a href="#控制台查看详细日志" class="headerlink" title="控制台查看详细日志"></a>控制台查看详细日志</h2><p><img src="pic/image-20200713112846851.png" alt="image-20200713112846851"></p>
<p>查看jenkins的job工作区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">已经是下载完毕了代码</span><br><span class="line">[root@lb02 My-freestyle-job]# pwd</span><br><span class="line">/var/lib/jenkins/workspace/My-freestyle-job</span><br><span class="line">[root@lb02 My-freestyle-job]# ls</span><br><span class="line">chaoge666.txt  dev.txt  push_code.txt</span><br></pre></td></tr></table></figure>

<h2 id="获取gitlab分支代码"><a href="#获取gitlab分支代码" class="headerlink" title="获取gitlab分支代码"></a>获取gitlab分支代码</h2><p>该操作可以用于构建测试环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.在dev分支推送新的代码记录</span><br><span class="line">[root@lb02 code]# git clone git@172.20.0.51:chaochao/learn_gitlab.git</span><br><span class="line">[root@lb02 code]# cd learn_gitlab/</span><br><span class="line">[root@lb02 learn_gitlab]# git branch</span><br><span class="line">* master</span><br><span class="line">[root@lb02 learn_gitlab]# git checkout -b dev</span><br><span class="line">切换到一个新分支 &#x27;dev&#x27;</span><br><span class="line"></span><br><span class="line">[root@lb02 learn_gitlab]# echo &quot;我是dev分支，超哥开发的新功能代码&quot; &gt; dev_code.txt</span><br><span class="line">[root@lb02 learn_gitlab]# git add .</span><br><span class="line">[root@lb02 learn_gitlab]# git commit -m &quot;add code.txt by dev.&quot;</span><br><span class="line"></span><br><span class="line">[root@lb02 learn_gitlab]# git remote -v</span><br><span class="line">origin    git@172.20.0.51:chaochao/learn_gitlab.git (fetch)</span><br><span class="line">origin    git@172.20.0.51:chaochao/learn_gitlab.git (push)</span><br><span class="line"></span><br><span class="line"># 提送到dev分支</span><br><span class="line">[root@lb02 learn_gitlab]# git push -u origin dev</span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 352 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote:</span><br><span class="line">remote: To create a merge request for dev, visit:</span><br><span class="line">remote:   http://172.20.0.51/chaochao/learn_gitlab/merge_requests/new?merge_request%5Bsource_branch%5D=dev</span><br><span class="line">remote:</span><br><span class="line">To git@172.20.0.51:chaochao/learn_gitlab.git</span><br><span class="line">   3e88004..c3f90ab  dev -&gt; dev</span><br><span class="line">分支 dev 设置为跟踪来自 origin 的远程分支 dev。</span><br></pre></td></tr></table></figure>

<p>查看gitlab代码仓库，dev分支内容</p>
<p><img src="pic/image-20200713113715916.png" alt="image-20200713113715916"></p>
<p>jenkins获取dev分支代码</p>
<p><img src="pic/image-20200713113802579.png" alt="image-20200713113802579"></p>
<p>jenkins获取具体commit记录代码</p>
<p><img src="pic/image-20200713114023778.png" alt="image-20200713114023778"></p>
<h1 id="持续集成介绍"><a href="#持续集成介绍" class="headerlink" title="持续集成介绍"></a>持续集成介绍</h1><p>1.持续集成</p>
<ul>
<li>让产品可以快速迭代，同时还能保持高质量，简化工作流程。</li>
</ul>
<p>2.持续交付</p>
<ul>
<li>让测试通过后的代码，可以准备用于部署</li>
<li>持续交付，重复前者所有的操作。</li>
</ul>
<p>3.持续部署</p>
<ul>
<li>基于交付集成之上，无论何时，代码都确保可以部署，且是自动化的。</li>
</ul>
<p>4.持续集成实现的思路（git、jenkins、shell）</p>
<p>5.版本控制系统</p>
<ul>
<li>将文件的每一次变化，集中在一个系统中加以版本记录，以便后续查阅文件的历史记录。</li>
</ul>
<p><strong>版本控制系统</strong></p>
<ul>
<li>常见版本控制系统<ul>
<li>SVN ，集中式</li>
<li>Git，分布式</li>
</ul>
</li>
<li>git版本控制<ul>
<li>基本使用</li>
<li>git与github关联</li>
</ul>
</li>
<li>代码托管平台<ul>
<li>github</li>
<li>gitlab<ul>
<li>配置域名</li>
<li>配置邮箱</li>
<li>gitlab基本使用</li>
<li>gitlab的用户组、用户、项目</li>
<li>gitlab基本运维、备份、恢复</li>
</ul>
</li>
</ul>
</li>
<li>jenkins<ul>
<li>jenkins是什么，干什么的，为什么要学它</li>
<li>jenkins安装、汉化</li>
<li>jenkins插件、加速插件、安装插件、导入本地插件</li>
<li>jenkins项目创建，自由风格项目，以及jenkins-shell</li>
<li>jenkins+gitlab</li>
<li>手动搭建一套集群环境，然后实现代码上线</li>
<li>jenkins构建项目，html，php</li>
<li>jenkins构建项目脚本开发，部署、回滚</li>
<li>jenkins构建Java项目，编译、部署（jar，war）</li>
<li>jenkins通知功能<ul>
<li>邮件</li>
<li>钉钉</li>
</ul>
</li>
<li>拿到源代码后，对源码进行质量扫描<ul>
<li>SonarQube<ul>
<li>安装</li>
<li>手动推代码至Sonarqube测试</li>
<li>jenkins集成SOnarqube</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>jenkins流水线pipeline<ul>
<li>pipeline语法</li>
<li>pipeline实现html项目流水线部署</li>
<li>pipeline实现java项目流水线部署</li>
</ul>
</li>
<li>jenkins分布式构建</li>
<li>jenkins权限控制</li>
</ul>
<p><strong>什么是集成</strong></p>
<p>在实际软件开发中，常会有如下两种场景：</p>
<p>1.现在有一个电商平台需要开发，由于电商平台模块众多，此时就需要不同开发人员开发不同的模块，最红把所有人的代码都集中到一个系统中。集成后对其进行部署上线。</p>
<p>2.随着时间的推移，无论是修复bug还是新功能开发，后续都要对系统进行不断的更新、迭代。</p>
<p><img src="pic/image-20200706111309218.png" alt="image-20200706111309218"></p>
<p><strong>什么是持续集成（CI）</strong></p>
<p>持续集成（Continuous integration ，CI）</p>
<p>持续集成就是在于”持续“两字，频繁的（一天多次）的将代码集成到主干(master)，重复如上的工作。</p>
<p><img src="pic/image-20200706111723922.png" alt="image-20200706111723922"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">程序员</span><br><span class="line">    ↓推代码</span><br><span class="line">git仓库，gitlab</span><br><span class="line">    ↓仓库通知CI服务器，jenkins</span><br><span class="line">jenkins执行脚本，如对代码编译，测试，运行</span><br><span class="line">    ↓通知集成结果</span><br><span class="line">程序员对结果处理</span><br></pre></td></tr></table></figure>

<p><strong>使用持续集成好处</strong></p>
<p>1.快速发现错误，每完成一点更新，就集成到主干，可以快速发现bug，也容易定位错误。</p>
<p>2.节省人力成本，省去手动反复部署操作</p>
<p>3.加快软件开发进程</p>
<p>4.实时交付</p>
<p>5.防止大幅度偏离主干，如果不经常集成，主干也在更新，会导致后续集成难度增大，或是难以集成。</p>
<p><strong>使用持续集成目的</strong></p>
<p>让产品可以快速迭代，同时还能保持高质量。（程序员写了新功能，很可能有bug，快速进行jenkins集成测试，能够快速发现bug，定位、解决bug，再次集成操作，整个过程自动化，非常高效且省时省力）</p>
<p>持续集成核心目的：代码集成到主干之前，对代码进行自动化测试。只要有一个测试用例失败，就不能集成，当然持续集成并不能完全的消除bug，主要目的是让bug更容易发现和改正。</p>
<p><strong>什么情况需要持续集成</strong></p>
<p>如果项目开发的规模较小，软件集成不是问题。</p>
<p>如果项目很大，需要不断添加新功能，或不断的升级产品，则需要进行反复集成，因此必须使用持续集成来简化工作。</p>
<h2 id="持续交付（CD）"><a href="#持续交付（CD）" class="headerlink" title="持续交付（CD）"></a>持续交付（CD）</h2><p>Continuous Delivery</p>
<p>交付，产品从开始到结束诞生的产物，在服务器上健康运行。</p>
<p>持续交付指的是在持续集成的环境基础之上，将代码部署到预生产环境。</p>
<ul>
<li>持续集成对代码进行集成测试</li>
<li>持续交付，对代码进行部署</li>
</ul>
<p><strong>持续交付过程</strong></p>
<p><img src="pic/image-20200706113538981.png" alt="image-20200706113538981"></p>
<ul>
<li>代码开发<ul>
<li>开发自己单元测试</li>
</ul>
</li>
<li>代码合并到主干</li>
<li>测试人员介入，功能测试、自动化测试</li>
<li>代码进行生产部署，jenkins一键自动化部署</li>
</ul>
<p>持续部署(CD)</p>
<p>Continuous Deployment</p>
<p>持续部署是持续交付的下一步，指代码在任何时刻都是可部署的，最后将部署到生产环境的过程自动化。</p>
<p>持续部署和持续交付的区别就在于最终部署到生产环境<code>是自动化的</code>。</p>
<p><strong>持续部署过程</strong></p>
<p><img src="pic/image-20200706133434092.png" alt="image-20200706133434092"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当有人提交了代码，就自动的通知jenkins对代码进行构建 &gt; 测试 &gt; 确认代码可运行  &gt; 构建到生产服务器 </span><br><span class="line">整个过程全自动化，但是有可能出现难以预料的问题</span><br><span class="line">最好的是半自动化，使用持续交付</span><br></pre></td></tr></table></figure>

<h2 id="持续集成实施流程"><a href="#持续集成实施流程" class="headerlink" title="持续集成实施流程"></a>持续集成实施流程</h2><p>根据持续集成的设计，代码从提交到进入生产环境，整个过程如下：</p>
<p><img src="pic/image-20200706134430359.png" alt="image-20200706134430359"></p>
<p>jenkins本身没有太多功能，但是支持丰富的插件，进行调度，完成工作。</p>
<h2 id="关于版本控制"><a href="#关于版本控制" class="headerlink" title="关于版本控制"></a>关于版本控制</h2><p>什么是“版本控制”？我为什么要关心它呢？ 版本控制是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。</p>
<p><strong>本地版本控制系统</strong></p>
<p>许多人习惯用复制整个项目目录的方式来保存不同的版本，或许还会改名加上备份时间以示区别。 这么做唯一的好处就是简单，但是特别容易犯错。 有时候会混淆所在的工作目录，一不小心会写错文件或者覆盖意想外的文件。</p>
<p>如果你在学校写过毕业论文，那你一定遇见过这样的问题</p>
<p><img src="pic/image-20200706140045980.png" alt="image-20200706140045980"></p>
<p>一个论文翻来覆去的改，写一点觉得有问题，写一点还觉得有问题，还不容易写好了，导师还挑刺，说这改的还不如上回，给改回去、、、</p>
<p><img src="pic/image-20200706140059421.png" alt="image-20200706140059421"></p>
<ul>
<li><strong>看着这一堆乱七八糟的文件，你自己也不记得，每一个文件到底写了什么内容，还得一个个看，想删又不敢删。。。</strong></li>
<li><strong>当你写完了毕业论文，你还得用U盘拷给导师，或者发个邮件给他，但是你回家可能还得改论文，那你发给导师的论文和你本地最新的论文又不一致了。。</strong></li>
</ul>
<p><strong>于是这么多令人fuck指的操作，你就希望有没有一个软件，帮你记录文件变动的操作，并且同事还能一起操作，不需要自己传输文件，想知道变动了什么，只需要去软件里看看，这是不是很nb？</strong></p>
<p><strong>这个软件雏形？</strong></p>
<p>对于文件使用版本号，日期的管理，这种方式比起没有版本管理好得多，但是也很臃肿，且他人不容易看得懂</p>
<table>
<thead>
<tr>
<th>版本</th>
<th>文件名</th>
<th>用户</th>
<th>说明</th>
<th>日期</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>美国皇家大学毕业论文v1.doc</td>
<td>yuchao</td>
<td>论文初稿</td>
<td>7/12 10:38</td>
</tr>
<tr>
<td>2</td>
<td>美国皇家大学毕业论文v2.doc</td>
<td>yuchao</td>
<td>论文修改版</td>
<td>7/12 18:09</td>
</tr>
<tr>
<td>3</td>
<td>美国皇家大学毕业论文v3.doc</td>
<td>Onlyu</td>
<td>小于帮我修改论文</td>
<td>7/13 9:51</td>
</tr>
<tr>
<td>4</td>
<td>美国皇家大学毕业论文v4.doc</td>
<td>Wupeiqi</td>
<td>武沛奇帮我修改论文</td>
<td>7/14 15:17</td>
</tr>
</tbody></table>
<p><strong>新式版本控制</strong></p>
<p>现在的版本控制系统又是如何管理的，且还能实现快速回退功能。</p>
<p><img src="pic/image-20200706141239759.png" alt="image-20200706141239759"></p>
<p><strong>版本控制系统解决了什么问题</strong></p>
<p>1.追溯文件历史变更记录</p>
<p>2.多人团队协同开发</p>
<p>3.代码集中统一管理</p>
<h2 id="Git工具"><a href="#Git工具" class="headerlink" title="Git工具"></a>Git工具</h2><p><img src="pic/image-20200706142149787.png" alt="image-20200706142149787"></p>
<p><img src="pic/image-20200706142200211.png" alt="image-20200706142200211"></p>
<p><img src="pic/image-20200706142213781.png" alt="image-20200706142213781"></p>
<p><strong>集中式和分布式版本控制</strong></p>
<p>Linus一直痛恨的CVS及SVN都是集中式的版本控制系统，而Git是分布式版本控制系统，集中式和分布式版本控制系统有什么区别呢？</p>
<p>先说集中式版本控制系统，版本库是集中存放在中央服务器的，而干活的时候，用的都是自己的电脑，所以要先从中央服务器取得最新的版本，然后开始干活，干完活了，再把自己的活推送给中央服务器。中央服务器就好比是一个图书馆，你要改一本书，必须先从图书馆借出来，然后回到家自己改，改完了，再放回图书馆。</p>
<p><img src="pic/image-20200706142259460.png" alt="image-20200706142259460"></p>
<p>集中式版本控制，典型代表SVN</p>
<p>集中式版本控制系统最大的毛病就是必须联网才能工作，如果在局域网内还好，带宽够大，速度够快，可如果在互联网上，遇到网速慢的话，可能提交一个10M的文件就需要5分钟，这还不得把人给憋死啊。</p>
<p><strong>而且如果集中式版本服务器宕机了，所有人都没法工作。</strong></p>
<p><img src="pic/image-20200706142336822.png" alt="image-20200706142336822"></p>
<p><strong>分布式版本控制</strong></p>
<p>分布式版本控制，没有中央服务器的概念，每个人都有自己的版本库，因此每个人在工作时候，<strong>不需要联网，版本库本地即可管理。</strong></p>
<p>既然每个人都是一个完整的版本库，同事之间如果需要协作开发，就需要找一个用于“交换文件”的中央服务器，这个服务器不存在也不影响大家干活，只是用于交换文件内容。</p>
<p>GIT最强大的功能还有分支管理，远甩SVN等软件。</p>
<p><img src="pic/image-20200706142430538.png" alt="image-20200706142430538"></p>
<p><img src="pic/image-20200706142441716.png" alt="image-20200706142441716"></p>
<p><img src="pic/image-20200706142457030.png" alt="image-20200706142457030"></p>
<h1 id="Git工具-1"><a href="#Git工具-1" class="headerlink" title="Git工具"></a>Git工具</h1><p><strong>命令行</strong></p>
<p>Git有多种方式使用</p>
<ul>
<li>原生命令行，才能使用git所有命令，会git命令再去用gui图形工具，完全无压力</li>
<li>GUI图形软件，只是实现了git的部分功能，以减免操作难度，难以记住git原生命令</li>
<li>不同的人会有不同的GUI图形工具，但是所有人用的git原生命令都一样，推荐学习命令</li>
</ul>
<p><strong>Windows安装</strong></p>
<p>在Windows上使用Git，可以从Git官网直接<a target="_blank" rel="noopener" href="https://git-scm.com/downloads">下载安装程序</a>，然后按默认选项安装即可。</p>
<p>安装完成后，在开始菜单里找到“Git”-&gt;“Git Bash”，蹦出一个类似命令行窗口的东西，就说明Git安装成功！</p>
<p><strong>在 Mac 上安装</strong></p>
<p>在mac安装git方式很多，最简单是用brew包管理</p>
<p>安装homebrew，然后通过homebrew安装Git，具体方法请参考homebrew的文档：<a target="_blank" rel="noopener" href="http://brew.sh/%E3%80%82">http://brew.sh/。</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install git</span><br></pre></td></tr></table></figure>

<p>如果你想安装更新的版本，可以使用二进制安装程序。 官方维护的 OSX Git 安装程序可以在 Git 官方网站下载，网址为 <a target="_blank" rel="noopener" href="http://git-scm.com/download/mac%E3%80%82">http://git-scm.com/download/mac。</a></p>
<p><strong>在 Linux 上安装</strong></p>
<p>如果你想在 Linux 上用二进制安装程序来安装 Git，可以使用发行版包含的基础软件包管理工具来安装。 如果以Centos 上为例，你可以使用 yum：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install git</span><br></pre></td></tr></table></figure>

<p>如果你在基于 Debian 的发行版上，请尝试用 apt-get：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>

<p>环境准备</p>
<p>准备好一台linux机器，且进行环境初始化，主机名、配置yum源、安装基础软件包、关闭防火墙、同步系统时间等。</p>
<p>安装git</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@chaogelinux ~]# yum install git -y</span><br><span class="line"></span><br><span class="line">[root@chaogelinux ~]# git --version</span><br><span class="line">git version 1.8.3.1</span><br></pre></td></tr></table></figure>

<h2 id="运行git前的配置"><a href="#运行git前的配置" class="headerlink" title="运行git前的配置"></a>运行git前的配置</h2><p>既然已经在系统上安装了 Git，你会想要做几件事来定制你的 Git 环境。 每台计算机上只需要配置一次，程序升级时会保留配置信息。 你可以在任何时候再次通过运行命令来修改它们。</p>
<p>回顾linux用户的概念</p>
<blockquote>
<p>linux多用户，多任务</p>
<p>一台机器可以有多个用户登录，同时操作</p>
<p>因此就存在了不同的环境变量，用来区分，每个登录linux机器的用户</p>
<p>比如root用户的信息，在ls -a /root/</p>
<p>普通yuchao用户的信息，在 ls -a /home/yuchao</p>
<p>不同的用户登录后，linux加载不同的环境变量参数，对系统控制</p>
</blockquote>
<p>Git 自带一个 <code>git config</code> 的工具来帮助设置控制 Git 外观和行为的配置变量。 这些变量存储在三个不同的位置：</p>
<p><strong>这个用户指的是linux用户</strong></p>
<p>三种环境参数</p>
<ul>
<li><strong>–system</strong></li>
<li><strong>–global</strong></li>
<li><strong>–local</strong></li>
<li><code>/etc/gitconfig</code> 文件: 包含系统上每一个用户及他们仓库的通用配置。 如果使用带有 <code>--system</code> 选项的 <code>git config</code> 时，它会从此文件读写配置变量。(针对任意登录该linux的用户都生效)</li>
<li><code>~/.gitconfig</code> 或 <code>~/.config/git/config</code> 文件：只针对当前用户。 可以传递 <code>--global</code> 选项让 Git 读写此文件。(只针对当前登录系统的用户生效)</li>
<li>当前使用仓库的 Git 目录中的 <code>config</code> 文件（就是 <code>.git/config</code>）：针对该仓库。 <code>--local</code> 当前仓库配置。（只针对某一个文件夹生效，例如/learn/linux/.git/config）</li>
</ul>
<h3 id="用户信息配置"><a href="#用户信息配置" class="headerlink" title="用户信息配置"></a>用户信息配置</h3><p>通常配置git，只需要配置好你是谁，你的邮箱，这样就知道是谁在提交代码了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &quot;Only yu&quot;</span><br><span class="line">$ git config --global user.email &quot;yc_uuu@163.com&quot;</span><br><span class="line">$ git config --global color.ui true</span><br><span class="line"></span><br><span class="line">我们这里配置的是--global参数，因此是在用户家目录下，可以查看</span><br><span class="line">[root@chaogelinux ~]# cat .gitconfig</span><br><span class="line">[user]</span><br><span class="line">    name = pyyu</span><br><span class="line">    email = yc_uuu@163.com</span><br><span class="line">[color]</span><br><span class="line">    ui = true</span><br></pre></td></tr></table></figure>

<h3 id="Git配置相关命令"><a href="#Git配置相关命令" class="headerlink" title="Git配置相关命令"></a>Git配置相关命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yum install git -y  安装git</span><br><span class="line"></span><br><span class="line">git --version　　查看git版本</span><br><span class="line"></span><br><span class="line">git config --system --list 查看系统所有linux用户的通用配置,此命令检查/etc/gitconfig</span><br><span class="line"></span><br><span class="line">git config --global --list 查看当前linux用户的配置，检查~/.gitconfig文件</span><br><span class="line"></span><br><span class="line">git config --local --list 查看git目录中的仓库配置文件，.git/config文件</span><br><span class="line"></span><br><span class="line">git config --global user.name &quot;pyyu&quot;　　配置当前linux用户全局用户名，这台机器所有git仓库都会用这个配置</span><br><span class="line"></span><br><span class="line">git config --global user.email &quot;yc_uuu@163.com&quot;  配置当前linux用户全局邮箱</span><br><span class="line"></span><br><span class="line">git config --global color.ui true 配置git语法高亮显示</span><br><span class="line"></span><br><span class="line">git config --list 列出git能找到的所有配置,从不同的文件中读取所有结果</span><br><span class="line"></span><br><span class="line">git config user.name　　列出git某一项配置</span><br><span class="line"></span><br><span class="line">git help 获取git帮助</span><br><span class="line"></span><br><span class="line">man git man手册</span><br><span class="line"></span><br><span class="line">git help config 获取config命令的手册</span><br></pre></td></tr></table></figure>

<h1 id="Git工作流程"><a href="#Git工作流程" class="headerlink" title="Git工作流程"></a>Git工作流程</h1><h2 id="Git四个区域"><a href="#Git四个区域" class="headerlink" title="Git四个区域"></a>Git四个区域</h2><p>使用git就是将本地文件（工作目录workspace）的文件，添加到暂存区（stage）,然后提交到本地仓库（repository），最终可以协同开发，推送到远程仓库（remote）。</p>
<p><img src="pic/image-20200706152248954.png" alt="image-20200706152248954"></p>
<h2 id="Git实践"><a href="#Git实践" class="headerlink" title="Git实践"></a>Git实践</h2><p>git版本库，也叫做git仓库（repository），也就是一个文件夹。</p>
<p>这个目录的所有内容被git软件管理，所有的修改，删除，git都会跟踪记录，便于可以跟踪历史记录，以后可以还原文件。</p>
<h3 id="三种场景需求："><a href="#三种场景需求：" class="headerlink" title="三种场景需求："></a>三种场景需求：</h3><h4 id="1-把已有的项目代码，纳入git管理"><a href="#1-把已有的项目代码，纳入git管理" class="headerlink" title="1.把已有的项目代码，纳入git管理"></a>1.把已有的项目代码，纳入git管理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd mysite    mysite项目所在代码</span><br><span class="line">git init        初始化git仓库</span><br><span class="line"></span><br><span class="line">git init命令会创建一个.git隐藏子目录，这个目录包含初始化git仓库所有的核心文件。</span><br><span class="line">此步仅仅是初始化，此时项目里的代码还没有被git跟踪，因此还需要git add对项目文件跟踪，然后git commit提交到本地仓库</span><br></pre></td></tr></table></figure>

<p>想知道.git文件做了什么事，请看git原理 &gt;<a target="_blank" rel="noopener" href="https://git-scm.com/book/zh/v2/ch00/ch10-git-internals">Git 内部原理</a></p>
<h4 id="2-新建一个项目，直接用git管理"><a href="#2-新建一个项目，直接用git管理" class="headerlink" title="2.新建一个项目，直接用git管理"></a>2.新建一个项目，直接用git管理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 某个文件夹</span><br><span class="line">git init mysite      此步会在当前路径创建mysite文件夹，mysite文件夹中包含了.git的初始化文件夹，所有配置</span><br></pre></td></tr></table></figure>

<h4 id="PS-git原理"><a href="#PS-git原理" class="headerlink" title="PS:git原理"></a>PS:git原理</h4><p>.git这个目录中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@pyyuc ~/git_learning/mysite 11:08:19]#tree .git</span><br><span class="line">.git</span><br><span class="line">├── branches</span><br><span class="line">├── config　　　　这个项目独有的配置</span><br><span class="line">├── description</span><br><span class="line">├── HEAD　　　　head文件指示目前被检出的分支</span><br><span class="line">├── hooks　　hooks目录包含服务端和客户端的钩子脚本 hook scripts</span><br><span class="line">│   ├── applypatch-msg.sample</span><br><span class="line">│   ├── commit-msg.sample</span><br><span class="line">│   ├── post-update.sample</span><br><span class="line">│   ├── pre-applypatch.sample</span><br><span class="line">│   ├── pre-commit.sample</span><br><span class="line">│   ├── prepare-commit-msg.sample</span><br><span class="line">│   ├── pre-push.sample</span><br><span class="line">│   ├── pre-rebase.sample</span><br><span class="line">│   └── update.sample</span><br><span class="line">├── index  index文件保存暂存区的信息，只有git add之后才会生成，默认还没有这个文件</span><br><span class="line">├── info　　　　info目录是全局性排除文件，用于放置不想被记录在.gitignore文件中的忽略模式（ignored patterns）</span><br><span class="line">│   └── exclude</span><br><span class="line">├── objects　　存储所有数据内容</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs　　refs目录存储指向数据（分支）的提交对象的指针</span><br><span class="line">    ├── heads</span><br><span class="line">    └── tags</span><br><span class="line"></span><br><span class="line">.git文件夹解析</span><br></pre></td></tr></table></figure>

<h4 id="3-获取远程代码仓库代码"><a href="#3-获取远程代码仓库代码" class="headerlink" title="3.获取远程代码仓库代码"></a>3.获取远程代码仓库代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">如果你想获取github上的代码，或者你公司gitlab私有仓库的代码，可以使用git clone命令，下载克隆远程仓库的代码。</span><br><span class="line"></span><br><span class="line">git clone https://github.com/django/django.git</span><br><span class="line">下载出来的代码已经是被git管理的本地仓库</span><br><span class="line">你会发现所有的项目文件都在这里，等待后续开发</span><br></pre></td></tr></table></figure>

<h2 id="Git生命周期演练"><a href="#Git生命周期演练" class="headerlink" title="Git生命周期演练"></a>Git生命周期演练</h2><h3 id="git工作区"><a href="#git工作区" class="headerlink" title="git工作区"></a>git工作区</h3><p>在我们进行git init mygit初始化一个git项目时，这个mygit文件夹，就是一个工作区（working Directory）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yudanL-2:mygit root# pwd</span><br><span class="line">/data/mygit</span><br><span class="line">yudanL-2:mygit root# ls</span><br><span class="line">.git    my.txt</span><br></pre></td></tr></table></figure>

<h3 id="git仓库"><a href="#git仓库" class="headerlink" title="git仓库"></a>git仓库</h3><p>工作区里有一个.git隐藏文件夹，就是git的本地仓库</p>
<p>.git文件夹里有一个index文件，就是git的暂存区，也叫做stage</p>
<p>.git文件夹里的HEAD文件就是git的一个指针</p>
<p>原理图</p>
<p><img src="pic/image-20200706162526177.png" alt="image-20200706162526177"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">git init mysite                          初始化git仓库</span><br><span class="line"></span><br><span class="line">git status                                 查看git状态</span><br><span class="line"></span><br><span class="line">echo &#x27;print(&quot;挣了一个亿&quot;)&#x27; &gt; main.py        新建一个代码文件，此时是未被git跟踪的</span><br><span class="line"></span><br><span class="line">git status                                查看状态</span><br><span class="line"></span><br><span class="line">    On branch master</span><br><span class="line"></span><br><span class="line">    No commits yet</span><br><span class="line"></span><br><span class="line">    Untracked files:</span><br><span class="line">      (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line"></span><br><span class="line">        main.py</span><br><span class="line"></span><br><span class="line">    nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line"></span><br><span class="line">git add main.py　　开始跟踪main.py文件</span><br><span class="line"></span><br><span class="line">git status 　　此时再看已经被跟踪，现在已是可以被提交的状态,此时处于暂存区</span><br><span class="line"></span><br><span class="line">git commit -m &quot;echo main.py&quot;  告诉git，把暂存区的main.py提交到本地仓库</span><br><span class="line"></span><br><span class="line">git log 　　　　查看刚才的commit记录</span><br></pre></td></tr></table></figure>

<h3 id="检查git文件状态"><a href="#检查git文件状态" class="headerlink" title="检查git文件状态"></a>检查git文件状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git status </span><br><span class="line">此命令查看git工作目录的文件，处于生命周期的哪一个状态 注意，只能在git工作目录中输入这个命令，他会去找.git文件夹 </span><br><span class="line">第一次输入git status会看到此状态，没有任何东西需要提交</span><br><span class="line">[root@pyyuc ~/git_learning/mysite 12:00:34]#git status</span><br><span class="line"># On branch master</span><br><span class="line">#</span><br><span class="line"># Initial commit</span><br><span class="line">#</span><br><span class="line">nothing to commit (create/copy files and use &quot;git add&quot; to track)</span><br><span class="line"></span><br><span class="line">说明当前工作目录很干净，所有的已跟踪文件，已经被提交且未更改。</span><br><span class="line">此时处在master默认分支。</span><br></pre></td></tr></table></figure>

<h3 id="给文件重命名"><a href="#给文件重命名" class="headerlink" title="给文件重命名"></a>给文件重命名</h3><p>有同学会说，这也太简单了，mv不就得了吗</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">我们还是在git版本库中操作</span><br><span class="line">修改main.py为mymain.py</span><br><span class="line">mv main.py  mymain.py</span><br><span class="line">查看状态</span><br><span class="line">git status直接mv的操作，会被git记录为两个形容，一、删除原有文件、二、新建了mymain.py文件此时新文件还未被跟踪，需要git add , git commit原本的main.py还需要从暂存区删除</span><br><span class="line">[root@pyyuc ~/mysite 14:57:57]#git status</span><br><span class="line"># On branch master</span><br><span class="line"># Changes not staged for commit:</span><br><span class="line">#   (use &quot;git add/rm &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">#</span><br><span class="line">#    deleted:    main.py</span><br><span class="line">#</span><br><span class="line"># Untracked files:</span><br><span class="line">#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">#</span><br><span class="line">#    mymain.py</span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)git rm main.py　　删除暂存区的main.pygit commit -m &quot;mv mymain.py&quot;　　提交新的mymain.py</span><br></pre></td></tr></table></figure>

<p>这样的步骤很麻烦，可以直接git mv 命令即可</p>
<p>刚才的mv记录，可以通过git log查看历史记录，已经提交的id</p>
<p>可以通过git reset 回退历史版本，回退到改名之前</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@pyyuc ~/mysite 15:10:12]#git log</span><br><span class="line">commit f60fa7f1312843aa57edc9464192c9d891f23fb5</span><br><span class="line">Author: pyyu &lt;yc_uuu@163.com&gt;</span><br><span class="line">Date:   Sat Dec 22 15:08:02 2018 +0800</span><br><span class="line"></span><br><span class="line">    mv mymain.py</span><br><span class="line"></span><br><span class="line">commit 65e0a2239909fd5aabc5928ec4431de3f163a195</span><br><span class="line">Author: pyyu &lt;yc_uuu@163.com&gt;</span><br><span class="line">Date:   Sat Dec 22 14:51:07 2018 +0800</span><br><span class="line"></span><br><span class="line">    echo main.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">回退到上一次commit版本，（注意这个命令，很危险，慎用）</span><br><span class="line">git reset --hard 65e0a2239909fd5aabc5928ec4431de3f163a195 </span><br><span class="line">--hard 清空暂存区和工作目录资料</span><br></pre></td></tr></table></figure>

<p>文件改名最正确的姿势</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git mv main.py mymain.py 　</span><br><span class="line"></span><br><span class="line">git commit -m &quot;mv mymain.py&quot;</span><br></pre></td></tr></table></figure>

<h3 id="git版本历史"><a href="#git版本历史" class="headerlink" title="git版本历史"></a>git版本历史</h3><p>在我们使用git的时候，会对代码文件不停的修改，不断的提交到代码仓库。</p>
<p>这个就如同我们打游戏时候，保存关卡记录的操作。</p>
<p><img src="pic/image-20200706162827184.png" alt="image-20200706162827184"></p>
<p>在打boss之前，先做一个存档，防止你这个渣渣，被boss一招秒杀，又得从头再来。。。。。</p>
<p>因此被boss弄死，可以从存档，重新开始游戏。。。。</p>
<h4 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h4><p><strong>当你的代码写好了一部分功能，就可以保存一个”存档”，这个存档操作就是git commit，如果代码出错，可以随时回到”存档”记录</strong></p>
<p><strong>查看”存档”记录，查看commit提交记录的命令 git log</strong></p>
<p>我们可以吧git commit操作与虚拟机的快照做对比理解，简单理解就是每次commit，就等于我们对代码仓库做了一个快照。</p>
<p>可以演示下vmware快照</p>
<p>那么我们如何知道文件快照了多少次呢？</p>
<p>git log命令显示，从最新的commit记录到最远的记录顺序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git log --oneline    一行显示git记录</span><br><span class="line">git log --oneline  --all  一行显示所有分支git记录</span><br><span class="line">git log --oneline --all -4 --graph 显示所有分支的版本演进的最近4条</span><br><span class="line">git log -4  显示最近4条记录</span><br><span class="line">git log --all     显示所有分支的commit信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git branch -v 查看分支信息</span><br><span class="line">git help --web log 以web界面显示log的参数</span><br></pre></td></tr></table></figure>

<h3 id="git文件对比"><a href="#git文件对比" class="headerlink" title="git文件对比"></a>git文件对比</h3><p>我们先记住如下几个命令的作用：</p>
<ul>
<li>git diff：<ul>
<li>当工作区有改动，暂存区为空，diff比较的是<code>工作区</code>和<code>最后一次commit提交的仓库</code>的共同文件</li>
<li>当工作区有改动，暂存区不为空，diff比较的是<code>工作区</code>和<code>暂存区</code>的共同文件</li>
</ul>
</li>
<li>git diff –cached或git diff –staged<ul>
<li>显示<code>暂存区</code>（已add但未commit的文件）和<code>最后一次commit</code>之间所有的不相同的文件，增删改信息。</li>
</ul>
</li>
<li>git diff HEAD：<ul>
<li>显示工作区（已跟踪但未add的文件）和暂存区（已add但未commit的文件）和本地仓库(最后一次commit的文件)所有不相同文件的增删改。</li>
</ul>
</li>
</ul>
<h4 id="命令实践"><a href="#命令实践" class="headerlink" title="命令实践"></a>命令实践</h4><p>情况一：工作区，暂存区，都没有改动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 情况一，工作区，暂存区，都没有改动</span><br><span class="line">[yuchao@yumac ~/learn_git]$git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff</span><br></pre></td></tr></table></figure>

<p>情况二：工作区有改动，暂存区为空（未git add的情况），比较的是工作区和本地仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 情况二，工作区有改动，暂存区为空（未git add的情况），比较的是工作区和本地仓库</span><br><span class="line">[yuchao@yumac ~/learn_git]$cat learn.txt</span><br><span class="line">超哥带你学git</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;超哥带你学git，好嗨哦&quot; &gt;&gt; learn.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">    modified:   learn.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff</span><br><span class="line">diff --git a/learn.txt b/learn.txt</span><br><span class="line">index 46cf52a..8f433a7 100644</span><br><span class="line">--- a/learn.txt</span><br><span class="line">+++ b/learn.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> 超哥带你学git</span><br><span class="line">+超哥带你学git，好嗨哦</span><br></pre></td></tr></table></figure>

<p>情况三：工作区有改动，暂存区不为空，比较的是工作区和本地仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 情况三，工作区有改动，暂存区不为空，比较的是工作区和本地仓库</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff</span><br><span class="line"># 看不到任何结果，是因为工作区和暂存区内容一样的</span><br><span class="line"># 因此可以在本地再添加一些信息</span><br><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;超哥带你学git，真的很嗨哦&quot; &gt;&gt; learn.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff</span><br><span class="line">diff --git a/learn.txt b/learn.txt</span><br><span class="line">index 8f433a7..dc0a6ba 100644</span><br><span class="line">--- a/learn.txt</span><br><span class="line">+++ b/learn.txt</span><br><span class="line">@@ -1,2 +1,3 @@</span><br><span class="line"> 超哥带你学git</span><br><span class="line"> 超哥带你学git，好嗨哦</span><br><span class="line">+超哥带你学git，真的很嗨哦</span><br><span class="line"></span><br><span class="line"># 添加工作区的内容放入，暂存区</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff</span><br><span class="line">[yuchao@yumac ~/learn_git]$git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">    modified:   learn.txt</span><br><span class="line"></span><br><span class="line"># 提交暂存区的内容</span><br><span class="line">[yuchao@yumac ~/learn_git]$git commit -m &quot;second commit with modified learn.txt&quot;</span><br><span class="line">[master 688c0ba] second commit with modified learn.txt</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line"></span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff</span><br></pre></td></tr></table></figure>

<p>情况四：刚才比较的都是本地工作区的文件区别，现在比较<code>暂存区</code>和<code>本地仓库</code>的区别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 案例1，当前暂存区为空</span><br><span class="line">[yuchao@yumac ~/learn_git]$git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff --cached</span><br><span class="line"></span><br><span class="line"># 暂存区有内容</span><br><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;git diff很强大哦&quot; &gt;&gt; learn.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">    modified:   learn.txt</span><br><span class="line"></span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line"></span><br><span class="line"># 使用git diff查看git diff --cached区别</span><br><span class="line"># 直接git diff没有结果，因为比较的是工作区和暂存区信息，是一样的，已经git add了</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff  </span><br><span class="line"></span><br><span class="line"># 使用git add --cached，发现区别，比较的是暂存区和本地仓库的区别</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff  --cached</span><br><span class="line">diff --git a/learn.txt b/learn.txt</span><br><span class="line">index dc0a6ba..52ef4f1 100644</span><br><span class="line">--- a/learn.txt</span><br><span class="line">+++ b/learn.txt</span><br><span class="line">@@ -1,3 +1,4 @@</span><br><span class="line"> 超哥带你学git</span><br><span class="line"> 超哥带你学git，好嗨哦</span><br><span class="line"> 超哥带你学git，真的很嗨哦</span><br><span class="line">+git diff很强大哦</span><br></pre></td></tr></table></figure>

<p>情况五：比较所有区域的区别</p>
<p>git diff head：</p>
<ul>
<li>显示工作区（已跟踪但未add的文件）和暂存区（已add但未commit的文件）和本地仓库(最后一次commit的文件)所有不相同文件的增删改。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># 所有区域没有内容变化，没有结果</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff HEAD</span><br><span class="line"></span><br><span class="line"># 工作区有内容变化，和本地仓库有文件差异</span><br><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;git diff 最后一个示例了&quot; &gt;&gt; learn.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff head</span><br><span class="line">diff --git a/learn.txt b/learn.txt</span><br><span class="line">index 52ef4f1..a382ed8 100644</span><br><span class="line">--- a/learn.txt</span><br><span class="line">+++ b/learn.txt</span><br><span class="line">@@ -2,3 +2,4 @@</span><br><span class="line"> 超哥带你学git，好嗨哦</span><br><span class="line"> 超哥带你学git，真的很嗨哦</span><br><span class="line"> git diff很强大哦</span><br><span class="line">+git diff 最后一个示例了</span><br><span class="line"></span><br><span class="line"># 工作区，暂存区，本地仓库三个比较，仍有区别</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff head</span><br><span class="line">diff --git a/learn.txt b/learn.txt</span><br><span class="line">index 52ef4f1..a382ed8 100644</span><br><span class="line">--- a/learn.txt</span><br><span class="line">+++ b/learn.txt</span><br><span class="line">@@ -2,3 +2,4 @@</span><br><span class="line"> 超哥带你学git，好嗨哦</span><br><span class="line"> 超哥带你学git，真的很嗨哦</span><br><span class="line"> git diff很强大哦</span><br><span class="line">+git diff 最后一个示例了</span><br><span class="line"></span><br><span class="line"># 提交暂存区后，所有区域没有区别了</span><br><span class="line">[yuchao@yumac ~/learn_git]$git commit -m &quot;learn git diff end.&quot;</span><br><span class="line">[master e670d84] learn git diff end.</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff head</span><br></pre></td></tr></table></figure>

<p>总结，看来<code>git diff head</code>能最大程度的检查出git区域间的文件一致。</p>
<h2 id="git仓库文件管理生命周期"><a href="#git仓库文件管理生命周期" class="headerlink" title="git仓库文件管理生命周期"></a>git仓库文件管理生命周期</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">还记得git的四个区域吗？本地文件夹，暂存区，本地仓库，远程仓库吗？</span><br><span class="line"></span><br><span class="line">本地文件夹未初始化，git是不认识的</span><br><span class="line"></span><br><span class="line">本地文件git init后，就成了git仓库</span><br></pre></td></tr></table></figure>

<p>请记住，在工作文件夹的每一个文件，只有两种状态，一个是<code>未跟踪</code>，一个是<code>已跟踪</code></p>
<p>已跟踪的指的是已经被纳入git版本管理的文件，在git快照中有他的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>

<p>未跟踪的是这个文件既不在git快照中，也不在暂存区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached hinimei.sh</span><br></pre></td></tr></table></figure>

<p>git init初始化时的工作文件夹，都属于已跟踪了，后续的编辑操作都会标记为，已修改文件，因此需要将修改后的文件，加入暂存区，然后提交暂存区的文件。</p>
<p><img src="pic/image-20200706174126694.png" alt="image-20200706174126694"></p>
<h2 id="Git版本回退"><a href="#Git版本回退" class="headerlink" title="Git版本回退"></a>Git版本回退</h2><p>学到这里，超哥想起来那年十八岁，听着周董的《回到过去》。。</p>
<p><img src="pic/image-20200706174453642.png" alt="image-20200706174453642"></p>
<p>我们已知git commit可以提交代码到本地仓库，如同虚拟机的快照，当也可以进行版本回退。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git log可以查看历史版本记录</span><br><span class="line">git reset --hard命令可以回退版本</span><br><span class="line">git reset --hard HEAD^ 回退到上个版本</span><br><span class="line">HEAD表示当前版版本</span><br><span class="line">HEAD^表示上个版本</span><br><span class="line">HEAD^^上上个版本</span><br><span class="line"></span><br><span class="line">也可以直接git reset --hard 版本id号</span><br><span class="line"></span><br><span class="line">这个时候就发现，git commit -m 所标记的注释信息非常重要了吧</span><br></pre></td></tr></table></figure>

<h3 id="版本回退原理"><a href="#版本回退原理" class="headerlink" title="版本回退原理"></a>版本回退原理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[yuchao@yumac ~/learn_git]$git reset --hard 81f0c645e4f4ca3fa20876939b04aa0da7996624</span><br><span class="line">HEAD is now at 81f0c64 my first commit with touch learn.txt</span><br></pre></td></tr></table></figure>

<p>git版本指针</p>
<p><img src="pic/image-20200706174930054.png" alt="image-20200706174930054"></p>
<h2 id="git穿梭未来"><a href="#git穿梭未来" class="headerlink" title="git穿梭未来"></a>git穿梭未来</h2><p>穿梭未来有点吓人，其实还是基于git log的恢复，如快照的恢复了。</p>
<p>当你发现你git reset回退版本选错了ID，怎么办？别怕</p>
<p><code>git reflog</code>帮你记录你每一次执行的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br><span class="line">80f9496 HEAD@&#123;1&#125;: reset: moving to HEAD^</span><br><span class="line">b7a8740 (HEAD -&gt; master) HEAD@&#123;2&#125;: commit: echo 123</span><br><span class="line">80f9496 HEAD@&#123;3&#125;: commit: echo my.txt</span><br><span class="line">bf5879e HEAD@&#123;4&#125;: commit (initial): echo my.txt</span><br></pre></td></tr></table></figure>

<p>我想回到某一个点，可以再次git reset –hard 版本id</p>
<h2 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a>git stash</h2><p>保存当前暂存区和工作区的改动存储起来，执行完毕git stash之后，再次运行git status就会发现当前已是个干净的工作区，通过git stash list查看结果</p>
<p>命令整理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git stash 保存暂存区，工作区进度</span><br><span class="line"></span><br><span class="line">git stash list 查看stash保存的列表以及id</span><br><span class="line"></span><br><span class="line">git stash pop  恢复最新的stash进度到工作区</span><br><span class="line"></span><br><span class="line">git stash pop stash_id  恢复指定的stash进度</span><br><span class="line"></span><br><span class="line">git stash clear 清空所有存储的stash进度</span><br><span class="line"></span><br><span class="line">git stash drop stash_id  删除一个存储的stash进度</span><br></pre></td></tr></table></figure>

<h3 id="git-stash实际用法"><a href="#git-stash实际用法" class="headerlink" title="git stash实际用法"></a>git stash实际用法</h3><p>图解stash用法</p>
<p><img src="pic/image-20210126140640216.png" alt="image-20210126140640216"></p>
<p>工作流</p>
<p><img src="http://book.luffycity.com/linux-book/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/pic/image-20210126140718543.png" alt="image-20210126140718543"></p>
<p><code>git stash</code>会把所有未提交的修改(已经git add 还未git commit)都保存起来，用于以后续恢复当前工作目录。 比如下面的中间状态，通过<code>git stash</code>命令推送一个新的储藏，当前的工作目录就干净了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;练习stash&quot; &gt;&gt;  learn_stash.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;练习stash22&quot; &gt;&gt;  learn_stash22.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">    new file:   learn_stash.txt</span><br><span class="line">    new file:   learn_stash22.txt</span><br><span class="line"></span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">learn.txt        learn_stash.txt        learn_stash22.txt</span><br><span class="line"></span><br><span class="line"># 如上有3个文件，已经被加入了暂存区</span><br><span class="line"># 使用stash可以吧暂存区还未提交的内容，临时存储起来</span><br><span class="line">[yuchao@yumac ~/learn_git]$git stash save &quot;my two file named learn_stash.txt&quot;</span><br><span class="line">Saved working directory and index state On master: my two file named learn_stash.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line"># 发现只剩下一个文件了</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">learn.txt</span><br><span class="line"></span><br><span class="line"># 找回stash文件内容</span><br><span class="line"># 查看储藏室列表</span><br><span class="line">[yuchao@yumac ~/learn_git]$git stash list</span><br><span class="line">stash@&#123;0&#125;: On master: my two file named learn_stash.txt</span><br><span class="line"></span><br><span class="line"># 找回储藏室的文件内容</span><br><span class="line">[yuchao@yumac ~/learn_git]$git stash pop</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">    new file:   learn_stash.txt</span><br><span class="line">    new file:   learn_stash22.txt</span><br><span class="line"></span><br><span class="line">Dropped refs/stash@&#123;0&#125; (e5a0fb591a48d66753d7d8f43574529efd02af29)</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">learn.txt        learn_stash.txt        learn_stash22.txt</span><br></pre></td></tr></table></figure>

<h1 id="Git分支"><a href="#Git分支" class="headerlink" title="Git分支"></a>Git分支</h1><p>在前面我们基本了解Git的使用方法，这一节我们看下GIt重要概念【分支】</p>
<p>在开发软件的时候，可能有多人同时开发一个软件功能或者修复BUG。</p>
<p>假设超哥要开发一个同性在线交友的网站，这个写代码的工作进行分配，分给两个小弟进行功能开发，一个是武沛奇分支，一个是苑昊分支，他俩自己的分支别人看不到，当他俩代码写完后，合并到master主分支上，这样既保证主代码的安全，又能协同开发，互不影响。</p>
<p><img src="pic/image-20200707104340624.png" alt="image-20200707104340624"></p>
<h2 id="git分支命令"><a href="#git分支命令" class="headerlink" title="git分支命令"></a>git分支命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">1.查看分支，查看当前分支情况，在哪一个就有*符</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch</span><br><span class="line">* master</span><br><span class="line"></span><br><span class="line">此例的意思就是，我们有一个叫做 master 的分支，并且该分支是当前分支。</span><br><span class="line">当你执行 git init 的时候，默认情况下 Git 就会为你创建 master 分支。</span><br><span class="line">如果我们要手动创建一个分支。执行 git branch (branchname) 即可。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.创建分支</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch onlyu</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch</span><br><span class="line">* master</span><br><span class="line">  onlyu</span><br><span class="line"></span><br><span class="line">现在我们可以看到，有了一个新分支 onlyu。</span><br><span class="line">接下来我们将演示如何切换分支，我们用 git checkout (branch) 切换到我们要修改的分支。  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.git分支练习</span><br><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;超哥带你学git分支&quot; &gt; branch.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$git commit -m &quot;add branch.txt&quot;</span><br><span class="line">[master 91618a9] add branch.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 branch.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt</span><br><span class="line"></span><br><span class="line"># 此时切换分支，Git会还原工作区的内容，到创建分支时的状态</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout onlyu</span><br><span class="line">Switched to branch &#x27;onlyu&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">learn.txt</span><br><span class="line"># 切换回master，数据又回来了</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt</span><br><span class="line"></span><br><span class="line">4.我们也可以直接创建且切换分支</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout -b yuchao</span><br><span class="line">Switched to a new branch &#x27;yuchao&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch</span><br><span class="line">  master</span><br><span class="line">  onlyu</span><br><span class="line">* yuchao</span><br><span class="line">[yuchao@yumac ~/learn_git]$echo &quot;我是分支yuchao，你好&quot; &gt;&gt; yuchao.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$git commit -m &quot;add yuchao.txt&quot;</span><br><span class="line">[yuchao 1304234] add yuchao.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 yuchao.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt    yuchao.txt</span><br><span class="line"></span><br><span class="line"># 如缩减，当我们回退到主分支的时候，新创建的文件已然消失了</span><br><span class="line"># 使用分支，实现了在不同的分支环境下工作，且可以来回切换</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt</span><br><span class="line"></span><br><span class="line">5.删除分支，删除分支后，随之分支管理的文件内容也被删了</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch -D onlyu</span><br><span class="line">Deleted branch onlyu (was e670d84).</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch</span><br><span class="line">* master</span><br><span class="line">  yuchao</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.一旦分支有了独立的内容，你最终目的是，将分支独立开发的内容合并到主干分支。</span><br><span class="line"># 主分支下内容</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch</span><br><span class="line">* master</span><br><span class="line">  onlyu</span><br><span class="line">  yuchao</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt</span><br><span class="line"></span><br><span class="line"># yuchao分支下的内容</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout yuchao</span><br><span class="line">Switched to branch &#x27;yuchao&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt    yuchao.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 合并yuchao分支的文件内容到主干master</span><br><span class="line"># 回退到master分支，然后执行命令</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$git merge yuchao</span><br><span class="line">Updating 91618a9..1304234</span><br><span class="line">Fast-forward</span><br><span class="line"> yuchao.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 yuchao.txt</span><br><span class="line"> # 此时发现已经在master主干分支，新增了一个文件</span><br><span class="line"> [yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt    yuchao.txt</span><br><span class="line"></span><br><span class="line">合并完之后，就可以删除该分支了，下次需要用分支开发，可以再次创建即可</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch -d yuchao</span><br><span class="line">Deleted branch yuchao (was 1304234).</span><br></pre></td></tr></table></figure>

<h2 id="git合并分支冲突"><a href="#git合并分支冲突" class="headerlink" title="git合并分支冲突"></a>git合并分支冲突</h2><p>合并不仅仅是简单的对文件添加、移除，git可以合并且修改。</p>
<p>我们准备数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">1.准备开始进行开发了，新建一个分支</span><br><span class="line">[yuchao@yumac ~/learn_git]$git branch chaoge</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout chaoge</span><br><span class="line">Switched to branch &#x27;chaoge&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt    yuchao.txt</span><br><span class="line">[yuchao@yumac ~/learn_git]$vim chaoge.php</span><br><span class="line">[yuchao@yumac ~/learn_git]$head -3 chaoge.php</span><br><span class="line">&lt;?php</span><br><span class="line">echo &quot;超哥带你学git合并冲突如何解决&quot;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">2.将创建的文件内容，提交到chaoge分支</span><br><span class="line">[yuchao@yumac ~/learn_git]$git commit -m &quot;add chaoge.php&quot;</span><br><span class="line">[chaoge 3f6cccf] add chaoge.php</span><br><span class="line"> 1 file changed, 3 insertions(+)</span><br><span class="line"> create mode 100644 chaoge.php</span><br><span class="line"></span><br><span class="line"> 3.此时我们切换回master分支，chaoge.php文件应该是不存在的</span><br><span class="line"> [yuchao@yumac ~/learn_git]$git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">[yuchao@yumac ~/learn_git]$ls</span><br><span class="line">branch.txt    learn.txt    yuchao.txt</span><br><span class="line"></span><br><span class="line">4.我们在master分支下，也创建名为chaoge.php的文件，且写入内容</span><br><span class="line">[yuchao@yumac ~/learn_git]$git checkout master</span><br><span class="line">[yuchao@yumac ~/learn_git]$head -3 chaoge.php</span><br><span class="line">&lt;?php</span><br><span class="line">echo &quot;我是冲突，嘿嘿嘿&quot;;</span><br><span class="line">?&gt;</span><br><span class="line"># 提交到本地仓库</span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$git commit -m &quot;add chaoge.php  by master&quot;</span><br><span class="line">[master 4d74537] add chaoge.php  by master</span><br><span class="line"> 1 file changed, 3 insertions(+)</span><br><span class="line"> create mode 100644 chaoge.php</span><br><span class="line"></span><br><span class="line"> 5.此时你会发现，chaoge.php文件在master分支和chaoge分支，都有自己的代码内容，是不是？</span><br><span class="line"> 如果此时你合并分支，会发现如下问题</span><br><span class="line"> [yuchao@yumac ~/learn_git]$git merge chaoge</span><br><span class="line">CONFLICT (add/add): Merge conflict in chaoge.php</span><br><span class="line">Auto-merging chaoge.php</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br><span class="line">发现了git给与的提示是，自动合并失败了，需要你自己手动解决冲突，然后提交结果</span><br><span class="line"></span><br><span class="line">6.查看文件内容，文件被git自动修改了</span><br><span class="line">第二行发生了文件内容冲突</span><br><span class="line">master主分支上内容是 echo &quot;我是冲突，嘿嘿嘿&quot;</span><br><span class="line">chaoge分支合并过来的内容是 echo &quot;超哥带你学git合并冲突如何解决&quot;</span><br><span class="line">此时根据你自己的需求，决定如何修改代码文件，再次提交即可</span><br><span class="line">[yuchao@yumac ~/learn_git]$cat -n  chaoge.php</span><br><span class="line">     1    &lt;?php</span><br><span class="line">     2    &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">     3    echo &quot;我是冲突，嘿嘿嘿&quot;;</span><br><span class="line">     4    =======</span><br><span class="line">     5    echo &quot;超哥带你学git合并冲突如何解决&quot;;</span><br><span class="line">     6    &gt;&gt;&gt;&gt;&gt;&gt;&gt; chaoge</span><br><span class="line">     7    ?&gt;</span><br><span class="line"></span><br><span class="line">7.自己决定对代码修改</span><br><span class="line">[yuchao@yumac ~/learn_git]$git diff</span><br><span class="line">diff --cc chaoge.php</span><br><span class="line">index b4689a3,ae89ca8..0000000</span><br><span class="line">--- a/chaoge.php</span><br><span class="line">+++ b/chaoge.php</span><br><span class="line">@@@ -1,3 -1,3 +1,7 @@@</span><br><span class="line">  &lt;?php</span><br><span class="line">++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"> +echo &quot;我是冲突，嘿嘿嘿&quot;;</span><br><span class="line">++=======</span><br><span class="line">+ echo &quot;超哥带你学git合并冲突如何解决&quot;;</span><br><span class="line">++&gt;&gt;&gt;&gt;&gt;&gt;&gt; chaoge</span><br><span class="line">  ?&gt;</span><br><span class="line"></span><br><span class="line"># 手动修改代码为确定版本，比如两个代码我都要保留</span><br><span class="line">[yuchao@yumac ~/learn_git]$cat chaoge.php</span><br><span class="line">&lt;?php</span><br><span class="line">echo &quot;我是冲突，嘿嘿嘿&quot;;</span><br><span class="line">echo &quot;超哥带你学git合并冲突如何解决&quot;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">[yuchao@yumac ~/learn_git]$git add .</span><br><span class="line">[yuchao@yumac ~/learn_git]$git status</span><br><span class="line">On branch master</span><br><span class="line">All conflicts fixed but you are still merging.</span><br><span class="line">  (use &quot;git commit&quot; to conclude merge)</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">    modified:   chaoge.php</span><br><span class="line"></span><br><span class="line">[yuchao@yumac ~/learn_git]$git commit -m &quot;merge chaoge with change chaoge.php&quot;</span><br><span class="line">[master 4ba1c7d] merge chaoge with change chaoge.php</span><br><span class="line"></span><br><span class="line">现在我们就解决了合并中的冲突，然后提交了结果</span><br></pre></td></tr></table></figure>

<h1 id="Git标签"><a href="#Git标签" class="headerlink" title="Git标签"></a>Git标签</h1><h2 id="git标签有什么用"><a href="#git标签有什么用" class="headerlink" title="git标签有什么用"></a>git标签有什么用</h2><p>Git仓库内的数据发生变化时，我们经常会打上一个类似于软件版本的标签tag，这样通过标签就可以把版本库中的某个版本给记录下来，便于以后我们可以将特定的数据取出来。</p>
<p>标签就是版本库的一个快照。</p>
<h2 id="为啥用git标签"><a href="#为啥用git标签" class="headerlink" title="为啥用git标签"></a>为啥用git标签</h2><p>git不是已经有commit了吗，可以附加提交信息，为什么还要tag呢？</p>
<p>开发小王：请吧上周一发布的版本打包发布，commit_id是3f6cccf0708525b58fe191c80325b73a54adee99</p>
<p>运维小于：你这什么乱七八糟的数字，，，太难找了，请你换个方法</p>
<p>开发小王换了个方式：请吧上周一发布的版本打包，版本号是v1.2，按照tag v1.2查找commit 记录就行了！</p>
<p>所以tag就是一个容易记住的名字，和某个commit记录绑定在一起。</p>
<h2 id="git标签使用"><a href="#git标签使用" class="headerlink" title="git标签使用"></a>git标签使用</h2><p>对当前提交的代码创建标签，-a标签名称，-m标签描述。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">1.# 对当前最新的commit记录进行标签</span><br><span class="line">[yuchao@yumac ~/learn_git]$git tag -a &quot;v1.0&quot; -m &quot;修复了支付bug&quot;</span><br><span class="line"></span><br><span class="line">2.# 直接输入，则查看当前标签</span><br><span class="line">[yuchao@yumac ~/learn_git]$git tag</span><br><span class="line">v1.0</span><br><span class="line"></span><br><span class="line">3.# 指定commitID创建标签，选中commit id 前7位就够了</span><br><span class="line">git tag -a v1 1304234 -m &quot;添加了yuchao.txt&quot;</span><br><span class="line"></span><br><span class="line">4.# 查看标签列表</span><br><span class="line">[yuchao@yumac ~/learn_git]$git tag</span><br><span class="line">v1</span><br><span class="line">v1.0</span><br><span class="line"></span><br><span class="line">5.# 查看标签里有什么git show</span><br><span class="line">[yuchao@yumac ~/learn_git]$git show v1</span><br><span class="line">tag v1</span><br><span class="line">Tagger: yc &lt;yc_uuu@163.com&gt;</span><br><span class="line">Date:   Tue Jul 7 15:26:15 2020 +0800</span><br><span class="line"></span><br><span class="line">添加了yuchao.txt</span><br><span class="line"></span><br><span class="line">commit 1304234d1240469587a7d448ba3f8e0c09f8a340 (tag: v1)</span><br><span class="line">Author: yc &lt;yc_uuu@163.com&gt;</span><br><span class="line">Date:   Tue Jul 7 11:37:20 2020 +0800</span><br><span class="line"></span><br><span class="line">    add yuchao.txt</span><br><span class="line"></span><br><span class="line">diff --git a/yuchao.txt b/yuchao.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..9b91134</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/yuchao.txt</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+我是分支yuchao，你好</span><br><span class="line"></span><br><span class="line">6.# 通过git log查看tag</span><br><span class="line"># --graph：显示ASCII图形表示的分支合并历史</span><br><span class="line"># —pretty＝：使用其他格式显示历史提交信息</span><br><span class="line"># -abbrev-commit：仅显示SHA-1的前几个字符，而非所有的40个字符 </span><br><span class="line"># --decorate 显示包含标签的记录</span><br><span class="line"></span><br><span class="line">[yuchao@yumac ~/learn_git]$git log --oneline --decorate --graph</span><br><span class="line">*   4ba1c7d (HEAD -&gt; master, tag: v1.0) merge chaoge with change chaoge.php</span><br><span class="line">|\</span><br><span class="line">| * 3f6cccf (chaoge) add chaoge.php</span><br><span class="line">* | 4d74537 add chaoge.php  by master</span><br><span class="line">|/</span><br><span class="line">* 1304234 (tag: v1) add yuchao.txt</span><br><span class="line">* 91618a9 add branch.txt</span><br><span class="line">* e670d84 learn git diff end.</span><br><span class="line">* eeef559 modify learn.txt</span><br><span class="line">* 688c0ba second commit with modified learn.txt</span><br><span class="line">* 81f0c64 my first commit with touch learn.txt</span><br><span class="line"></span><br><span class="line">7.删除tag</span><br><span class="line">[yuchao@yumac ~/learn_git]$git tag -d v1</span><br><span class="line">Deleted tag &#x27;v1&#x27; (was e2118b3)</span><br><span class="line">[yuchao@yumac ~/learn_git]$git tag</span><br><span class="line">v1.0</span><br></pre></td></tr></table></figure>

<h1 id="gitee远程仓库"><a href="#gitee远程仓库" class="headerlink" title="gitee远程仓库"></a>gitee远程仓库</h1><p>git是一个分布式版本控制系统，同一个git仓库可以分布在不同的机器上，但是开发团队必须保证在同一个网络中，且必须有一个项目的原始版本，通常的办法就是让一台电脑充当服务器的角色，每天24小时开机，其他每个人都可以在这台”服务器”仓库里克隆一份代码到自己的电脑上。</p>
<p>并且也可以把各自的代码提交到代码仓库里，也能从代码仓库拉取别人的提交。</p>
<p>这样的代码仓库服务器，我们可以自由的搭建，也可以选择使用免费的托管平台。</p>
<p>Git代码托管平台，首先推荐的是Github，世界范围内的开发者都在使用Github托管代码，可以找到大量优秀的开源项目，缺点就是访问可能会卡一点。</p>
<p>其次选择的就是Gitee，国内的代码托管平台，以及自建Gitlab服务器。 <img src="pic/image-20200707155533602.png" alt="image-20200707155533602"></p>
<p>Gitee 提供免费的 Git 仓库，还集成了代码质量检测、项目演示等功能。对于团队协作开发，Gitee 还提供了项目管理、代码托管、文档管理的服务。</p>
<p>官网地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://gitee.com/</span><br><span class="line">注册后登录即可</span><br></pre></td></tr></table></figure>

<h2 id="创建空仓库"><a href="#创建空仓库" class="headerlink" title="创建空仓库"></a>创建空仓库</h2><p>点击右上角的➕，新建仓库</p>
<p><img src="pic/image-20200707160203811.png" alt="image-20200707160203811"></p>
<p>创建完毕空仓库后，页面出现如下仓库使用方式，我们可以选择HTTPS和SSH形式下载代码的方式</p>
<p><img src="pic/image-20200707160844018.png" alt="image-20200707160844018"></p>
<p>到这里，我们仓库就已经创建好了，接着就是要将本地客户端和服务端连接起来，存在于两种情况</p>
<ul>
<li>本地已经有一个git仓库了</li>
<li>本地还没有git仓库</li>
</ul>
<h2 id="配置客户端连接gitee仓库-HTTPS"><a href="#配置客户端连接gitee仓库-HTTPS" class="headerlink" title="配置客户端连接gitee仓库(HTTPS)"></a>配置客户端连接gitee仓库(HTTPS)</h2><h3 id="推送本地仓库到远程"><a href="#推送本地仓库到远程" class="headerlink" title="推送本地仓库到远程"></a>推送本地仓库到远程</h3><p>HTTPS协议也就指的是使用账号密码连接</p>
<p>1.git全局设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;pyyu&quot;</span><br><span class="line">git config --global user.email &quot;877348180@qq.com&quot;</span><br></pre></td></tr></table></figure>

<p>2.创建git仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mkdir gitee_learn</span><br><span class="line">cd gitee_learn</span><br><span class="line">git init</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line"># 为本地仓库gitee_learn添加远程仓库别名origin，地址是如下链接</span><br><span class="line">git remote add origin https://gitee.com/yuco/gitee_learn.git</span><br><span class="line">git push -u origin master</span><br><span class="line"># 输入正确gitee账号密码之后即可正确把代码推送到远程仓库</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git push -u origin master</span><br><span class="line">Username for &#x27;https://gitee.com&#x27;: 877348180@qq.com</span><br><span class="line">Password for &#x27;https://877348180@qq.com@gitee.com&#x27;:</span><br><span class="line">Enumerating objects: 3, done.</span><br><span class="line">Counting objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (3/3), 203 bytes | 203.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-5.0]</span><br><span class="line">To https://gitee.com/yuco/gitee_learn.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">Branch &#x27;master&#x27; set up to track remote branch &#x27;master&#x27; from &#x27;origin&#x27;.</span><br></pre></td></tr></table></figure>

<p>3.此时可以访问远程代码仓库了，发现本地创建的文件已经推送上去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gitee.com/yuco/gitee_learn</span><br></pre></td></tr></table></figure>

<h2 id="免密推送代码（SSH）"><a href="#免密推送代码（SSH）" class="headerlink" title="免密推送代码（SSH）"></a>免密推送代码（SSH）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">可以直接访问地址</span><br><span class="line">https://gitee.com/profile/sshkeys</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200707163049139.png" alt="image-20200707163049139"></p>
<p>我们要在客户端生成key，结合gitee实现无密码登录，在linux和windows均可以使用ssh-keygen命令生成，需要注意的是在windows下只能生成rsa加密方式的key。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 使用如下命令，生成公私钥对</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/Users/yuchao/.ssh/id_rsa):</span><br><span class="line">/Users/yuchao/.ssh/id_rsa already exists.</span><br><span class="line">Overwrite (y/n)? y</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /Users/yuchao/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /Users/yuchao/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:PRbwYXXO1gVueXRb4K9LdNK2a7CXVOvm3fQ2bTCe8 yuchao@yumac</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 3072]----+</span><br><span class="line">|        . o.. o+X|</span><br><span class="line">|         + . = =o|</span><br><span class="line">|          o   O o|</span><br><span class="line">|         . o + o |</span><br><span class="line">|        S = .o+|</span><br><span class="line">|         . o..=Xo|</span><br><span class="line">|           .. B+=|</span><br><span class="line">|            .=.E*|</span><br><span class="line">|            o++o*|</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line"></span><br><span class="line"># 我们把公钥信息复制到gitee中</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$cat /Users/yuchao/.ssh/id_rsa.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBmqRVCYkYg6PHxugxTjBcAkl1WrMkx3OkMD/ltQAwNM+R/wKozlNwbPLY1ZMUx2A6nKmBoTdvy0rKyX2OhxzbOwoUJsW+InhDoBuY8CGUyFoqhN96lVVxa+9v8/+LYNJOXePS7FArSbo0B23yeRnL389fPVLiHXIiLtFpxFRUEv3pEUcQNdZKeKLKcdboGjHxDNZQpHmVSgWSy039oGd7f8uC4VaM6Lk6qYq4i8lUwR3CudHxcgzkjnfiMGmZdxCdnPHcWdzQvjv4AmyeBSNfrjgaNYnHxrw/OF8GwfJsqfv+xhCG9XINQQgzVp+METIu0qE4GnyXiGB/7KgFeb3t/tR0gI40s19MlgCsS6uCQrHF8Z9qc0qbhdVCVjvk/PYuFWidZHzsz25o1Ay2s5b/yoxUYDaG+drvA95G7uKti6TJ9YLM+cAJMUlgQCmLHKiwxbeKdZuboKG9Z3JzAtLqBSgqgoIFB8b/03S6y6dozciNYEBal6XSOPy+Pltv8= yuchao@yumac</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200707163644903.png" alt="image-20200707163644903"></p>
<p>此时我们就得修改代码仓库的远程别名，修改如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前远程配置</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git remote -v</span><br><span class="line">origin    https://gitee.com/yuco/gitee_learn.git (fetch)</span><br><span class="line">origin    https://gitee.com/yuco/gitee_learn.git (push)</span><br><span class="line"></span><br><span class="line"># 修改为ssh协议的url</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git remote set-url origin git@gitee.com:yuco/gitee_learn.git</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git remote -v</span><br><span class="line">origin    git@gitee.com:yuco/gitee_learn.git (fetch)</span><br><span class="line">origin    git@gitee.com:yuco/gitee_learn.git (push)</span><br><span class="line"></span><br><span class="line"># 可以新增一个文件，用git管理提交到本地仓库后，推送到gitee</span><br><span class="line"># -u指定服务器地址</span><br><span class="line"># 代码推送到远程主机的master主干</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git push -u origin master</span><br><span class="line">Enumerating objects: 4, done.</span><br><span class="line">Counting objects: 100% (4/4), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 313 bytes | 313.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-5.0]</span><br><span class="line">To gitee.com:yuco/gitee_learn.git</span><br><span class="line">   5c29d38..74c25be  master -&gt; master</span><br><span class="line">Branch &#x27;master&#x27; set up to track remote branch &#x27;master&#x27; from &#x27;origin&#x27;.</span><br></pre></td></tr></table></figure>

<h3 id="克隆远程仓库到本地"><a href="#克隆远程仓库到本地" class="headerlink" title="克隆远程仓库到本地"></a>克隆远程仓库到本地</h3><p>如果我们在任意一个其他的客户端想要获取仓库的代码，我们只需要克隆一份远程仓库代码即可，在克隆之前，仍然要配置好客户端和gitee的认证关系，或是使用账号密码下载即可。</p>
<p>此时可以再准备一台linux机器，模拟另一个客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 以配置好了ssh-key为准，直接使用ssh协议的下载</span><br><span class="line">[yuchao@yumac /tmp]$git clone git@gitee.com:yuco/gitee_learn.git</span><br><span class="line">Cloning into &#x27;gitee_learn&#x27;...</span><br><span class="line">remote: Enumerating objects: 6, done.</span><br><span class="line">remote: Counting objects: 100% (6/6), done.</span><br><span class="line">remote: Compressing objects: 100% (3/3), done.</span><br><span class="line">remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Receiving objects: 100% (6/6), done.</span><br><span class="line"></span><br><span class="line"># 克隆好了之后，我们本地已然有了代码</span><br><span class="line">[yuchao@yumac /tmp]$ls gitee_learn/</span><br><span class="line">README.md    git.txt</span><br><span class="line"></span><br><span class="line"># 此时该用户也可以继续开发新功能，然后推送到远程代码仓库，供他人下载</span><br><span class="line">[yuchao@yumac /tmp/gitee_learn]$echo &quot;我是程序员小于，我新建了一个文件&quot; &gt;&gt; cc.txt</span><br><span class="line">[yuchao@yumac /tmp/gitee_learn]$</span><br><span class="line">[yuchao@yumac /tmp/gitee_learn]$git add .</span><br><span class="line">[yuchao@yumac /tmp/gitee_learn]$git commit -m &quot;add cc.txt by 小于&quot;</span><br><span class="line">[master bfcf9d4] add cc.txt by 小于</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 cc.txt</span><br><span class="line">[yuchao@yumac /tmp/gitee_learn]$</span><br><span class="line">[yuchao@yumac /tmp/gitee_learn]$</span><br><span class="line">[yuchao@yumac /tmp/gitee_learn]$git push -u origin master</span><br><span class="line">Enumerating objects: 4, done.</span><br><span class="line">Counting objects: 100% (4/4), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 360 bytes | 360.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-5.0]</span><br><span class="line">To gitee.com:yuco/gitee_learn.git</span><br><span class="line">   74c25be..bfcf9d4  master -&gt; master</span><br><span class="line">Branch &#x27;master&#x27; set up to track remote branch &#x27;master&#x27; from &#x27;origin&#x27;.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 此时远程仓库又有了新的代码</span><br><span class="line">https://gitee.com/yuco/gitee_learn</span><br></pre></td></tr></table></figure>

<h2 id="git-fetch使用"><a href="#git-fetch使用" class="headerlink" title="git fetch使用"></a>git fetch使用</h2><p>上述案例，我们在另一个客户端推送了新的代码，此时代码仓库中是最新的，但是其他客户端代码是不是已经旧了，我们得更新代码对把。需要把代码仓库里的更新取回本地，这就得用到git fetch命令。</p>
<p><code>git fetch</code>作用是取回所有分支(branch)的更新，如果只想更新特定的分支代码，可以指定分支名，比如取回远程origin仓库的master分支代码，即可这么写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin master</span><br></pre></td></tr></table></figure>

<p>案例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[yuchao@yumac ~/gitee_learn]$git fetch</span><br><span class="line">remote: Enumerating objects: 4, done.</span><br><span class="line">remote: Counting objects: 100% (4/4), done.</span><br><span class="line">remote: Compressing objects: 100% (2/2), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From gitee.com:yuco/gitee_learn</span><br><span class="line">   74c25be..bfcf9d4  master     -&gt; origin/master</span><br></pre></td></tr></table></figure>

<p>取回来的更新，要在本地主机上采用<code>远程主机名/分支名</code>的形式读取，比如origin主机上的master，那就是origin/master来读取。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">可以采用git branch -r选项，查看远程分支，-a查看所有分支</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git branch -r</span><br><span class="line">  origin/master</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git branch -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/master</span><br></pre></td></tr></table></figure>

<p>取回远程主机的更新以后，可以在其基础上，使用git checkout命令创建一个新分支，待会用于合并。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[yuchao@yumac ~/gitee_learn]$git checkout -b remote-master origin/master</span><br><span class="line">Branch &#x27;remote-master&#x27; set up to track remote branch &#x27;master&#x27; from &#x27;origin&#x27;.</span><br><span class="line">Switched to a new branch &#x27;remote-master&#x27;</span><br><span class="line"></span><br><span class="line"># 此时查看的是远程分支上的数据</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$ls</span><br><span class="line">README.md    cc.txt        git.txt</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git branch</span><br><span class="line">  master</span><br><span class="line">* remote-master</span><br></pre></td></tr></table></figure>

<p>使用<code>git merge命令</code>合并远程分支的代码到master主干</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 回到master，合并分支</span><br><span class="line"># 切换分支时，git已经提示你，master分支的代码已经落后了，可以更新了</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">Your branch is behind &#x27;origin/master&#x27; by 1 commit, and can be fast-forwarded.</span><br><span class="line">  (use &quot;git pull&quot; to update your local branch)</span><br><span class="line"></span><br><span class="line"> # 将分支代码合并到主干，结束操作</span><br><span class="line">[yuchao@yumac ~/gitee_learn]$git merge remote-master</span><br><span class="line">Updating 74c25be..bfcf9d4</span><br><span class="line">Fast-forward</span><br><span class="line"> cc.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 cc.txt</span><br></pre></td></tr></table></figure>

<h1 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h1><p><img src="pic/image-20200708091136140.png" alt="image-20200708091136140"></p>
<p><img src="pic/image-20200708091154862.png" alt="image-20200708091154862"></p>
<p><img src="pic/image-20200708091226949.png" alt="image-20200708091226949"></p>
<h2 id="Gitlab介绍"><a href="#Gitlab介绍" class="headerlink" title="Gitlab介绍"></a>Gitlab介绍</h2><p><strong>我们了解了git是以个人为中心，但是人人都得数据交互呀。。python程序员每天都忙着进行py交易</strong></p>
<p>交互数据的方式</p>
<ul>
<li>使用github或者码云等公有代码仓库，托管代码的地方，谁都可以看</li>
<li>公司内部使用gitlab私有仓库</li>
</ul>
<p>github和gitlab的区别</p>
<ul>
<li>github国外公共仓库不安全，国内的码云代码仓库，可能会暴露自己公司代码机密，等着被开除吧。。</li>
<li>自建gitlab私有代码仓库，更加安全</li>
<li>从代码私有性方面来看，公司不希望员工随意获取全部代码，使用Gitlab无疑是最好的选择</li>
<li>若是开源项目，Github还是代码托管的首选平台。</li>
</ul>
<p><img src="pic/image-20200708091356915.png" alt="image-20200708091356915"></p>
<p>Gitlab是一个开源分布式的版本控制系统，由Ruby语言开发，Gitlab主要实现的功能、管理项目源代码、对源代码进行版本控制，以及源代码的复用和查找。</p>
<p>Gitlab优势和应用场景：</p>
<ul>
<li>开源免费，搭建简单，维护成本低，适合中小型公司。</li>
<li>权限管理，实现代码对部分人可见，确保醒目安全性。</li>
<li>离线同步，保证我们不需要依赖于网络环境进行代码提交（代码本地仓库管理然后推到远程仓库）</li>
</ul>
<h2 id="Gitlab安装配置"><a href="#Gitlab安装配置" class="headerlink" title="Gitlab安装配置"></a>Gitlab安装配置</h2><p>环境准备</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">操作系统centos7</span><br><span class="line">内存：2G及以上</span><br><span class="line">磁盘：50G</span><br><span class="line">安全：关闭防火墙，selinux</span><br></pre></td></tr></table></figure>

<p>1.安装GItlab所需的依赖包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install curl policycoreutils-python openssh-server postfix wget -y</span><br></pre></td></tr></table></figure>

<p>2.安装gitlab，可以在线装，也可以安装本地准备好的rpm包，如果没有找超哥要</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 opt]# yum localinstall gitlab-</span><br><span class="line">gitlab-12-0-stable-zh.tar.gz          gitlab-ce-12.0.3-ce.0.el7.x86_64.rpm</span><br><span class="line">[root@lb02 opt]# yum localinstall gitlab-ce-12.0.3-ce.0.el7.x86_64.rpm -y</span><br></pre></td></tr></table></figure>

<p>3.配置gitlab服务，修改域名和邮箱</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 安装好后，默认提示Please configure a URL for your GitLab instance by setting `external_url`</span><br><span class="line"># configuration in /etc/gitlab/gitlab.rb file.</span><br><span class="line">需要修改配置文件，换成你自己的服务器地址就好</span><br><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line">external_url &#x27;http://172.20.0.51&#x27;</span><br><span class="line"></span><br><span class="line">配置邮箱，打开注释，修改配置，注意别改错了，否则将无法收到邮件</span><br><span class="line">### Email Settings</span><br><span class="line">gitlab_rails[&#x27;gitlab_email_enabled&#x27;] = true</span><br><span class="line">gitlab_rails[&#x27;gitlab_email_from&#x27;] = &#x27;yc_uuu@163.com&#x27;</span><br><span class="line">gitlab_rails[&#x27;gitlab_email_display_name&#x27;] = &#x27;Onlyu-Gitlab&#x27;</span><br><span class="line"></span><br><span class="line"># email server settings</span><br><span class="line">gitlab_rails[&#x27;smtp_enable&#x27;] = true</span><br><span class="line">gitlab_rails[&#x27;smtp_address&#x27;] = &quot;smtp.163.com&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_port&#x27;] = 465</span><br><span class="line">gitlab_rails[&#x27;smtp_user_name&#x27;] = &quot;yc_uuu@163.com&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_password&#x27;] = &quot;&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_domain&#x27;] = &quot;smtp.163.com&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_authentication&#x27;] = &quot;login&quot;</span><br><span class="line">gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;] = true</span><br><span class="line">gitlab_rails[&#x27;smtp_tls&#x27;] = true</span><br></pre></td></tr></table></figure>

<p>可以进入gitlab命令行，测试邮件收发是否正常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 ~]# gitlab-rails console</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line"> GitLab:       12.0.3 (08a51a9db93)</span><br><span class="line"> GitLab Shell: 9.3.0</span><br><span class="line"> PostgreSQL:   10.7</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 5.1.7)</span><br><span class="line">irb(main):005:0&gt; Notify.test_email(&#x27;877348180@qq.com&#x27;,&#x27;hello&#x27;,&#x27;hello yuchao&#x27;).deliver_now</span><br><span class="line">Notify#test_email: processed outbound mail in 0.9ms</span><br><span class="line">Sent mail to 877348180@qq.com (374.3ms)</span><br><span class="line">Date: Wed, 08 Jul 2020 18:11:00 +0800</span><br><span class="line">From: Onlyu-Gitlab &lt;yc_uuu@163.com&gt;</span><br><span class="line">Reply-To: Onlyu-Gitlab &lt;noreply@gitlab.onlyu.com&gt;</span><br><span class="line">To: 877348180@qq.com</span><br><span class="line">Message-ID: &lt;5f059bb4e7e31_e5253fb2a3fcf98c83859@lb02.mail&gt;</span><br><span class="line">Subject: hello</span><br><span class="line">Mime-Version: 1.0</span><br><span class="line">Content-Type: text/html;</span><br><span class="line"> charset=UTF-8</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Auto-Submitted: auto-generated</span><br><span class="line">X-Auto-Response-Suppress: All</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/REC-html40/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;p&gt;hello yuchao&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">=&gt; #&lt;Mail::Message:70036107130080, Multipart: false, Headers: &lt;Date: Wed, 08 Jul 2020 18:11:00 +0800&gt;, &lt;From: Onlyu-Gitlab &lt;yc_uuu@163.com&gt;&gt;, &lt;Reply-To: Onlyu-Gitlab &lt;noreply@gitlab.onlyu.com&gt;&gt;, &lt;To: 877348180@qq.com&gt;, &lt;Message-ID: &lt;5f059bb4e7e31_e5253fb2a3fcf98c83859@lb02.mail&gt;&gt;, &lt;Subject: hello&gt;, &lt;Mime-Version: 1.0&gt;, &lt;Content-Type: text/html; charset=UTF-8&gt;, &lt;Content-Transfer-Encoding: 7bit&gt;, &lt;Auto-Submitted: auto-generated&gt;, &lt;X-Auto-Response-Suppress: All&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>4.初始化gitlab</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 注意，当修改了gitlab配置文件，就得reconfigure</span><br><span class="line">[root@lb02 opt]# gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"># 启停</span><br><span class="line">gitlab-ctl start |restart |status |stop</span><br><span class="line"></span><br><span class="line"># 初始化之后，gitlab组件都已经启动了</span><br><span class="line">[root@lb02 opt]# gitlab-ctl status</span><br></pre></td></tr></table></figure>

<p><strong>Gitlab服务构成</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GitLab 由主要由以下服务构成，他们共同承担了 Gitlab 的运作需要</span><br><span class="line">Nginx:静态 web 服务器。</span><br><span class="line">gitlab-shell:用于处理 Git 命令和修改 authorized keys 列表。 </span><br><span class="line">gitlab-workhorse: 轻量级的反向代理服务器。 logrotate:日志文件管理工具。</span><br><span class="line">postgresql:数据库。</span><br><span class="line">redis:缓存数据库。</span><br><span class="line">sidekiq:用于在后台执行队列任务(异步执行)。</span><br><span class="line">unicorn:An HTTP server for Rack applications，GitLab Rails 应用是托管在这个</span><br></pre></td></tr></table></figure>

<p>6.首次访问gitlab</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://172.20.0.51/</span><br><span class="line"></span><br><span class="line">首次需要输入2次密码</span><br><span class="line">chaoge666</span><br><span class="line">chaoge666</span><br><span class="line"></span><br><span class="line">然后可以登录，默认账号密码</span><br><span class="line">root</span><br><span class="line">chaoge666</span><br></pre></td></tr></table></figure>

<p>7.gitlab管理命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl start</span><br><span class="line">gitlab-ctl stop</span><br><span class="line">gitlab-ctl stop postgresql</span><br><span class="line">gitlab-ctl restart </span><br><span class="line">gitlab-ctl status</span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl tail</span><br><span class="line">gitlab-ctl tail redis</span><br></pre></td></tr></table></figure>

<p>gitlab主要目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/var/opt/gitlab/git-data/repositories/ ：库默认存储目录</span><br><span class="line">/opt/gitlab  ：应用代码和相应的依赖程序</span><br><span class="line">/var/opt/gitlab/ ： gitlab-ctl reconfigure生成的数据和配置</span><br><span class="line">/etc/gitlab ：配置文件目录</span><br><span class="line">/var/log/gitlab：此目录下存放了gitlab各个组件产生的日志</span><br><span class="line">/var/opt/gitlab/backups ：备份文件生成的目录</span><br></pre></td></tr></table></figure>

<h3 id="gitlab汉化配置"><a href="#gitlab汉化配置" class="headerlink" title="gitlab汉化配置"></a>gitlab汉化配置</h3><p>汉化地址<code>https://gitlab.com/xhang/gitlab</code>，可以进行下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">解压缩下载的汉化包</span><br><span class="line">[root@lb02 opt]# tar -xf gitlab-12-0-stable-zh.tar.gz</span><br><span class="line"></span><br><span class="line"># 确保汉化包，和gitlab软件包版一致</span><br><span class="line"></span><br><span class="line"># 停止gitlab</span><br><span class="line">[root@lb02 opt]# gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"># 中文覆盖英文，使用原生cp命令，直接进行覆盖，出现的错误直接忽略</span><br><span class="line">[root@lb02 opt]# \cp -rf gitlab-12-0-stable-zh/* /opt/gitlab/embedded/service/gitlab-rails/</span><br><span class="line"></span><br><span class="line"># 再次启动</span><br><span class="line">gitlab-ctl start</span><br><span class="line"></span><br><span class="line"># 稍微等待一会，再次访问gitlab，若是出现502，再等会</span><br><span class="line">http://172.20.0.51/</span><br></pre></td></tr></table></figure>

<p>再次修改gitlab字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">个人中心 &gt; settings &gt; Preferences &gt; Localization &gt; Language &gt;  简体中文</span><br><span class="line"></span><br><span class="line">刷新后，此时gitlab基本已经是中文维护了</span><br></pre></td></tr></table></figure>

<h3 id="Gitlab关闭用户注册"><a href="#Gitlab关闭用户注册" class="headerlink" title="Gitlab关闭用户注册"></a>Gitlab关闭用户注册</h3><p>我们GItlab是企业级内部私有代码仓库，所有用户都英国由管理员创建，而非外部注册，我们可以关闭其功能，保障平台安全。</p>
<p><img src="pic/image-20200708113651522.png" alt="image-20200708113651522"></p>
<p>1.使用root用户管理员登录，点击<code>管理中心</code> &gt; <code>settings设置</code></p>
<p><img src="pic/image-20200708114126644.png" alt="image-20200708114126644"></p>
<p>2.保存后，退出登录，发现已经没有注册选项了。</p>
<h2 id="Gitlab仓库管理"><a href="#Gitlab仓库管理" class="headerlink" title="Gitlab仓库管理"></a>Gitlab仓库管理</h2><h3 id="用户、组、项目联系"><a href="#用户、组、项目联系" class="headerlink" title="用户、组、项目联系"></a>用户、组、项目联系</h3><p><img src="pic/image-20200708135625100.png" alt="image-20200708135625100"></p>
<h3 id="创建组"><a href="#创建组" class="headerlink" title="创建组"></a>创建组</h3><p>Gitlab是通过组（group）的概念来统一管理仓库(project)和用户(user)，通过创建组，在组下创建仓库，再将用户加入组，从而实现用户和仓库的权限管理。</p>
<p><img src="pic/image-20200708120027011.png" alt="image-20200708120027011"></p>
<p>点击新建群组，在创建组页面中，组路径和名称为必填项，且该两处内容最好一致。</p>
<p>可见性级别，选择私有的即可</p>
<ul>
<li>Private：只有授权的用户才能看到</li>
<li>Internal：只要登录了gitlab即可看见</li>
<li>Public：公开仓库</li>
</ul>
<p><img src="pic/image-20200708133644978.png" alt="image-20200708133644978"></p>
<p>点击创建，即可创建组</p>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>在gitlab中，你可以创建project用来存储你的程序代码、作为一个问题跟踪器，用于代码协作，用于持续集成中的构建、测试和部署等。</p>
<p>在管理员区域点击New project按钮，或者点击导航栏的＋。</p>
<p><img src="pic/image-20200708161738625.png" alt="image-20200708161738625"></p>
<p><img src="pic/image-20200708162002494.png" alt="image-20200708162002494"></p>
<p>选择项目所属的组，输入项目名称，项目描述，选择可见级别，完成项目创建。</p>
<p><img src="pic/image-20200708162239124.png" alt="image-20200708162239124"></p>
<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>在管理页面点击顶部的管理员区域，点击创建用户</p>
<p><img src="pic/image-20200708181845539.png" alt="image-20200708181845539"></p>
<h4 id="用户收到邮件"><a href="#用户收到邮件" class="headerlink" title="用户收到邮件"></a>用户收到邮件</h4><p>在正确配置邮箱后，用户收到邮件，可以自行修改密码</p>
<p><img src="pic/image-20200708181930838.png" alt="image-20200708181930838"></p>
<p>自行修改密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">caixukun666</span><br></pre></td></tr></table></figure>

<p>改完密码后，应该会再收到一封邮件</p>
<p><img src="pic/image-20200708182134042.png" alt="image-20200708182134042"></p>
<h4 id="用户登录gitlab"><a href="#用户登录gitlab" class="headerlink" title="用户登录gitlab"></a>用户登录gitlab</h4><p><img src="pic/image-20200708182238410.png" alt="image-20200708182238410"></p>
<p>默认普通用户登录后，是看不到项目的，这是因为你这个用户还没有加入组呀，是不是</p>
<h4 id="再创建一个普通用户"><a href="#再创建一个普通用户" class="headerlink" title="再创建一个普通用户"></a>再创建一个普通用户</h4><p>注意用户信息得唯一，不得重复，如邮箱也要输入正确地址，否则只能通过管理员修改</p>
<p><img src="pic/image-20200708182821452.png" alt="image-20200708182821452"></p>
<p>管理员可以手动给普通用户修改密码。</p>
<p><img src="pic/image-20200708182913239.png" alt="image-20200708182913239"></p>
<h4 id="root管理员来分配组权限"><a href="#root管理员来分配组权限" class="headerlink" title="root管理员来分配组权限"></a>root管理员来分配组权限</h4><p>此时两个普通用户登录都是看不到项目的，因为都还没有分配组权限。</p>
<p>给菜徐琨用户分配管理员权限，因为root是超级用户，我们得针对每一个组有一个领导是不是。</p>
<p><img src="pic/image-20200708183433377.png" alt="image-20200708183433377"></p>
<p>给鲁智深用户开发人员权限，开发人员权限，只有推送代码，提交代码了。</p>
<p><img src="pic/image-20200708183514770.png" alt="image-20200708183514770"></p>
<h4 id="分别用普通用户登录查看"><a href="#分别用普通用户登录查看" class="headerlink" title="分别用普通用户登录查看"></a>分别用普通用户登录查看</h4><p>菜徐琨作为【所有者】登录，可以对项目进行修改操作，邀请成员等等</p>
<p>鲁智深首次登录，若是管理员修改的密码，自己还得再修改一次，登陆后，作为【开发人员】，权限较低，看不到<code>设置</code>选项。</p>
<h2 id="配置SSH-KEY"><a href="#配置SSH-KEY" class="headerlink" title="配置SSH KEY"></a>配置SSH KEY</h2><p>前面我们已经在GitLab建立了仓库，并且授权用户可以使用仓库，我们所有的操作都是在Web界面进行的，接着我们就要配置客户端来连接代码仓库了。</p>
<p>我们的仓库是私有的，只有授权的用户才可以访问到该仓库，那么只要将客户端的用户 与我们GitLab的用户绑定，客户端即可访问到GitLab上的仓库，我们建议使用SSH方式实 现客户端与 Gitlab 用户的绑定，具体配置如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.选择登陆一个客户端机器，生成ssh密钥对，注意，若是已经有了，可以直接复制，不需要再生成，否则会覆盖原有的密钥对</span><br><span class="line">[yuchao@yumac ~]$ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">2.和码云的操作一样，添加本地的公钥信息，发给gitlab，我们用root用户登录gitlab</span><br><span class="line">cat ~/.ssh/id_rsa.pub  # 复制结果，粘贴到gitlab的密钥输入框里即可</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200709135211798.png" alt="image-20200709135211798"></p>
<h3 id="推送代码到gitlab"><a href="#推送代码到gitlab" class="headerlink" title="推送代码到gitlab"></a>推送代码到gitlab</h3><p>推送代码的几种情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">命令行指引</span><br><span class="line">您还可以按照以下说明从计算机中上传现有文件。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Git 全局设置</span><br><span class="line">git config --global user.name &quot;Administrator&quot;</span><br><span class="line">git config --global user.email &quot;admin@example.com&quot;</span><br><span class="line"></span><br><span class="line">创建一个新仓库</span><br><span class="line">git clone git@172.20.0.51:chaochao/learn_gitlab.git</span><br><span class="line">cd learn_gitlab</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;add README&quot;</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line">推送现有文件夹</span><br><span class="line">cd existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin git@172.20.0.51:chaochao/learn_gitlab.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line">推送现有的 Git 仓库</span><br><span class="line">cd existing_repo</span><br><span class="line">git remote rename origin old-origin</span><br><span class="line">git remote add origin git@172.20.0.51:chaochao/learn_gitlab.git</span><br><span class="line">git push -u origin --all</span><br><span class="line">git push -u origin --tags</span><br></pre></td></tr></table></figure>

<h3 id="在客户端上执行命令"><a href="#在客户端上执行命令" class="headerlink" title="在客户端上执行命令"></a>在客户端上执行命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.若是本地没有代码仓库，首次可以直接git clone获取代码</span><br><span class="line">git clone git@172.20.0.51:chaochao/learn_gitlab.git</span><br><span class="line"></span><br><span class="line">2.可以进入代码仓库，编写代码后提交</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$cd learn_gitlab</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$echo &quot;首次用客户端推送代码到gitlab测试~~&quot; &gt; push_code.txt</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git add .</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git commit -m &#x27;first commit txt file. &#x27;</span><br><span class="line">[master (root-commit) 09584dc] first commit txt file.</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 push_code.txt</span><br><span class="line"></span><br><span class="line"> [yuchao@yumac ~/luffy_code/learn_gitlab]$git push -u origin master</span><br><span class="line">Enumerating objects: 3, done.</span><br><span class="line">Counting objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (3/3), 265 bytes | 265.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To gitlab.onlyu.com:chaochao/learn_gitlab.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">Branch &#x27;master&#x27; set up to track remote branch &#x27;master&#x27; from &#x27;origin&#x27;.</span><br><span class="line"></span><br><span class="line">3.此时代码已经推送到远程仓库</span><br></pre></td></tr></table></figure>

<h3 id="推送分支代码"><a href="#推送分支代码" class="headerlink" title="推送分支代码"></a>推送分支代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 新建分支，且切换</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git checkout -b dev</span><br><span class="line">Switched to a new branch &#x27;dev&#x27;</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git branch</span><br><span class="line">* dev</span><br><span class="line">  master</span><br><span class="line"></span><br><span class="line"># 分支下，开发代码，且commit</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$echo &quot;我是dev分支下的代码&quot; &gt; dev.txt</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git add .</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git commit -m &quot;add dev.txt  by dev.&quot;</span><br><span class="line">[dev 3e88004] add dev.txt  by dev.</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 dev.txt</span><br><span class="line"></span><br><span class="line"> #代码推送</span><br><span class="line"> [yuchao@yumac ~/luffy_code/learn_gitlab]$git push -u origin dev</span><br><span class="line">Enumerating objects: 4, done.</span><br><span class="line">Counting objects: 100% (4/4), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 301 bytes | 301.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote:</span><br><span class="line">remote: To create a merge request for dev, visit:</span><br><span class="line">remote:   http://gitlab.onlyu.com/chaochao/learn_gitlab/merge_requests/new?merge_request%5Bsource_branch%5D=dev</span><br><span class="line">remote:</span><br><span class="line">To gitlab.onlyu.com:chaochao/learn_gitlab.git</span><br><span class="line"> * [new branch]      dev -&gt; dev</span><br><span class="line">Branch &#x27;dev&#x27; set up to track remote branch &#x27;dev&#x27; from &#x27;origin&#x27;.</span><br></pre></td></tr></table></figure>

<p>此时在gitlab项目中，已然生成了dev分支，且可以看到分支下的代码</p>
<p><img src="pic/image-20200709142244529.png" alt="image-20200709142244529"></p>
<h4 id="合并分支且推送gitlab"><a href="#合并分支且推送gitlab" class="headerlink" title="合并分支且推送gitlab"></a>合并分支且推送gitlab</h4><p>dev开发了新功能，领导在确认无误后，决定给合并到master分支，线上运行的就是master主干分支的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.在本地合并分支</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">Your branch is up to date with &#x27;origin/master&#x27;.</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git merge dev</span><br><span class="line">Updating 09584dc..3e88004</span><br><span class="line">Fast-forward</span><br><span class="line"> dev.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 dev.txt</span><br><span class="line"></span><br><span class="line">2.本地合完了代码，还得推送到gitlab才行</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git push -u origin master</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">To gitlab.onlyu.com:chaochao/learn_gitlab.git</span><br><span class="line">   09584dc..3e88004  master -&gt; master</span><br><span class="line">Branch &#x27;master&#x27; set up to track remote branch &#x27;master&#x27; from &#x27;origin&#x27;.</span><br></pre></td></tr></table></figure>

<p>此时master和dev都有相同的代码了。</p>
<h3 id="推送tag"><a href="#推送tag" class="headerlink" title="推送tag"></a>推送tag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git tag -a &quot;v1.0&quot; -m &quot;first tag.&quot;</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git tag</span><br><span class="line">v1.0</span><br><span class="line">[yuchao@yumac ~/luffy_code/learn_gitlab]$git push origin v1.0</span><br><span class="line">Enumerating objects: 1, done.</span><br><span class="line">Counting objects: 100% (1/1), done.</span><br><span class="line">Writing objects: 100% (1/1), 152 bytes | 152.00 KiB/s, done.</span><br><span class="line">Total 1 (delta 0), reused 0 (delta 0)</span><br><span class="line">To gitlab.onlyu.com:chaochao/learn_gitlab.git</span><br><span class="line"> * [new tag]         v1.0 -&gt; v1.0</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200709143003169.png" alt="image-20200709143003169"></p>
<h2 id="Gitlab备份、恢复、升级"><a href="#Gitlab备份、恢复、升级" class="headerlink" title="Gitlab备份、恢复、升级"></a>Gitlab备份、恢复、升级</h2><p>对 gitlab 进行备份将会创建一个包含所有库和附件的归档文件。对备份的恢复只能恢 复到与备份时的 gitlab 相同的版本。将 gitlab 迁移到另一台服务器上的最佳方法就是通过 备份和还原。gitlab提供了一个简单的命令行来备份整个gitlab，并且能灵活的满足需求。</p>
<h3 id="修改备份配置"><a href="#修改备份配置" class="headerlink" title="修改备份配置"></a>修改备份配置</h3><p>备份文件将保存在配置文件中定义的 backup_path 中，文件名为 TIMESTAMP_gitlab_backup.tar,TIMESTAMP 为备份时的时间戳。TIMESTAMP 的格式为: EPOCH_YYYY_MM_DD_Gitlab-version。</p>
<p>默认的备份文件目录为:/var/opt/gitlab/backups，如果自定义备份目录需要赋予目 录 git 权限，具体操作如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 修改默认存放路径，修改配置文件</span><br><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line"># 打开参数，备份默认保留七天</span><br><span class="line">gitlab_rails[&#x27;backup_keep_time&#x27;] = 604800</span><br><span class="line">gitlab_rails[&#x27;backup_path&#x27;] = &quot;/data/backups/gitlab&quot;</span><br><span class="line"></span><br><span class="line"># 执行如下命令，重新加载gitlab</span><br><span class="line">[root@lb02 ~]# mkdir -p /data/backups/gitlab</span><br><span class="line">[root@lb02 ~]# chown -R git.git /data/backups/gitlab</span><br><span class="line">[root@lb02 ~]# gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"># 手动备份，此时就会在对应的备份目录下，产生数据</span><br><span class="line">[root@lb02 ~]# gitlab-rake gitlab:backup:create</span><br></pre></td></tr></table></figure>

<h3 id="定时备份"><a href="#定时备份" class="headerlink" title="定时备份"></a>定时备份</h3><p>对于数据安全，备份操作可以进行定时任务添加，做到每天备份一次。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 gilab]# crontab -l</span><br><span class="line">0 2 * * * /usr/bin/gitlab-rake gitlab:backup:create &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure>

<h3 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h3><p>Gitlab的恢复只能恢复到与原本备份文件相同的gitlab版本中，恢复时，需要停止数据库的写入操作，但是保持gitlab是运行的。</p>
<p>暂停数据库写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 gilab]# gitlab-ctl stop unicorn</span><br><span class="line">ok: down: unicorn: 0s, normally up</span><br><span class="line"></span><br><span class="line">[root@lb02 gilab]# gitlab-ctl stop sidekiq</span><br><span class="line">ok: down: sidekiq: 0s, normally up</span><br><span class="line"></span><br><span class="line">[root@lb02 gilab]# gitlab-ctl status</span><br><span class="line">run: alertmanager: (pid 58110) 77023s; run: log: (pid 4372) 103339s</span><br><span class="line">run: gitaly: (pid 58129) 77022s; run: log: (pid 3915) 103432s</span><br><span class="line">run: gitlab-monitor: (pid 58137) 77022s; run: log: (pid 4266) 103349s</span><br><span class="line">run: gitlab-workhorse: (pid 58150) 77021s; run: log: (pid 4169) 103369s</span><br><span class="line">run: grafana: (pid 58164) 77021s; run: log: (pid 4466) 103309s</span><br><span class="line">run: logrotate: (pid 110927) 2128s; run: log: (pid 4219) 103359s</span><br><span class="line">run: nginx: (pid 58198) 77020s; run: log: (pid 4193) 103365s</span><br><span class="line">run: node-exporter: (pid 58206) 77019s; run: log: (pid 4244) 103354s</span><br><span class="line">run: postgres-exporter: (pid 58213) 77019s; run: log: (pid 4399) 103335s</span><br><span class="line">run: postgresql: (pid 58226) 77018s; run: log: (pid 3967) 103425s</span><br><span class="line">run: prometheus: (pid 58229) 77018s; run: log: (pid 5342) 103115s</span><br><span class="line">run: redis: (pid 58248) 77019s; run: log: (pid 3804) 103439s</span><br><span class="line">run: redis-exporter: (pid 58254) 77018s; run: log: (pid 4340) 103344s</span><br><span class="line">down: sidekiq: 9s, normally up; run: log: (pid 4151) 103374s</span><br><span class="line">down: unicorn: 119s, normally up; run: log: (pid 4132) 103382s</span><br></pre></td></tr></table></figure>

<p>进行数据恢复</p>
<p>整个恢复过程基本是在删除表，创建表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 只需要填写备份文件的时间戳信息即可</span><br><span class="line">[root@lb02 gilab]# gitlab-rake gitlab:backup:restore BACKUP=1594278431_2020_07_09_12.0.3</span><br><span class="line">Unpacking backup ... done</span><br><span class="line">Before restoring the database, we will remove all existing</span><br><span class="line">tables to avoid future upgrade problems. Be aware that if you have</span><br><span class="line">custom tables in the GitLab database these tables and all data will be</span><br><span class="line">removed.</span><br><span class="line"></span><br><span class="line">Do you want to continue (yes/no)? yes</span><br></pre></td></tr></table></figure>

<p>重新启动gitlab数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 gilab]# gitlab-ctl restart</span><br></pre></td></tr></table></figure>

<p>重新访问gitlab，可以用<code>gitlab-ctl tail</code>查看日志信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.20.0.51/</span><br></pre></td></tr></table></figure>

<h3 id="升级操作"><a href="#升级操作" class="headerlink" title="升级操作"></a>升级操作</h3><p>升级操作不建议操作，只需做了解过程即可，或者再建一台虚拟机操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1.关闭gitlab自带的服务</span><br><span class="line">[root@lb02 gilab]# gitlab-ctl stop unicorn</span><br><span class="line">[root@lb02 gilab]# gitlab-ctl stop sidekiq</span><br><span class="line">gitlab-ctl stop nginx</span><br><span class="line"></span><br><span class="line">2.立即备份现有gitlab数据</span><br><span class="line">gitlab-rake gitlab:backup:create</span><br><span class="line"></span><br><span class="line">3.下载新版本的gitlab软件包</span><br><span class="line"></span><br><span class="line">4.直接安装新版本</span><br><span class="line">yum localinstall 新版gitlab</span><br><span class="line"></span><br><span class="line">如果出现报错，解决办法如下</span><br><span class="line">//报错.</span><br><span class="line">Error executing action `run` on resource &#x27;ruby_block[directory resource: /var/opt/gitlab/git-data/repositories]&#x27;</span><br><span class="line"></span><br><span class="line">//解决方法:</span><br><span class="line">[root@gitlab-ce ~]# chmod 2770 /var/opt/gitlab/git-data/repositories</span><br><span class="line"></span><br><span class="line">5.安装完毕后，启动gitlab即可</span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl restart</span><br><span class="line"># 查看gitlab版本</span><br><span class="line">head -1 /opt/gitlab/version-manifest.txt</span><br></pre></td></tr></table></figure>

<h1 id="jenkins结合gitlab"><a href="#jenkins结合gitlab" class="headerlink" title="jenkins结合gitlab"></a>jenkins结合gitlab</h1><h3 id="选择gitlab代码仓库"><a href="#选择gitlab代码仓库" class="headerlink" title="选择gitlab代码仓库"></a>选择gitlab代码仓库</h3><h3 id="安装gitlab的笔记"><a href="#安装gitlab的笔记" class="headerlink" title="安装gitlab的笔记"></a>安装gitlab的笔记</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">1.centos7安装配置gitlab，服务器环境学习环境，最少2G，生产环境至少4G，关闭防火墙</span><br><span class="line"></span><br><span class="line">2.安装依赖环境</span><br><span class="line">yum install curl policycoreutils openssh-server openssh-clients policycoreutils-python postfix wget -y</span><br><span class="line"></span><br><span class="line">3.确保服务启动</span><br><span class="line">[root@m01 My-freestyle-job]# systemctl enable postfix</span><br><span class="line">[root@m01 My-freestyle-job]# systemctl start postfix</span><br><span class="line"></span><br><span class="line">4.获取gitlab软件包，或者直接向超哥要，QQ:87734810</span><br><span class="line">[root@m01 ci_cd_rpm]# wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-10.2.2-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">5.rpm命令安装gitlab软件</span><br><span class="line">[root@m01 ci_cd_rpm]# rpm -ivh gitlab-ce-10.2.2-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">6.首次安装初始化gitlab，只能执行一次，这个过程可能较长</span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line">7.对gitlab进行启停，gitlab默认运行会开启诸多服务</span><br><span class="line">gitlab-ctl status/stop/start    启动gitlab</span><br><span class="line">gitlab-ctl reconfigure    重新加载配置</span><br><span class="line">gitlab-ctl tail                 检查日志</span><br><span class="line">gitlab-ctl status</span><br><span class="line"></span><br><span class="line">[root@m01 ci_cd_rpm]# gitlab-ctl status</span><br><span class="line">run: gitaly: (pid 42025) 26s; run: log: (pid 41657) 91s</span><br><span class="line">run: gitlab-monitor: (pid 42041) 26s; run: log: (pid 41767) 79s</span><br><span class="line">run: gitlab-workhorse: (pid 42014) 27s; run: log: (pid 41601) 105s</span><br><span class="line">run: logrotate: (pid 41637) 97s; run: log: (pid 41636) 97s</span><br><span class="line">run: nginx: (pid 41615) 103s; run: log: (pid 41614) 103s</span><br><span class="line">run: node-exporter: (pid 41712) 85s; run: log: (pid 41711) 85s</span><br><span class="line">run: postgres-exporter: (pid 42062) 24s; run: log: (pid 41891) 60s</span><br><span class="line">run: postgresql: (pid 41340) 153s; run: log: (pid 41339) 153s</span><br><span class="line">run: prometheus: (pid 42050) 25s; run: log: (pid 41809) 66s</span><br><span class="line">run: redis: (pid 41276) 159s; run: log: (pid 41275) 159s</span><br><span class="line">run: redis-exporter: (pid 41790) 72s; run: log: (pid 41789) 72s</span><br><span class="line">run: sidekiq: (pid 41580) 111s; run: log: (pid 41579) 111s</span><br><span class="line">run: unicorn: (pid 42132) 15s; run: log: (pid 41535) 117s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8.修改gitlab主配置文件，</span><br><span class="line"># 修改gitlab占用过多内存的配置</span><br><span class="line"># 修改gitlab的仓库地址显示</span><br><span class="line"># 很多程序会占用8080端口，修改gitlab自带端口，打开如下注释</span><br><span class="line">[root@m01 ci_cd_rpm]# grep -Ev &quot;^#|^$&quot; /etc/gitlab/gitlab.rb</span><br><span class="line">unicorn[&#x27;worker_processes&#x27;] = 2                  # 填写CPU核数+1，减少进程数</span><br><span class="line">external_url &#x27;http://192.168.178.120&#x27;</span><br><span class="line">unicorn[&#x27;port&#x27;] = 8088    </span><br><span class="line">postgresql[&#x27;shared_buffers&#x27;] = &quot;256MB&quot;    # 减少数据库缓存</span><br><span class="line">unicorn[&#x27;worker_memory_limit_min&#x27;] = &quot;200 * 1 &lt;&lt; 20&quot;    # 减少内存占用</span><br><span class="line">unicorn[&#x27;worker_memory_limit_max&#x27;] = &quot;300 * 1 &lt;&lt; 20&quot;</span><br><span class="line">sidekiq[&#x27;concurrency&#x27;] = 16        # 减少任务调度并发数</span><br><span class="line">postgresql[&#x27;max_worker_processes&#x27;] = 8  #数据库并发数改为8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 改完之后，重新加载gitlab</span><br><span class="line">[root@m01 ci_cd_rpm]# gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9.通过浏览器访问页面服务器ip，默认开启了nginx的web端口，设置初始密码，操作类似github</span><br><span class="line">http://192.168.178.120/</span><br><span class="line"></span><br><span class="line">10.首次登录，设置账户密码</span><br><span class="line">账户root</span><br><span class="line">密码chaoge666</span><br><span class="line"></span><br><span class="line">11.有关gitlab的配置文件</span><br><span class="line">gitlab-ce一键安装后可以利用rpm -ql gitlab-ce查询其文件安装路径及相关文件路径，其默认安装路径为/opt/gitlab/、程序数据及配置文件保存路径为/var/opt/gitlab下。</span><br><span class="line">相关默认位置</span><br><span class="line"></span><br><span class="line">代码仓库保存位置：/var/opt/gitlab/git-data/repositories/</span><br><span class="line">代码仓库备份位置：/var/opt/gitlab/backups/</span><br><span class="line">postgresql数据及配置目录：/var/opt/gitlab/postgresql/data/</span><br><span class="line">redis默认配置目录：/var/opt/gitlab/redis</span><br><span class="line">gitlab主要配置文件：/etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327151337010.png" alt="image-20200327151337010"></p>
<p><img src="pic/image-20200327151424531.png" alt="image-20200327151424531"></p>
<h3 id="创建gitlab代码仓库"><a href="#创建gitlab代码仓库" class="headerlink" title="创建gitlab代码仓库"></a>创建gitlab代码仓库</h3><p><img src="pic/image-20200327151757966.png" alt="image-20200327151757966"></p>
<h3 id="从码云导入代码项目"><a href="#从码云导入代码项目" class="headerlink" title="从码云导入代码项目"></a>从码云导入代码项目</h3><p>或者这个代码<a target="_blank" rel="noopener" href="https://gitee.com/kangjie1209/monitor?_from=gitee_search">https://gitee.com/kangjie1209/monitor?_from=gitee_search</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.登录码云</span><br><span class="line"></span><br><span class="line">2.获取码云仓库代码的 URL地址</span><br><span class="line">https://gitee.com/kangjie1209/monitor.git</span><br></pre></td></tr></table></figure>

<h4 id="从URL导入仓库"><a href="#从URL导入仓库" class="headerlink" title="从URL导入仓库"></a>从URL导入仓库</h4><p><img src="pic/image-20200327152240118.png" alt="image-20200327152240118"></p>
<h4 id="创建gitlab仓库"><a href="#创建gitlab仓库" class="headerlink" title="创建gitlab仓库"></a>创建gitlab仓库</h4><p><img src="pic/image-20200327152754628.png" alt="image-20200327152754628"></p>
<h4 id="gitlab导入URL仓库完毕"><a href="#gitlab导入URL仓库完毕" class="headerlink" title="gitlab导入URL仓库完毕"></a>gitlab导入URL仓库完毕</h4><p><img src="pic/image-20200327155023773.png" alt="image-20200327155023773"></p>
<h4 id="在jenkins中添加git代码管理"><a href="#在jenkins中添加git代码管理" class="headerlink" title="在jenkins中添加git代码管理"></a>在jenkins中添加git代码管理</h4><p><img src="pic/image-20200327153353487.png" alt="image-20200327153353487"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.检查是否有git</span><br><span class="line">[root@m01 ci_cd_rpm]# git</span><br><span class="line">-bash: git: 未找到命令</span><br><span class="line"></span><br><span class="line">2.安装git工具</span><br><span class="line">[root@m01 ci_cd_rpm]# yum install git -y</span><br><span class="line"></span><br><span class="line">3.保存jenkins配置之后，再次查看仓库地址配置</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327153812915.png" alt="image-20200327153812915"></p>
<h4 id="root用户和gitlab的认证配置"><a href="#root用户和gitlab的认证配置" class="headerlink" title="root用户和gitlab的认证配置"></a>root用户和gitlab的认证配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.生成ssh公私钥对，把公钥信息，发送给gitlab服务</span><br><span class="line">[root@m01 ci_cd_rpm]# ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">[root@m01 ci_cd_rpm]# cat ~/.ssh/id_rsa.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCrVGf5zoGu359mhWOhT5Rnh0sDVdh1mUiH0sO6aOJsn+WJZF4gGpGzG4TtJe0mHAozAElStWCmPnv2cQch5eM+nLtG/o/xY/P1JDSx+U2lY6GOGTIbbFIDO9FZrcMpGtP4e0sby1/KYslia4JWcOMFBYQUVPUpc9NOxLLPJK7qXUBy+dV0hYRbkn5GdG+d+GotZEqTC4nE7UoYhwRg2Ld7yRtotiMoD099WL1lsljfP2QRZ9hSurGgZ+BQZeSZ57d+LJBypVsYq11iaL7s6oaUFMeIAs6YkQK8l7GcWh4KLYn4G8Q4ljZGfVHpC5A2fW16rPZGE4qqddkGfX9AujjT root@m01</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327154239865.png" alt="image-20200327154239865"></p>
<p><img src="pic/image-20200327154328221.png" alt="image-20200327154328221"></p>
<h4 id="测试jenkins服务器本地拉取代码"><a href="#测试jenkins服务器本地拉取代码" class="headerlink" title="测试jenkins服务器本地拉取代码"></a>测试jenkins服务器本地拉取代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]# git clone git@192.168.178.120:root/monitor.git</span><br><span class="line">正克隆到 &#x27;monitor&#x27;...</span><br><span class="line">remote: Counting objects: 435, done.</span><br><span class="line">remote: Compressing objects: 100% (372/372), done.</span><br><span class="line">remote: Total 435 (delta 53), reused 435 (delta 53)</span><br><span class="line">接收对象中: 100% (435/435), 8.78 MiB | 0 bytes/s, done.</span><br><span class="line">处理 delta 中: 100% (53/53), done.</span><br></pre></td></tr></table></figure>

<h4 id="再次测试jenkins和gitlab的连接性"><a href="#再次测试jenkins和gitlab的连接性" class="headerlink" title="再次测试jenkins和gitlab的连接性"></a>再次测试jenkins和gitlab的连接性</h4><p><img src="pic/image-20200327155304387.png" alt="image-20200327155304387"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jenkins是用root启动的</span><br><span class="line"></span><br><span class="line">root到gitlab也是通的</span><br><span class="line"></span><br><span class="line">因此如上jenkins+gitlab已经连接上了</span><br></pre></td></tr></table></figure>

<h4 id="修改jenkins启动用户-禁止该操作，有迷之bug"><a href="#修改jenkins启动用户-禁止该操作，有迷之bug" class="headerlink" title="修改jenkins启动用户(禁止该操作，有迷之bug)"></a>修改jenkins启动用户(禁止该操作，有迷之bug)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jenkins获取gitlab代码经常会出现问题，例如权限不足，我们这里可以把jenkins的启动用户改回去为jenkins</span><br><span class="line"></span><br><span class="line">[root@m01 ~]# grep &quot;JENKINS_USER&quot; /etc/sysconfig/jenkins</span><br><span class="line">JENKINS_USER=&quot;jenkins&quot;</span><br><span class="line"></span><br><span class="line"># 重启jenkins服务</span><br><span class="line">systemctl restart jenkins</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327160232307.png" alt="image-20200327160232307"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 发现jenkins配置文件的权限有问题</span><br><span class="line">[root@m01 ~]# ll /var/lib/jenkins/config.xml</span><br><span class="line">-rw------- 1 root root 1822 3月  26 11:05 /var/lib/jenkins/config.xml</span><br><span class="line"></span><br><span class="line"># 修改为jenkins用户</span><br><span class="line">[root@m01 ~]# chown jenkins:jenkins /var/lib/jenkins/config.xml</span><br><span class="line">[root@m01 ~]# ll /var/lib/jenkins/config.xml</span><br><span class="line">-rw------- 1 jenkins jenkins 1822 3月  26 11:05 /var/lib/jenkins/config.xml</span><br><span class="line"></span><br><span class="line"># 重启服务</span><br><span class="line">systemctl restart jenkins</span><br></pre></td></tr></table></figure>

<p>我们会发现更换jenkins用户后，后台的内容都变化了，因为jenkins一切皆文件，用户换了，就生成了新配置</p>
<h4 id="用私钥添加仓库认证"><a href="#用私钥添加仓库认证" class="headerlink" title="用私钥添加仓库认证"></a>用私钥添加仓库认证</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">新建iterm &gt; 自由风格软件项目 &gt; My-freestyle-job</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327162226259.png" alt="image-20200327162226259"></p>
<p><img src="pic/image-20200327162258267.png" alt="image-20200327162258267"></p>
<p>让jenkins拿着root用户的私钥，连接gitlab仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]# cat ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327162431704.png" alt="image-20200327162431704"></p>
<p>使用root的私钥认证</p>
<p><img src="pic/image-20200327162541623.png" alt="image-20200327162541623"></p>
<p>点击保存即可</p>
<h4 id="点击立即构建拉取代码"><a href="#点击立即构建拉取代码" class="headerlink" title="点击立即构建拉取代码"></a>点击立即构建拉取代码</h4><p><img src="pic/image-20200327165149754.png" alt="image-20200327165149754"></p>
<p><img src="pic/image-20200327165218802.png" alt="image-20200327165218802"></p>
<p>工作区里已经有了gitlab下载的代码</p>
<p><img src="pic/image-20200327165300057.png" alt="image-20200327165300057"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jenkins拉取的代码，在linux的位置</span><br><span class="line">[root@m01 My-freestyle-job]# pwd</span><br><span class="line">/var/lib/jenkins/workspace/My-freestyle-job</span><br></pre></td></tr></table></figure>

<h2 id="jenkins部署html网站"><a href="#jenkins部署html网站" class="headerlink" title="jenkins部署html网站"></a>jenkins部署html网站</h2><h3 id="准备一个客户端linux"><a href="#准备一个客户端linux" class="headerlink" title="准备一个客户端linux"></a>准备一个客户端linux</h3><p>目的准备用jenkins部署代码，发送到该客户端机器，用nginx部署html静态代码</p>
<h3 id="在jenkins服务端编写脚本"><a href="#在jenkins服务端编写脚本" class="headerlink" title="在jenkins服务端编写脚本"></a>在jenkins服务端编写脚本</h3><p>jenkins拉取gitlab的代码，想要发送给客户端机器 常规思路都是进行打包发送，因为大量零散的文件，会造成大量IO，速度较慢，打包压缩后发送，能够提升传输效率。</p>
<h3 id="配置jenkins和客户端免密登录"><a href="#配置jenkins和客户端免密登录" class="headerlink" title="配置jenkins和客户端免密登录"></a>配置jenkins和客户端免密登录</h3><p>配置jenkins和客户端免密登录，发送jenkins机器公钥给目标机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 My-freestyle-job]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.178.121</span><br></pre></td></tr></table></figure>

<p>编写部署脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 My-freestyle-job]# mkdir -p /server/scripts</span><br><span class="line">[root@m01 My-freestyle-job]# cd /server/scripts/</span><br><span class="line"></span><br><span class="line">[root@m01 scripts]# cat deploy.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">name=web-$(date +%F)-$(($RANDOM+10000))</span><br><span class="line"># 脚本接收2个参数，第一个是主机地址  ，第二个是任务名</span><br><span class="line">host=$1</span><br><span class="line">job_name=$2</span><br><span class="line"># 进入jenkins工作区，压缩所有文件放入指定目录，生成压缩文件</span><br><span class="line">cd /var/lib/jenkins/workspace/$&#123;job_name&#125;  &amp;&amp; tar -zcf /opt/$&#123;name&#125;.tar.gz ./*</span><br><span class="line"># 远程连接客户端机器，在客户端机器中创建对应资料文件夹，命名以 时间+随机数区分</span><br><span class="line">ssh $&#123;host&#125; &quot;cd /opt/nginx &amp;&amp; mkdir $&#123;name&#125;&quot;</span><br><span class="line"># 远程拷贝压缩文件，发给目标机器的nginx站点目录下</span><br><span class="line">scp /opt/$&#123;name&#125;.tar.gz $&#123;host&#125;:/opt/nginx/$&#123;name&#125;</span><br><span class="line"># 远程操控客户端机器，进入nginx站点，解压缩文件后，删除源文件</span><br><span class="line">ssh $&#123;host&#125; &quot;cd /opt/nginx/$&#123;name&#125;  &amp;&amp; tar -zxf $&#123;name&#125;.tar.gz &amp;&amp; rm -f $&#123;name&#125;.tar.gz&quot;</span><br><span class="line"># 远程操控客户端机器，进入nginx站点，删除旧html配置，创建软连接指向新的文件</span><br><span class="line">ssh $&#123;host&#125; &quot;cd /opt/nginx/ &amp;&amp; rm -rf html &amp;&amp; ln -s /opt/nginx/$&#123;name&#125; /opt/nginx/html&quot;</span><br></pre></td></tr></table></figure>

<h3 id="配置jenkins触发脚本执行"><a href="#配置jenkins触发脚本执行" class="headerlink" title="配置jenkins触发脚本执行"></a>配置jenkins触发脚本执行</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.访问jenkins站点</span><br><span class="line">http://192.168.178.120:8080/</span><br><span class="line"></span><br><span class="line">2.修改job配置</span><br></pre></td></tr></table></figure>

<p>配置好jenkins下载的代码仓库地址，且配置认证授权</p>
<p><img src="pic/image-20200327234142476.png" alt="image-20200327234142476"></p>
<p>配置jenkins的job，触发执行linux命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 这个JOB_NAME就是当前JOB的名字</span><br><span class="line">/usr/bin/sh /server/scripts/deploy.sh 192.168.178.121  $&#123;JOB_NAME&#125;</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200327234509953.png" alt="image-20200327234509953"></p>
<h3 id="点击立即构建"><a href="#点击立即构建" class="headerlink" title="点击立即构建"></a>点击立即构建</h3><p>构建中</p>
<p><img src="pic/image-20200327234541641.png" alt="image-20200327234541641"></p>
<h2 id="检查构建结果"><a href="#检查构建结果" class="headerlink" title="检查构建结果"></a>检查构建结果</h2><p>jenkins机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 scripts]# ls /opt/web* -l</span><br><span class="line">-rw-r--r-- 1 root root 4654245 3月  27 11:48 /opt/web-2020-03-27-29090.tar.gz</span><br></pre></td></tr></table></figure>

<p>客户端机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 客户端机器，已经生成了软连接，指向站点资料</span><br><span class="line">[root@web01 ~]# ll /opt/nginx/</span><br><span class="line">总用量 8</span><br><span class="line">drwx------ 2 nginx root    6 3月  18 23:16 client_body_temp</span><br><span class="line">drwxr-xr-x 3 root  root 4096 3月  27 11:27 conf</span><br><span class="line">drwx------ 2 nginx root    6 3月  18 23:16 fastcgi_temp</span><br><span class="line">lrwxrwxrwx 1 root  root   31 3月  27 11:49 html -&gt; /opt/nginx/web-2020-03-27-29090</span><br><span class="line">drwxr-xr-x 2 root  root   84 3月  27 11:26 logs</span><br><span class="line">drwx------ 2 nginx root    6 3月  18 23:16 proxy_temp</span><br><span class="line">drwxr-xr-x 2 root  root   19 3月  18 22:43 sbin</span><br><span class="line">drwx------ 2 nginx root    6 3月  18 23:16 scgi_temp</span><br><span class="line">drwx------ 2 nginx root    6 3月  18 23:16 uwsgi_temp</span><br><span class="line">drwxr-xr-x 8 root  root 4096 3月  27 11:48 web-2020-03-27-29090</span><br></pre></td></tr></table></figure>

<h3 id="测试访问脚本部署的站点页面"><a href="#测试访问脚本部署的站点页面" class="headerlink" title="测试访问脚本部署的站点页面"></a>测试访问脚本部署的站点页面</h3><p>也就是访问192.168.178.121页面，是否有我们从jenkins机器的脚本分发的页面</p>
<p><img src="pic/image-20200327233802639.png" alt="image-20200327233802639"></p>
<h2 id="构建触发器"><a href="#构建触发器" class="headerlink" title="构建触发器"></a>构建触发器</h2><h3 id="jenkins设置"><a href="#jenkins设置" class="headerlink" title="jenkins设置"></a>jenkins设置</h3><p><img src="pic/image-20200330222258599.png" alt="image-20200330222258599"></p>
<h3 id="gitlab设置"><a href="#gitlab设置" class="headerlink" title="gitlab设置"></a>gitlab设置</h3><p><img src="pic/image-20200330222035365.png" alt="image-20200330222035365"></p>
<p>结果 <img src="pic/image-20200330222119025.png" alt="image-20200330222119025"></p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p><img src="pic/image-20200330222527814.png" alt="image-20200330222527814"></p>
<p>jenkins自动触发</p>
<p><img src="pic/image-20200330222425761.png" alt="image-20200330222425761"></p>
<h3 id="手动发送post请求触发构建"><a href="#手动发送post请求触发构建" class="headerlink" title="手动发送post请求触发构建"></a>手动发送post请求触发构建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1.克隆项目</span><br><span class="line">[root@m01 ~]# git clone git@192.168.178.120:root/monitor.git</span><br><span class="line"></span><br><span class="line">2.修改git配置</span><br><span class="line">git config --global user.name &quot;pyyu&quot;</span><br><span class="line">git config --global user.email &quot;yc_uuu@163.com&quot;</span><br><span class="line">git config --global color.ui true</span><br><span class="line">git remote  add origin git@192.168.178.120:root/monitor.git</span><br><span class="line"></span><br><span class="line">3.修改代码内容，用git提交到仓库</span><br><span class="line">修改index.html，修改此处</span><br><span class="line">&lt;a class=&quot;logo pull-left&quot; href=&quot;index.html&quot; style=&quot;width: 233px&quot;&gt;超哥push触发构建&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">4.git添加</span><br><span class="line">git add .</span><br><span class="line">git commit -m &#x27;modify index.html on m01&#x27;</span><br><span class="line"></span><br><span class="line">5.推送改代码</span><br><span class="line">[root@m01 monitor]# git push origin master</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (3/3), 315 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 2), reused 0 (delta 0)</span><br><span class="line">To git@192.168.178.120:root/monitor.git</span><br><span class="line">   f6070e1..ff07938  master -&gt; master</span><br></pre></td></tr></table></figure>

<p><img src="pic/image-20200330224508121.png" alt="image-20200330224508121"></p>
<h4 id="自动构建结果"><a href="#自动构建结果" class="headerlink" title="自动构建结果"></a>自动构建结果</h4><p><img src="pic/image-20200330224823493.png" alt="image-20200330224823493"></p>
<h2 id="Jenkins返回构建状态"><a href="#Jenkins返回构建状态" class="headerlink" title="Jenkins返回构建状态"></a>Jenkins返回构建状态</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jenkins &gt; 系统管理 &gt; 系统配置</span><br></pre></td></tr></table></figure>

<p>填写gitlab地址</p>
<p><img src="pic/image-20200330230826625.png" alt="image-20200330230826625"></p>
<h3 id="生成gitlab的token"><a href="#生成gitlab的token" class="headerlink" title="生成gitlab的token"></a>生成gitlab的token</h3><p><img src="pic/image-20200330231333059.png" alt="image-20200330231333059"></p>
<p>生成如下token信息</p>
<p><img src="pic/image-20200330231359729.png" alt="image-20200330231359729"></p>
<p>粘贴token到jenkins</p>
<p><img src="pic/image-20200330231456032.png" alt="image-20200330231456032"></p>
<p><img src="pic/image-20200330231517159.png" alt="image-20200330231517159"></p>
<h3 id="配置job"><a href="#配置job" class="headerlink" title="配置job"></a>配置job</h3><p>配置【构建后操作】</p>
<p>构建完成后，让jenkins做什么事</p>
<p><img src="pic/image-20200330231743780.png" alt="image-20200330231743780"></p>
<p>当jenkins构建完毕后，结果会发给gitlab</p>
<p>在jenkins端点击构建后，检查gitlab代码仓库</p>
<p><img src="pic/image-20200330233258208.png" alt="image-20200330233258208"></p>
<p><img src="pic/image-20200330233324672.png" alt="image-20200330233324672"></p>
<p><img src="pic/image-20200330233337857.png" alt="image-20200330233337857"></p>
<p><img src="pic/image-20200330233419753.png" alt="image-20200330233419753"></p>
<h2 id="配置构建发送邮件"><a href="#配置构建发送邮件" class="headerlink" title="配置构建发送邮件"></a>配置构建发送邮件</h2><p>我们配置构建完毕任务后，通过邮件来通知相关人员构建的执行情况，具体配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在jenkins主页面 &gt; 系统管理 &gt;  系统设置  &gt; 快捷搜索Jenkins Location</span><br></pre></td></tr></table></figure>

<p>找到<strong>Jenkins Location</strong>之后，填好<code>JenkinsURL</code>和<code>系统管理员的邮箱</code></p>
<p><img src="pic/image-20200713131416418.png" alt="image-20200713131416418"></p>
<p>下拉倒最底行，找到【邮件通知】部分</p>
<p><img src="pic/image-20200713131917123.png" alt="image-20200713131917123"></p>
<p>以收到测试邮件的信息为准，表示此处邮箱通知发送没有问题。</p>
<p>保存设置。</p>
<h3 id="继续配置job"><a href="#继续配置job" class="headerlink" title="继续配置job"></a>继续配置job</h3><p>当jenkins系统设置的邮箱配置好，即可针对job进行配置，点击我们创建的job【My-freestyle-job】</p>
<p>选择如下区域</p>
<p><img src="pic/image-20200713133345574.png" alt="image-20200713133345574"></p>
<p>配置E-mail Notification选项</p>
<p><img src="pic/image-20200713133531091.png" alt="image-20200713133531091"></p>
<p>当构建失败后，会发邮件通知。</p>
<p>我们可以手动故意模拟错误设置，执行错误的shell，让jenkins构建失败，查看邮件通知，会收到构建失败的控制台日志信息。</p>
<p><img src="pic/image-20200713133842268.png" alt="image-20200713133842268"></p>
<h1 id="jenkins部署静态网站"><a href="#jenkins部署静态网站" class="headerlink" title="jenkins部署静态网站"></a>jenkins部署静态网站</h1><p>手动部署</p>
<p>这个就不说了，只需要拷贝静态文件，放置到nginx目录下即可。</p>
<h2 id="自动化部署"><a href="#自动化部署" class="headerlink" title="自动化部署"></a>自动化部署</h2><p>1.手动/自动化部署nginx集群</p>
<p>2.开发提交代码到gitlab</p>
<p>3.运维编写shell脚本，交给jenkins执行，获取代码，推送到nginx集群</p>
<p><img src="pic/image-20210223175157914.png" alt="image-20210223175157914"></p>
<p>脚本</p>
<p>html_deploy.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.进入代码目录，打包传输</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y-%m-%d-%H-%M-%S)</span><br><span class="line">web_server=<span class="string">&quot;10.211.55.12&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_code</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$WORKSPACE</span> &amp;&amp; \</span><br><span class="line">    tar czf /opt/web-<span class="variable">$&#123;DATE&#125;</span>.tar.gz ./*</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.代码发送给web集群组</span></span><br><span class="line"><span class="function"><span class="title">scp_web_server</span></span>()&#123;</span><br><span class="line"><span class="keyword">for</span> hosts <span class="keyword">in</span> <span class="variable">$web_server</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    scp /opt/web-<span class="variable">$&#123;DATE&#125;</span>.tar.gz root@<span class="variable">$hosts</span>:/opt/</span><br><span class="line">    ssh root@<span class="variable">$hosts</span> <span class="string">&quot;mkdir -p /code/web-<span class="variable">$&#123;DATE&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                    tar -zxf /opt/web-<span class="variable">$&#123;DATE&#125;</span>.tar.gz -C /code/web-<span class="variable">$&#123;DATE&#125;</span></span></span><br><span class="line"><span class="string">                  rm -rf /code/web &amp;&amp; \</span></span><br><span class="line"><span class="string">                  ln -s /code/web-<span class="variable">$&#123;DATE&#125;</span> /code/web&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">deploy</span></span>()&#123;</span><br><span class="line">        get_code</span><br><span class="line">        scp_web_server</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 执行入口</span></span><br><span class="line">deploy</span><br></pre></td></tr></table></figure>

<p>添加执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x html_deploy.sh</span><br></pre></td></tr></table></figure>

<p>注意jenkins机器，最好和应用服务器，免密登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">做好ssh-key的配置</span><br></pre></td></tr></table></figure>

<h1 id="jenkins部署Django"><a href="#jenkins部署Django" class="headerlink" title="jenkins部署Django"></a>jenkins部署Django</h1><p>python动态应用</p>
<blockquote>
<p>python一个优秀的编程语言</p>
<p>django这样的框架，去开发动态的网站</p>
</blockquote>
<h2 id="手动开发django欢迎页面"><a href="#手动开发django欢迎页面" class="headerlink" title="手动开发django欢迎页面"></a>手动开发django欢迎页面</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>python开发的，安装准备好python开发环境，python2，python3区分</span><br><span class="line"></span><br><span class="line">yum install python3 -y</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>安装django框架，且使用pip3命令安装，是给python安装模块的，yum给linux安装软件的</span><br><span class="line">pip3 install django==<span class="number">2.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">pip3 <span class="built_in">list</span> |grep -i django</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>使用命令， 创建django项目，且进行python开发</span><br><span class="line">[root@git01 django_cc]<span class="comment"># pwd</span></span><br><span class="line">/opt/django_cc</span><br><span class="line">[root@git01 django_cc]<span class="comment">#</span></span><br><span class="line">[root@git01 django_cc]<span class="comment">#</span></span><br><span class="line">[root@git01 django_cc]<span class="comment"># django-admin startproject my_django</span></span><br><span class="line">[root@git01 django_cc]<span class="comment"># ls</span></span><br><span class="line">my_django</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>django的目录结构</span><br><span class="line">[root@git01 my_django]<span class="comment"># tree /opt/django_cc/</span></span><br><span class="line">/opt/django_cc/</span><br><span class="line">└── my_django</span><br><span class="line">    ├── manage.py</span><br><span class="line">    └── my_django</span><br><span class="line">        ├── __init__.py</span><br><span class="line">        ├── settings.py</span><br><span class="line">        ├── urls.py</span><br><span class="line">        └── wsgi.py</span><br><span class="line"><span class="number">5.</span>创建django项目的app01</span><br><span class="line">[root@git01 my_django]<span class="comment"># python3 manage.py startapp app01</span></span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>再次查看目录结构</span><br><span class="line">[root@git01 my_django]<span class="comment"># tree /opt/django_cc/</span></span><br><span class="line">/opt/django_cc/</span><br><span class="line">└── my_django</span><br><span class="line">    ├── app01</span><br><span class="line">    │   ├── admin.py</span><br><span class="line">    │   ├── apps.py</span><br><span class="line">    │   ├── __init__.py</span><br><span class="line">    │   ├── migrations</span><br><span class="line">    │   │   └── __init__.py</span><br><span class="line">    │   ├── models.py</span><br><span class="line">    │   ├── tests.py</span><br><span class="line">    │   └── views.py</span><br><span class="line">    ├── manage.py</span><br><span class="line">    └── my_django</span><br><span class="line">        ├── __init__.py</span><br><span class="line">        ├── __pycache__</span><br><span class="line">        │   ├── __init__.cpython-<span class="number">36.</span>pyc</span><br><span class="line">        │   └── settings.cpython-<span class="number">36.</span>pyc</span><br><span class="line">        ├── settings.py</span><br><span class="line">        ├── urls.py</span><br><span class="line">        └── wsgi.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>开发网站的欢迎页面</span><br><span class="line">第一步，开发urls.py文件，给用户设置一个入口，访问的入口</span><br><span class="line">http://<span class="number">10.211</span><span class="number">.55</span><span class="number">.12</span>/hello/</span><br><span class="line"></span><br><span class="line">urls.py开发的内容如下</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入django的模块</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义python的函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;超哥欢迎你～python是非常有意思的&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 这是超哥添加的内容</span></span><br><span class="line">    path(<span class="string">&#x27;hello/&#x27;</span>,hello)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>修改django的配置文件</span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&quot;*&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">9.</span>尝试运行该代码</span><br><span class="line">[root@git01 my_django]<span class="comment"># python3 manage.py runserver 0.0.0.0:8005</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">10.</span>前<span class="number">9</span>部属于python程序员做的事，第十步骤，运维需要通过工具，部署运行django代码</span><br><span class="line">supervisor这是一个进程管理工具，能够检测到django挂了，自动的再次重启运行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">[root@git01 my_django]<span class="comment"># pip3 install supervisor</span></span><br><span class="line"><span class="comment"># 生成配置文件</span></span><br><span class="line">[root@git01 my_django]<span class="comment"># echo_supervisord_conf &gt; /etc/supervisor.conf</span></span><br><span class="line"><span class="comment"># 修改配置，管理我们的django，目录在/opt/django_cc/my_django/manage.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">vim /etc/supervisor.conf</span><br><span class="line"><span class="comment"># 在最底行写入如下配置，</span></span><br><span class="line">[program:chaoge_django]</span><br><span class="line">command=/usr/<span class="built_in">bin</span>/python3 /opt/django_cc/my_django/manage.py runserver <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8005</span></span><br><span class="line">autostart=true</span><br><span class="line">startsecs=<span class="number">10</span></span><br><span class="line">autorestart=true</span><br><span class="line">startretries=<span class="number">3</span></span><br><span class="line">priority=<span class="number">999</span></span><br><span class="line">redirect_stderr=true</span><br><span class="line">stdout_logfile=/var/log/chaoge_django.log</span><br><span class="line">stopasgroup=true</span><br><span class="line">killasgroup=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># http://10.211.55.12:8005/hello/</span></span><br><span class="line"></span><br><span class="line"><span class="number">11.</span>启动supervisor，也会自动的启动任务，django</span><br><span class="line">[root@git01 my_django]<span class="comment"># supervisorctl -c /etc/supervisor.conf</span></span><br><span class="line">chaoge_django                    RUNNING   pid <span class="number">3850</span>, uptime <span class="number">0</span>:<span class="number">00</span>:<span class="number">55</span></span><br><span class="line">supervisor&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">12.</span>演示自动重启django</span><br><span class="line">当supervisor发现django的进程挂了，会自动重新启动django</span><br></pre></td></tr></table></figure>

<h2 id="如何通过jenkins自动化的上线django代码"><a href="#如何通过jenkins自动化的上线django代码" class="headerlink" title="如何通过jenkins自动化的上线django代码"></a>如何通过jenkins自动化的上线django代码</h2><p>1.开发修改了django的功能，推送到gitlab</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.模拟开发更新代码，推送到gtilab</span><br></pre></td></tr></table></figure>

<p>2.运维通过jenkins部署django程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.新建jenkins的job</span><br><span class="line"></span><br><span class="line">2.运行job</span><br><span class="line"></span><br><span class="line">3.修改了supervisor的配置文件，你还得重启这个程序呀</span><br></pre></td></tr></table></figure>

<h1 id="Jenkins创建maven项目"><a href="#Jenkins创建maven项目" class="headerlink" title="Jenkins创建maven项目"></a>Jenkins创建maven项目</h1><p><img src="pic/image-20200713135417302.png" alt="image-20200713135417302"></p>
<h2 id="Java项目部署概述"><a href="#Java项目部署概述" class="headerlink" title="Java项目部署概述"></a>Java项目部署概述</h2><h3 id="什么是Java项目"><a href="#什么是Java项目" class="headerlink" title="什么是Java项目"></a>什么是Java项目</h3><p>就是java编写的代码，称之为java项目</p>
<h3 id="为什么java项目需要编译"><a href="#为什么java项目需要编译" class="headerlink" title="为什么java项目需要编译"></a>为什么java项目需要编译</h3><p>java编写的代码无法直接在服务器上运行，需要借助maven工具进行打包。</p>
<p>理解：Java源代码就像汽车的一堆散件，必须组装成一辆完整的汽车，才能进行使用，组装汽车零件的过程就是java代码编译过程，</p>
<h3 id="手动vs自动编译"><a href="#手动vs自动编译" class="headerlink" title="手动vs自动编译"></a>手动vs自动编译</h3><p>手动部署：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">得到程序员小哥写好的java源代码</span><br><span class="line">↓</span><br><span class="line">使用maven手动构建</span><br><span class="line">↓</span><br><span class="line">推送war包至tomcat进行发布</span><br></pre></td></tr></table></figure>

<p>java项目部署架构图</p>
<p><img src="pic/image-20200713141342272.png" alt="image-20200713141342272"></p>
<p>手动部署Maven项目的过程非常机械化，完全可以实现自动化。</p>
<p><img src="pic/image-20200713142021713.png" alt="image-20200713142021713"></p>
<h3 id="maven了解"><a href="#maven了解" class="headerlink" title="maven了解"></a>maven了解</h3><p>在了解Maven之前，我们先来看看一个Java项目需要的东西。首先，我们需要确定引入哪些依赖包。例如，如果我们需要用到<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-logging/">commons logging</a>，我们就必须把commons logging的jar包放入classpath。如果我们还需要<a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/">log4j</a>，就需要把log4j相关的jar包都放到classpath中。这些就是依赖包的管理。</p>
<p>其次，我们要确定项目的目录结构。例如，<code>src</code>目录存放Java源码，<code>resources</code>目录存放配置文件，<code>bin</code>目录存放编译生成的<code>.class</code>文件。</p>
<p>此外，我们还需要配置环境，例如JDK的版本，编译打包的流程，当前代码的版本号。</p>
<p>最后，除了使用Eclipse这样的IDE进行编译外，我们还必须能通过命令行工具进行编译，才能够让项目在一个独立的服务器上编译、测试、部署。</p>
<p>这些工作难度不大，但是非常琐碎且耗时。如果每一个项目都自己搞一套配置，肯定会一团糟。我们需要的是一个标准化的Java项目管理和构建工具。</p>
<p>Maven就是是专门为Java项目打造的管理和构建工具，它的主要功能有：</p>
<ul>
<li>提供了一套标准化的项目结构；</li>
<li>提供了一套标准化的构建流程（编译，测试，打包，发布……）；</li>
<li>提供了一套依赖管理机制。</li>
</ul>
<h3 id="Maven项目结构"><a href="#Maven项目结构" class="headerlink" title="Maven项目结构"></a>Maven项目结构</h3><p>一个使用Maven管理的普通的Java项目，它的目录结构默认如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a-maven-project</span><br><span class="line">├── pom.xml</span><br><span class="line">├── src</span><br><span class="line">│   ├── main</span><br><span class="line">│   │   ├── java</span><br><span class="line">│   │   └── resources</span><br><span class="line">│   └── test</span><br><span class="line">│       ├── java</span><br><span class="line">│       └── resources</span><br><span class="line">└── target</span><br></pre></td></tr></table></figure>

<h2 id="部署maven"><a href="#部署maven" class="headerlink" title="部署maven"></a>部署maven</h2><p>安装jdk</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 My-freestyle-job]# java -version</span><br><span class="line">java version &quot;1.8.0_121&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_121-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)</span><br></pre></td></tr></table></figure>

<p>获取maven安装文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.清华镜像站</span><br><span class="line">https://mirrors.tuna.tsinghua.edu.cn/apache/maven/</span><br><span class="line"></span><br><span class="line">2.下载maven</span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz</span><br><span class="line"></span><br><span class="line">3.解压缩，安装</span><br><span class="line">tar -xf apache-maven-3.3.9-bin.tar.gz</span><br><span class="line">ln -s /opt/apache-maven-3.3.9/ /usr/local/maven</span><br><span class="line"></span><br><span class="line">4.测试mvn命令</span><br><span class="line">[root@lb02 opt]# /usr/local/maven/bin/mvn -v</span><br><span class="line">Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)</span><br><span class="line">Maven home: /usr/local/maven</span><br><span class="line">Java version: 1.8.0_121, vendor: Oracle Corporation</span><br><span class="line">Java home: /usr/java/jdk1.8.0_121/jre</span><br><span class="line">Default locale: zh_CN, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;3.10.0-862.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br><span class="line"></span><br><span class="line">5.添加环境变量</span><br><span class="line">echo &quot;export PATH=/usr/local/maven/bin:$PATH&quot; &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h2 id="认识maven"><a href="#认识maven" class="headerlink" title="认识maven"></a>认识maven</h2><p>maven的工作目录结构如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 apache-maven-3.3.9]# pwd</span><br><span class="line">/opt/apache-maven-3.3.9</span><br><span class="line">[root@lb02 apache-maven-3.3.9]# ll</span><br><span class="line">总用量 32</span><br><span class="line">drwxr-xr-x 2 root root    97 7月  13 15:58 bin        mvn运行的脚本，连接java</span><br><span class="line">drwxr-xr-x 2 root root    42 7月  13 15:58 boot    类加载器,maven自己的类库</span><br><span class="line">drwxr-xr-x 3 root root    63 11月 11 2015 conf        配置文件目录</span><br><span class="line">drwxr-xr-x 3 root root  4096 7月  13 15:58 lib        运行maven时需要的java类库</span><br><span class="line">-rw-r--r-- 1 root root 19335 11月 11 2015 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root   182 11月 11 2015 NOTICE</span><br><span class="line">-rw-r--r-- 1 root root  2541 11月 11 2015 README.txt</span><br></pre></td></tr></table></figure>

<h3 id="maven命令"><a href="#maven命令" class="headerlink" title="maven命令"></a>maven命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">1.创建一个名为hello-world的maven项目</span><br><span class="line"></span><br><span class="line">[root@lb02 持续集成新版本课程]# tree hello-world</span><br><span class="line">hello-world</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   └── java</span><br><span class="line">    │       └── com</span><br><span class="line">    │           └── juvenxu</span><br><span class="line">    │               └── mvnbook</span><br><span class="line">    │                   └── helloworld</span><br><span class="line">    │                       └── HelloWorld.java</span><br><span class="line">    └── test</span><br><span class="line">        └── java</span><br><span class="line">            └── com</span><br><span class="line">                └── juvenxu</span><br><span class="line">                    └── mvnbook</span><br><span class="line">                        └── helloworld</span><br><span class="line">                            └── HelloWorldTest.java</span><br><span class="line"></span><br><span class="line">13 directories, 3 files</span><br><span class="line"></span><br><span class="line">2.清理mvn clean，项目临时产生的文件，一般是模块下达target目录</span><br><span class="line">[root@lb02 hello-world]# mvn clean</span><br><span class="line"></span><br><span class="line">3.项目打包命令mvn package</span><br><span class="line">[root@lb02 hello-world]# mvn package</span><br><span class="line">[root@lb02 hello-world]# cd target/</span><br><span class="line">[root@lb02 target]# ll</span><br><span class="line">总用量 8</span><br><span class="line">drwxr-xr-x 3 root root   17 7月  13 16:25 classes</span><br><span class="line">-rw-r--r-- 1 root root 3133 7月  13 16:26 hello-world-1.0-SNAPSHOT.jar</span><br><span class="line">drwxr-xr-x 2 root root   28 7月  13 16:25 maven-archiver</span><br><span class="line">drwxr-xr-x 3 root root   35 7月  13 16:25 maven-status</span><br><span class="line">-rw-r--r-- 1 root root 2875 7月  13 16:25 original-hello-world-1.0-SNAPSHOT.jar</span><br><span class="line">drwxr-xr-x 2 root root  125 7月  13 16:25 surefire-reports</span><br><span class="line">drwxr-xr-x 3 root root   17 7月  13 16:25 test-classes</span><br><span class="line"></span><br><span class="line">4.测试命令，执行src/test/java目录下的测试用例</span><br><span class="line">[root@lb02 hello-world]# mvn test</span><br><span class="line"></span><br><span class="line">5.模块安装，将打包好的jar/war文件复制到本地仓库</span><br><span class="line">[root@lb02 hello-world]# mvn install</span><br><span class="line"></span><br><span class="line"># 重点输出的信息</span><br><span class="line">[INFO] Installing /opt/持续集成新版本课程/hello-world/target/hello-world-1.0-SNAPSHOT.jar to /root/.m2/repository/com/juvenxu/mvnbook/hello-world/1.0-SNAPSHOT/hello-world-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] Installing /opt/持续集成新版本课程/hello-world/pom.xml to /root/.m2/repository/com/juvenxu/mvnbook/hello-world/1.0-SNAPSHOT/hello-world-1.0-SNAPSHOT.pom</span><br><span class="line"></span><br><span class="line">[root@lb02 hello-world]# cd /root/.m2/repository/com/juvenxu/mvnbook/hello-world/1.0-SNAPSHOT/</span><br><span class="line">[root@lb02 1.0-SNAPSHOT]# ll</span><br><span class="line">总用量 16</span><br><span class="line">-rw-r--r-- 1 root root 3133 7月  13 16:30 hello-world-1.0-SNAPSHOT.jar</span><br><span class="line">-rw-r--r-- 1 root root 1683 8月  26 2010 hello-world-1.0-SNAPSHOT.pom</span><br><span class="line">-rw-r--r-- 1 root root  710 7月  13 16:31 maven-metadata-local.xml</span><br><span class="line">-rw-r--r-- 1 root root  195 7月  13 16:31 _remote.repositories</span><br></pre></td></tr></table></figure>

<h2 id="开发人员提交代码到gitlab"><a href="#开发人员提交代码到gitlab" class="headerlink" title="开发人员提交代码到gitlab"></a>开发人员提交代码到gitlab</h2><p>新建项目</p>
<p><img src="pic/image-20200713170128757.png" alt="image-20200713170128757"></p>
<h3 id="修改maven配置"><a href="#修改maven配置" class="headerlink" title="修改maven配置"></a>修改maven配置</h3><p>添加国内源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/maven/conf/settings.xml</span><br><span class="line">找到159行，添加</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">      &lt;name&gt;aliyun maven.&lt;/name&gt;</span><br><span class="line">      &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br></pre></td></tr></table></figure>

<p>手动编译代码为war包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@lb02 hello-world]# pwd</span><br><span class="line">/opt/持续集成新版本课程/hello-world</span><br><span class="line">[root@lb02 hello-world]#</span><br><span class="line">[root@lb02 hello-world]# ls</span><br><span class="line">pom.xml  src  target</span><br><span class="line"></span><br><span class="line">[root@lb02 hello-world]# mvn package -Dmaven.test.skip=true</span><br><span class="line"></span><br><span class="line">生成了war包</span><br><span class="line">[INFO] Replacing /opt/持续集成新版本课程/hello-world/target/hello-world-1.0-SNAPSHOT.jar with /opt/持续集成新版本课程/hello-world/target/hello-world-1.0-SNAPSHOT-shaded.jar</span><br></pre></td></tr></table></figure>

<h1 id="jenkins流水线Pipeline"><a href="#jenkins流水线Pipeline" class="headerlink" title="jenkins流水线Pipeline"></a>jenkins流水线Pipeline</h1><p>学习jenkins的官网</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jenkins.io/zh/doc/book/pipeline/">https://www.jenkins.io/zh/doc/book/pipeline/</a></p>
</blockquote>
<h2 id="什么是流水线？"><a href="#什么是流水线？" class="headerlink" title="什么是流水线？"></a><strong>什么是流水线？</strong></h2><p>首先，了解 Jenkins 本身并不是流水线这一点很有帮助。</p>
<p>Jenkins只是创建一个新的 Jenkins 作业并不能构建一条流水线。可以把 Jenkins 看做一个遥控器，在这里点击按钮即可。当你点击按钮时会发生什么取决于遥控器要控制的内容。Jenkins 为其他应用程序 API、软件库、构建工具等提供了一种插入 Jenkins 的方法，它可以执行并自动化任务。Jenkins 本身不执行任何功能，但是随着其它工具的插入而变得越来越强大。</p>
<p>流水线是一个单独的概念，指的是按顺序连接在一起的事件或作业组：</p>
<blockquote>
<p>“ *流水线(pipeline)*”是可以执行的一系列事件或作业。</p>
</blockquote>
<p>理解流水线的最简单方法是可视化一系列阶段，如下所示：</p>
<p><img src="pic/image-20210225100028272.png" alt="image-20210225100028272"></p>
<p>在这里，你应该看到两个熟悉的概念： *阶段(Stage)*和 *步骤(Step)*。</p>
<ul>
<li>阶段stage：一个包含一系列步骤的块。阶段块可以命名为任何名称；它用于展示可视化流水线过程。<ul>
<li>stage就是起个名字，比如叫做【构建】、【获取代码】、【部署代码】</li>
</ul>
</li>
<li>步骤：表明要做什么的任务。步骤定义在阶段块内。<ul>
<li>步骤step就是具体要执行的命令</li>
<li>例如简单的，<code>echo &#39;hello,world&#39;</code></li>
</ul>
</li>
</ul>
<h2 id="Jenkins为什么用流水线"><a href="#Jenkins为什么用流水线" class="headerlink" title="Jenkins为什么用流水线"></a>Jenkins为什么用流水线</h2><p>什么是Pipeline？简单来说，就是一套运行于Jenkins上的工作流框架，将原本独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的复杂发布流程（实用场景：将多个Jenkins构建任务轻松集成）。</p>
<p> Pipeline的实现方式是一套Groovy DSL，任何发布流程都可以表述为一段Groovy脚本，并且Jenkins支持从代码库直接读取脚本，从而实现了Pipeline as Code的理念。</p>
<p><strong>使用条件</strong></p>
<p> 要使用Jenkins Pipeline，需要： Jenkins 2.x或更高版本、Pipeline插件</p>
<blockquote>
<p>Groovy是一种基于JVM（Java虚拟机）的敏捷开发语言，它结合了Python、Ruby和Smalltalk的许多强大的特性，Groovy 代码能够与 Java 代码很好地结合，也能用于扩展现有代码。由于其运行在 JVM 上的特性，Groovy 可以使用其他 Java 语言编写的库。</p>
</blockquote>
<p>为什么要使用Pipeline？对于实践微服务的团队，产品有很多服务组成，传统的在Jenkins中集中进行job配置的方式会成为瓶颈，微服务团队会将CI Job的配置和服务的发布交给具体负责某个服务的团队，这正需要Pipeline as Code； 除此之外，一次产品的发布会涉及到多个服务的协同发布，用单个CI Job实现起来会十分困难，使用Pipeline可以很好的完成这个需求。</p>
<h3 id="Pipeline的基本概念和Jenkins-file"><a href="#Pipeline的基本概念和Jenkins-file" class="headerlink" title="Pipeline的基本概念和Jenkins-file"></a>Pipeline的基本概念和Jenkins-file</h3><ul>
<li>Node：一个Node就是一个Jenkins节点，可以是Master，也可以是Slave，是Pipeline中具体Step的运行环境。</li>
<li>Stage：一个Pipeline有多个Stage组成，每个Stage包含一组Step。注意一个Stage可以跨多个Node执行，即Stage实际上是Step的逻辑分组。</li>
<li>Step：是最基本的运行单元，可以是创建一个目录、从代码库中checkout代码、执行一个shell命令、构建Docker镜像、将服务发布到Kubernetes集群中。Step由Jenkins和Jenkins各种插件提供。</li>
</ul>
<p>将node、stage、step的Groovy DSL写在一个Jenkinsfile文件中，Jenkinsfile会被放到代码库的根目录下。下面是一个Jenkinsfile的Helloworld的例子：</p>
<p><img src="pic/image-20210225101225848.png" alt="image-20210225101225848"></p>
<h2 id="简单pipeline案例"><a href="#简单pipeline案例" class="headerlink" title="简单pipeline案例"></a>简单pipeline案例</h2><p>第一个欢迎脚本，通过节点管理</p>
<blockquote>
<p>jenkins的节点需要设置，默认只有一个master</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node(<span class="string">&quot;master&quot;</span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;你好世界&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加stage脚本"><a href="#添加stage脚本" class="headerlink" title="添加stage脚本"></a>添加stage脚本</h2><p>只有添加stage之后，才会有画面显示</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">node(<span class="string">&quot;master&quot;</span>)&#123;</span><br><span class="line">  stage(<span class="string">&quot;第一步&quot;</span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;环境配置&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">&quot;第二步&quot;</span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;获取代码&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">&quot;第三步&quot;</span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;构建、打包&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">&quot;第四步&quot;</span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;部署&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安装Blue-Ocean插件"><a href="#安装Blue-Ocean插件" class="headerlink" title="安装Blue Ocean插件"></a>安装Blue Ocean插件</h2><p>用于可视化的展现jenkins Pipeline的执行过程</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jenkins.io/doc/book/blueocean/">https://www.jenkins.io/doc/book/blueocean/</a></p>
</blockquote>
<p>该插件超哥已经给大家导入好了，要么就可以自己进行插件管理，在线安装</p>
<p><img src="pic/image-20210225104821365.png" alt="image-20210225104821365"></p>
<hr>
<p><img src="pic/image-20210225105020205.png" alt="image-20210225105020205"></p>
<h2 id="执行shell命令"><a href="#执行shell命令" class="headerlink" title="执行shell命令"></a>执行shell命令</h2><p>Pipeline脚本</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">node(<span class="string">&quot;master&quot;</span>)&#123;</span><br><span class="line">  stage(<span class="string">&quot;获取主机名&quot;</span>)&#123;</span><br><span class="line">    sh <span class="string">&quot;hostname&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">&quot;查看磁盘空间&quot;</span>)&#123;</span><br><span class="line">    sh <span class="string">&quot;df -h&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">&quot;查看内存&quot;</span>)&#123;</span><br><span class="line">    sh <span class="string">&quot;free -m&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在blue ocean【蓝海】中查看结果</p>
<p><img src="pic/image-20210225105546628.png" alt="image-20210225105546628"></p>
<h3 id="执行linux的bash脚本"><a href="#执行linux的bash脚本" class="headerlink" title="执行linux的bash脚本"></a>执行linux的bash脚本</h3><p>pipeline脚本</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">node(<span class="string">&quot;master&quot;</span>)&#123;</span><br><span class="line">  stage(<span class="string">&quot;看看我这个脚本的内容&quot;</span>)&#123;</span><br><span class="line">    sh (<span class="string">&quot;cat /scripts/hello.sh&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">&quot;脚本开始执行&quot;</span>)&#123;</span><br><span class="line">    sh (<span class="string">&quot;bash /scripts/hello.sh&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hello.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins01 scripts]<span class="comment"># cat hello.sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;爱的魔力转圈圈&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;jenkins正确的找到了我&quot;</span></span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<p><img src="pic/image-20210225105917932.png" alt="image-20210225105917932"></p>
<h2 id="pipeline获取gitlab代码"><a href="#pipeline获取gitlab代码" class="headerlink" title="pipeline获取gitlab代码"></a>pipeline获取gitlab代码</h2><p><img src="pic/image-20210225110141072.png" alt="image-20210225110141072"></p>
<p>通过流水线语法，获取代码案例</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="attr">credentialsId:</span> <span class="string">&#x27;jenkins&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;git@10.211.55.12:cmdb_dev/mydjango.git&#x27;</span></span><br></pre></td></tr></table></figure>

<p>pipeline脚本</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node(<span class="string">&quot;master&quot;</span>)&#123;</span><br><span class="line">  stage(<span class="string">&quot;第一步，获取代码&quot;</span>)&#123;</span><br><span class="line">    echo <span class="string">&quot;拉取代码中&quot;</span></span><br><span class="line">    git <span class="attr">credentialsId:</span> <span class="string">&#x27;jenkins&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;git@10.211.55.12:cmdb_dev/mydjango.git&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<p><img src="pic/image-20210225110314469.png" alt="image-20210225110314469"></p>
<h2 id="pipeline部署django程序"><a href="#pipeline部署django程序" class="headerlink" title="pipeline部署django程序"></a>pipeline部署django程序</h2><p>脚本</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline&#123;</span><br><span class="line">agent any</span><br><span class="line">  stages&#123;</span><br><span class="line">    stage(<span class="string">&quot;获取代码&quot;</span>)&#123;</span><br><span class="line">      steps&#123;</span><br><span class="line">       git <span class="attr">credentialsId:</span> <span class="string">&#x27;jenkins&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;git@10.211.55.12:cmdb_dev/mydjango.git&#x27;</span> </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&quot;执行部署脚本&quot;</span>)&#123;</span><br><span class="line">      steps&#123;</span><br><span class="line">                  sh (<span class="string">&quot;bash /opt/django_deploy.sh&quot;</span>)    </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&quot;部署完成&quot;</span>)&#123;</span><br><span class="line">      steps&#123;</span><br><span class="line">              echo <span class="string">&quot;正确部署&quot;</span>  </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>推送新代码，再次构建pipeline</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git@10.211.55.12:cmdb_dev/mydjango.git</span><br></pre></td></tr></table></figure>

<p>部署脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins01 opt]# cat /opt/django_deploy.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.进入代码目录，打包传输</span></span><br><span class="line">DATE=$(date +%Y-%m-%d-%H-%M-%S)</span><br><span class="line">web_server=&quot;10.211.55.12&quot;</span><br><span class="line"></span><br><span class="line">get_code()&#123;</span><br><span class="line">    cd $WORKSPACE &amp;&amp; \</span><br><span class="line">    tar czf /opt/django-$&#123;DATE&#125;.tar.gz ./*</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.代码发送给web集群组</span></span><br><span class="line">deploy_django_server()&#123;</span><br><span class="line">for hosts in $web_server</span><br><span class="line">do</span><br><span class="line">    scp /opt/django-$&#123;DATE&#125;.tar.gz root@$hosts:/opt/</span><br><span class="line">    ssh root@$hosts &quot;mkdir -p /code/django-$&#123;DATE&#125; &amp;&amp; \</span><br><span class="line">                  tar -zxf /opt/django-$&#123;DATE&#125;.tar.gz -C /code/django-$&#123;DATE&#125;</span><br><span class="line">                  rm -rf /code/django &amp;&amp; \</span><br><span class="line">                  ln -s /code/django-$&#123;DATE&#125; /code/django &amp;&amp; \</span><br><span class="line">                  supervisorctl -c /etc/supervisor.conf restart all</span><br><span class="line">                  &quot;</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line">deploy()&#123;</span><br><span class="line">        get_code</span><br><span class="line">        deploy_django_server</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行入口</span></span><br><span class="line">deploy</span><br><span class="line">执行过程</span><br><span class="line">1.开发推送新代码，到gitlab仓库</span><br><span class="line">2.运维执行pipeline脚本</span><br><span class="line">3.最后一步，访问django的地址</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>Title:</span><a href="/2022/08/14/jenkins/"></a></p>
        <p><span>Author:</span><a href="/" title="Back to Homepage"></a></p>
        <p><span>Created:</span>2022-08-14, 00:40:44</p>
        <p><span>Updated:</span>2022-08-14, 00:40:44</p>
        <p>
            <span>Full URL:</span><a class="post-url" href="/2022/08/14/jenkins/" title="">http://example.com/2022/08/14/jenkins/</a>
            <span class="copy-path" data-clipboard-text="From http://example.com/2022/08/14/jenkins/　　By " title="Copy Article&#39;s Link &amp; Author"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>License:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"CC BY-NC-SA 4.0"</a> Keep Link &amp; Author if Distribute.
        </p>
    </div>



    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2022/08/14/deployment%E6%9B%B4%E6%96%B0/">
                    deployment更新
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#title-%E9%83%A8%E7%BD%B2jenkins"><span class="toc-number">1.</span> <span class="toc-text">title :部署jenkins</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jenkins"><span class="toc-number"></span> <span class="toc-text">jenkins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%8A%E7%BA%BF%E5%8F%91%E5%B1%95%E5%8F%B2"><span class="toc-number">1.</span> <span class="toc-text">代码上线发展史</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E6%9E%84%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">没有构建服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%9A%E4%B8%8A%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA"><span class="toc-number">1.2.</span> <span class="toc-text">晚上进行构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%9A%E4%B8%8A%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA%E5%B9%B6%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.</span> <span class="toc-text">晚上进行构建并进行自动化测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E5%BA%A6%E9%87%8F"><span class="toc-number">1.4.</span> <span class="toc-text">代码质量度量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%8A%A0%E8%AE%A4%E7%9C%9F%E7%9A%84%E5%AF%B9%E5%BE%85%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.</span> <span class="toc-text">更加认真的对待测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E6%94%B6%E6%B5%8B%E8%AF%95%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="toc-number">1.6.</span> <span class="toc-text">验收测试与自动化部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#centos7%E5%AE%89%E8%A3%85jenkins"><span class="toc-number">2.</span> <span class="toc-text">centos7安装jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEjdk%E7%8E%AF%E5%A2%83"><span class="toc-number">3.</span> <span class="toc-text">配置jdk环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85jenkins"><span class="toc-number">4.</span> <span class="toc-text">安装jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8jenkins"><span class="toc-number">5.</span> <span class="toc-text">启动jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jenkins%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">jenkins配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jenkins%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text">jenkins初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%94%81jenkins"><span class="toc-number">7.1.</span> <span class="toc-text">解锁jenkins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89jenkins%E6%8F%92%E4%BB%B6"><span class="toc-number">7.2.</span> <span class="toc-text">自定义jenkins插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9jenkins%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">7.3.</span> <span class="toc-text">修改jenkins用户密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="toc-number">8.</span> <span class="toc-text">插件安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9Ajenkins%E4%BB%A3%E7%90%86%E4%B8%8B%E8%BD%BD%E6%8F%92%E4%BB%B6"><span class="toc-number">8.1.</span> <span class="toc-text">指定jenkins代理下载插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%85%E5%8D%8E%E9%95%9C%E5%83%8F%E7%AB%99%E4%B8%8B%E8%BD%BD%E6%8F%92%E4%BB%B6"><span class="toc-number">8.2.</span> <span class="toc-text">使用清华镜像站下载插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9jenkins%E9%BB%98%E8%AE%A4%E5%8D%87%E7%BA%A7%E6%8F%92%E4%BB%B6%E6%BA%90"><span class="toc-number">8.3.</span> <span class="toc-text">修改jenkins默认升级插件源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins%E6%8F%92%E4%BB%B6%E8%BF%81%E7%A7%BB"><span class="toc-number">8.4.</span> <span class="toc-text">jenkins插件迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8F%92%E4%BB%B6%E5%88%97%E8%A1%A8"><span class="toc-number">9.</span> <span class="toc-text">查看插件列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%8A%9F%E8%83%BD%E9%A2%84%E8%A7%88"><span class="toc-number">9.1.</span> <span class="toc-text">新功能预览</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins%E4%B8%BB%E7%9B%AE%E5%BD%95%E5%AD%A6%E4%B9%A0"><span class="toc-number">10.</span> <span class="toc-text">Jenkins主目录学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%88%87%E7%9A%86%E6%96%87%E4%BB%B6%E4%B9%8B%E7%94%A8%E6%88%B7%E7%9B%AE%E5%BD%95"><span class="toc-number">10.1.</span> <span class="toc-text">一切皆文件之用户目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB"><span class="toc-number">10.2.</span> <span class="toc-text">主配置文件解读</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9jenkins%E6%97%B6%E5%8C%BA"><span class="toc-number">11.</span> <span class="toc-text">修改jenkins时区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins%E5%88%9B%E5%BB%BAjob"><span class="toc-number">12.</span> <span class="toc-text">Jenkins创建job</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#freestyle-job%E4%BB%8B%E7%BB%8D"><span class="toc-number">12.1.</span> <span class="toc-text">freestyle-job介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jenkins%E5%88%9B%E5%BB%BAfreestyle%E9%A1%B9%E7%9B%AE"><span class="toc-number">12.2.</span> <span class="toc-text">Jenkins创建freestyle项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Execute-shell%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E3%80%81%E8%84%9A%E6%9C%AC"><span class="toc-number">12.3.</span> <span class="toc-text">Execute shell执行命令、脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8Cjob%E7%AB%8B%E5%8D%B3%E6%9E%84%E5%BB%BA"><span class="toc-number">12.3.1.</span> <span class="toc-text">执行job立即构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E7%BB%93%E6%9E%9C%E6%97%A5%E5%BF%97"><span class="toc-number">12.3.2.</span> <span class="toc-text">构建结果日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%9E%84%E5%BB%BA%E5%8A%A8%E4%BD%9C"><span class="toc-number">12.3.3.</span> <span class="toc-text">增加一个构建动作</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jenkins%E8%BF%9E%E6%8E%A5gitlab%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81"><span class="toc-number"></span> <span class="toc-text">Jenkins连接gitlab获取代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8B%E6%83%85%E6%8F%90%E9%86%92"><span class="toc-number">1.</span> <span class="toc-text">友情提醒</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEjenkins%E7%BB%93%E5%90%88gitlab"><span class="toc-number">3.</span> <span class="toc-text">配置jenkins结合gitlab</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jenkins%E6%B7%BB%E5%8A%A0gitlab%E8%AE%A4%E8%AF%81"><span class="toc-number">4.</span> <span class="toc-text">jenkins添加gitlab认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%AF%A5job%EF%BC%8C%E7%AB%8B%E5%8D%B3%E6%9E%84%E5%BB%BA"><span class="toc-number">5.</span> <span class="toc-text">启动该job，立即构建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86%E6%97%A5%E5%BF%97"><span class="toc-number">6.</span> <span class="toc-text">控制台查看详细日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96gitlab%E5%88%86%E6%94%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">7.</span> <span class="toc-text">获取gitlab分支代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%BB%8B%E7%BB%8D"><span class="toc-number"></span> <span class="toc-text">持续集成介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98%EF%BC%88CD%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">持续交付（CD）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%AE%9E%E6%96%BD%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">持续集成实施流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">关于版本控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git%E5%B7%A5%E5%85%B7"><span class="toc-number">4.</span> <span class="toc-text">Git工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git%E5%B7%A5%E5%85%B7-1"><span class="toc-number"></span> <span class="toc-text">Git工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8Cgit%E5%89%8D%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">运行git前的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">用户信息配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">Git配置相关命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number"></span> <span class="toc-text">Git工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Git%E5%9B%9B%E4%B8%AA%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.</span> <span class="toc-text">Git四个区域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git%E5%AE%9E%E8%B7%B5"><span class="toc-number">2.</span> <span class="toc-text">Git实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E5%9C%BA%E6%99%AF%E9%9C%80%E6%B1%82%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">三种场景需求：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%8A%8A%E5%B7%B2%E6%9C%89%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%EF%BC%8C%E7%BA%B3%E5%85%A5git%E7%AE%A1%E7%90%86"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.把已有的项目代码，纳入git管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%94%A8git%E7%AE%A1%E7%90%86"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.新建一个项目，直接用git管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PS-git%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.3.</span> <span class="toc-text">PS:git原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.4.</span> <span class="toc-text">3.获取远程代码仓库代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%BC%94%E7%BB%83"><span class="toc-number">3.</span> <span class="toc-text">Git生命周期演练</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E5%B7%A5%E4%BD%9C%E5%8C%BA"><span class="toc-number">3.1.</span> <span class="toc-text">git工作区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E4%BB%93%E5%BA%93"><span class="toc-number">3.2.</span> <span class="toc-text">git仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5git%E6%96%87%E4%BB%B6%E7%8A%B6%E6%80%81"><span class="toc-number">3.3.</span> <span class="toc-text">检查git文件状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E6%96%87%E4%BB%B6%E9%87%8D%E5%91%BD%E5%90%8D"><span class="toc-number">3.4.</span> <span class="toc-text">给文件重命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E7%89%88%E6%9C%AC%E5%8E%86%E5%8F%B2"><span class="toc-number">3.5.</span> <span class="toc-text">git版本历史</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#git-log"><span class="toc-number">3.5.1.</span> <span class="toc-text">git log</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E6%96%87%E4%BB%B6%E5%AF%B9%E6%AF%94"><span class="toc-number">3.6.</span> <span class="toc-text">git文件对比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.6.1.</span> <span class="toc-text">命令实践</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E4%BB%93%E5%BA%93%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">4.</span> <span class="toc-text">git仓库文件管理生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80"><span class="toc-number">5.</span> <span class="toc-text">Git版本回退</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80%E5%8E%9F%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">版本回退原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E7%A9%BF%E6%A2%AD%E6%9C%AA%E6%9D%A5"><span class="toc-number">6.</span> <span class="toc-text">git穿梭未来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git-stash"><span class="toc-number">7.</span> <span class="toc-text">git stash</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-stash%E5%AE%9E%E9%99%85%E7%94%A8%E6%B3%95"><span class="toc-number">7.1.</span> <span class="toc-text">git stash实际用法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git%E5%88%86%E6%94%AF"><span class="toc-number"></span> <span class="toc-text">Git分支</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E5%88%86%E6%94%AF%E5%91%BD%E4%BB%A4"><span class="toc-number">1.</span> <span class="toc-text">git分支命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF%E5%86%B2%E7%AA%81"><span class="toc-number">2.</span> <span class="toc-text">git合并分支冲突</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git%E6%A0%87%E7%AD%BE"><span class="toc-number"></span> <span class="toc-text">Git标签</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E6%A0%87%E7%AD%BE%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">git标签有什么用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E5%95%A5%E7%94%A8git%E6%A0%87%E7%AD%BE"><span class="toc-number">2.</span> <span class="toc-text">为啥用git标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E6%A0%87%E7%AD%BE%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">git标签使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gitee%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="toc-number"></span> <span class="toc-text">gitee远程仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%A9%BA%E4%BB%93%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">创建空仓库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5gitee%E4%BB%93%E5%BA%93-HTTPS"><span class="toc-number">2.</span> <span class="toc-text">配置客户端连接gitee仓库(HTTPS)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E9%80%81%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93%E5%88%B0%E8%BF%9C%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">推送本地仓库到远程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%8D%E5%AF%86%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%EF%BC%88SSH%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">免密推送代码（SSH）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8B%E9%9A%86%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="toc-number">3.1.</span> <span class="toc-text">克隆远程仓库到本地</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git-fetch%E4%BD%BF%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">git fetch使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gitlab"><span class="toc-number"></span> <span class="toc-text">Gitlab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Gitlab%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">Gitlab介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gitlab%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">Gitlab安装配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab%E6%B1%89%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">gitlab汉化配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gitlab%E5%85%B3%E9%97%AD%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C"><span class="toc-number">2.2.</span> <span class="toc-text">Gitlab关闭用户注册</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gitlab%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">Gitlab仓库管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E3%80%81%E7%BB%84%E3%80%81%E9%A1%B9%E7%9B%AE%E8%81%94%E7%B3%BB"><span class="toc-number">3.1.</span> <span class="toc-text">用户、组、项目联系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84"><span class="toc-number">3.2.</span> <span class="toc-text">创建组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.3.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">3.4.</span> <span class="toc-text">创建用户</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%94%B6%E5%88%B0%E9%82%AE%E4%BB%B6"><span class="toc-number">3.4.1.</span> <span class="toc-text">用户收到邮件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95gitlab"><span class="toc-number">3.4.2.</span> <span class="toc-text">用户登录gitlab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%8D%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7"><span class="toc-number">3.4.3.</span> <span class="toc-text">再创建一个普通用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#root%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%A5%E5%88%86%E9%85%8D%E7%BB%84%E6%9D%83%E9%99%90"><span class="toc-number">3.4.4.</span> <span class="toc-text">root管理员来分配组权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E7%94%A8%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%9F%A5%E7%9C%8B"><span class="toc-number">3.4.5.</span> <span class="toc-text">分别用普通用户登录查看</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AESSH-KEY"><span class="toc-number">4.</span> <span class="toc-text">配置SSH KEY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%E5%88%B0gitlab"><span class="toc-number">4.1.</span> <span class="toc-text">推送代码到gitlab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">在客户端上执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E9%80%81%E5%88%86%E6%94%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">4.3.</span> <span class="toc-text">推送分支代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF%E4%B8%94%E6%8E%A8%E9%80%81gitlab"><span class="toc-number">4.3.1.</span> <span class="toc-text">合并分支且推送gitlab</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E9%80%81tag"><span class="toc-number">4.4.</span> <span class="toc-text">推送tag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gitlab%E5%A4%87%E4%BB%BD%E3%80%81%E6%81%A2%E5%A4%8D%E3%80%81%E5%8D%87%E7%BA%A7"><span class="toc-number">5.</span> <span class="toc-text">Gitlab备份、恢复、升级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%87%E4%BB%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">修改备份配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E5%A4%87%E4%BB%BD"><span class="toc-number">5.2.</span> <span class="toc-text">定时备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="toc-number">5.3.</span> <span class="toc-text">数据恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E6%93%8D%E4%BD%9C"><span class="toc-number">5.4.</span> <span class="toc-text">升级操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jenkins%E7%BB%93%E5%90%88gitlab"><span class="toc-number"></span> <span class="toc-text">jenkins结合gitlab</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9gitlab%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93"><span class="toc-number">0.1.</span> <span class="toc-text">选择gitlab代码仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85gitlab%E7%9A%84%E7%AC%94%E8%AE%B0"><span class="toc-number">0.2.</span> <span class="toc-text">安装gitlab的笔记</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAgitlab%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93"><span class="toc-number">0.3.</span> <span class="toc-text">创建gitlab代码仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E7%A0%81%E4%BA%91%E5%AF%BC%E5%85%A5%E4%BB%A3%E7%A0%81%E9%A1%B9%E7%9B%AE"><span class="toc-number">0.4.</span> <span class="toc-text">从码云导入代码项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8EURL%E5%AF%BC%E5%85%A5%E4%BB%93%E5%BA%93"><span class="toc-number">0.4.1.</span> <span class="toc-text">从URL导入仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAgitlab%E4%BB%93%E5%BA%93"><span class="toc-number">0.4.2.</span> <span class="toc-text">创建gitlab仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gitlab%E5%AF%BC%E5%85%A5URL%E4%BB%93%E5%BA%93%E5%AE%8C%E6%AF%95"><span class="toc-number">0.4.3.</span> <span class="toc-text">gitlab导入URL仓库完毕</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8jenkins%E4%B8%AD%E6%B7%BB%E5%8A%A0git%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86"><span class="toc-number">0.4.4.</span> <span class="toc-text">在jenkins中添加git代码管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#root%E7%94%A8%E6%88%B7%E5%92%8Cgitlab%E7%9A%84%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE"><span class="toc-number">0.4.5.</span> <span class="toc-text">root用户和gitlab的认证配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95jenkins%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9C%AC%E5%9C%B0%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81"><span class="toc-number">0.4.6.</span> <span class="toc-text">测试jenkins服务器本地拉取代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E6%B5%8B%E8%AF%95jenkins%E5%92%8Cgitlab%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%80%A7"><span class="toc-number">0.4.7.</span> <span class="toc-text">再次测试jenkins和gitlab的连接性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9jenkins%E5%90%AF%E5%8A%A8%E7%94%A8%E6%88%B7-%E7%A6%81%E6%AD%A2%E8%AF%A5%E6%93%8D%E4%BD%9C%EF%BC%8C%E6%9C%89%E8%BF%B7%E4%B9%8Bbug"><span class="toc-number">0.4.8.</span> <span class="toc-text">修改jenkins启动用户(禁止该操作，有迷之bug)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E7%A7%81%E9%92%A5%E6%B7%BB%E5%8A%A0%E4%BB%93%E5%BA%93%E8%AE%A4%E8%AF%81"><span class="toc-number">0.4.9.</span> <span class="toc-text">用私钥添加仓库认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E7%AB%8B%E5%8D%B3%E6%9E%84%E5%BB%BA%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81"><span class="toc-number">0.4.10.</span> <span class="toc-text">点击立即构建拉取代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jenkins%E9%83%A8%E7%BD%B2html%E7%BD%91%E7%AB%99"><span class="toc-number">1.</span> <span class="toc-text">jenkins部署html网站</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E4%B8%80%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AFlinux"><span class="toc-number">1.1.</span> <span class="toc-text">准备一个客户端linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8jenkins%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.</span> <span class="toc-text">在jenkins服务端编写脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEjenkins%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">1.3.</span> <span class="toc-text">配置jenkins和客户端免密登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEjenkins%E8%A7%A6%E5%8F%91%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C"><span class="toc-number">1.4.</span> <span class="toc-text">配置jenkins触发脚本执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E7%AB%8B%E5%8D%B3%E6%9E%84%E5%BB%BA"><span class="toc-number">1.5.</span> <span class="toc-text">点击立即构建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%9E%84%E5%BB%BA%E7%BB%93%E6%9E%9C"><span class="toc-number">2.</span> <span class="toc-text">检查构建结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%AE%BF%E9%97%AE%E8%84%9A%E6%9C%AC%E9%83%A8%E7%BD%B2%E7%9A%84%E7%AB%99%E7%82%B9%E9%A1%B5%E9%9D%A2"><span class="toc-number">2.1.</span> <span class="toc-text">测试访问脚本部署的站点页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">构建触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">jenkins设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitlab%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">gitlab设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.3.</span> <span class="toc-text">实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%8F%91%E9%80%81post%E8%AF%B7%E6%B1%82%E8%A7%A6%E5%8F%91%E6%9E%84%E5%BB%BA"><span class="toc-number">3.4.</span> <span class="toc-text">手动发送post请求触发构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%BB%93%E6%9E%9C"><span class="toc-number">3.4.1.</span> <span class="toc-text">自动构建结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins%E8%BF%94%E5%9B%9E%E6%9E%84%E5%BB%BA%E7%8A%B6%E6%80%81"><span class="toc-number">4.</span> <span class="toc-text">Jenkins返回构建状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90gitlab%E7%9A%84token"><span class="toc-number">4.1.</span> <span class="toc-text">生成gitlab的token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEjob"><span class="toc-number">4.2.</span> <span class="toc-text">配置job</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9E%84%E5%BB%BA%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">配置构建发送邮件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E7%BB%AD%E9%85%8D%E7%BD%AEjob"><span class="toc-number">5.1.</span> <span class="toc-text">继续配置job</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jenkins%E9%83%A8%E7%BD%B2%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99"><span class="toc-number"></span> <span class="toc-text">jenkins部署静态网站</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="toc-number">1.</span> <span class="toc-text">自动化部署</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jenkins%E9%83%A8%E7%BD%B2Django"><span class="toc-number"></span> <span class="toc-text">jenkins部署Django</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%BC%80%E5%8F%91django%E6%AC%A2%E8%BF%8E%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">手动开发django欢迎页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84%E4%B8%8A%E7%BA%BFdjango%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">如何通过jenkins自动化的上线django代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jenkins%E5%88%9B%E5%BB%BAmaven%E9%A1%B9%E7%9B%AE"><span class="toc-number"></span> <span class="toc-text">Jenkins创建maven项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Java项目部署概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFJava%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.</span> <span class="toc-text">什么是Java项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88java%E9%A1%B9%E7%9B%AE%E9%9C%80%E8%A6%81%E7%BC%96%E8%AF%91"><span class="toc-number">1.2.</span> <span class="toc-text">为什么java项目需要编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8vs%E8%87%AA%E5%8A%A8%E7%BC%96%E8%AF%91"><span class="toc-number">1.3.</span> <span class="toc-text">手动vs自动编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maven%E4%BA%86%E8%A7%A3"><span class="toc-number">1.4.</span> <span class="toc-text">maven了解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Maven%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">Maven项目结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2maven"><span class="toc-number">2.</span> <span class="toc-text">部署maven</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86maven"><span class="toc-number">3.</span> <span class="toc-text">认识maven</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#maven%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">maven命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%88%B0gitlab"><span class="toc-number">4.</span> <span class="toc-text">开发人员提交代码到gitlab</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9maven%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">修改maven配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jenkins%E6%B5%81%E6%B0%B4%E7%BA%BFPipeline"><span class="toc-number"></span> <span class="toc-text">jenkins流水线Pipeline</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B5%81%E6%B0%B4%E7%BA%BF%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">什么是流水线？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-number">2.</span> <span class="toc-text">Jenkins为什么用流水线</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pipeline%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8CJenkins-file"><span class="toc-number">2.1.</span> <span class="toc-text">Pipeline的基本概念和Jenkins-file</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95pipeline%E6%A1%88%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">简单pipeline案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0stage%E8%84%9A%E6%9C%AC"><span class="toc-number">4.</span> <span class="toc-text">添加stage脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Blue-Ocean%E6%8F%92%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">安装Blue Ocean插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4"><span class="toc-number">6.</span> <span class="toc-text">执行shell命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8Clinux%E7%9A%84bash%E8%84%9A%E6%9C%AC"><span class="toc-number">6.1.</span> <span class="toc-text">执行linux的bash脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pipeline%E8%8E%B7%E5%8F%96gitlab%E4%BB%A3%E7%A0%81"><span class="toc-number">7.</span> <span class="toc-text">pipeline获取gitlab代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pipeline%E9%83%A8%E7%BD%B2django%E7%A8%8B%E5%BA%8F"><span class="toc-number">8.</span> <span class="toc-text">pipeline部署django程序</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="Hide"  title="Show or Hide Table of Contents">

    <script>
        yiliaConfig.toc = ["Hide", "Show", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"　| Hexo　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="Back to Homepage"><i class="fa fa-home"></i></a>
        

        <a title="Mini Archives"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2022/08/14/deployment%E6%9B%B4%E6%96%B0/" title="Next: deployment更新">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/08/14/jenkins/">jenkins</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/14/deployment%E6%9B%B4%E6%96%B0/">deployment更新</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/13/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2022 John Doe
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="Site Visitors"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="Page Hits"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>